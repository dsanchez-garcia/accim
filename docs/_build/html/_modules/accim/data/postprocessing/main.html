

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>accim.data.postprocessing.main &mdash; accim  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            accim
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tutorial:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../1_requirements.html">1. Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../2_installation.html">2. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../3_quick%20tutorial.html">3. Quick tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../4_detailed%20use.html">4. Detailed use and explanation of arguments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../5_troubleshooting.html">5. Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../6_citation.html">6. Citation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../7_credits.html">7. Credits</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How-to Guides:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../jupyter_notebooks/addAccis/using_addAccis.html">Using <code class="docutils literal notranslate"><span class="pre">addAccis()</span></code> to apply adaptive setpoint temperatures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../jupyter_notebooks/full_example_IBPSA/full_example_IBPSA.html">Full example of adaptive setpoint temperature simulation: IBPSA webinar</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../jupyter_notebooks/rename_epw_files/using_rename_epw_files.html">Using <code class="docutils literal notranslate"><span class="pre">rename_epw_files()</span></code> to rename the EPWs for proper data analysis after simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../jupyter_notebooks/runEp/using_runEp.html">Using <code class="docutils literal notranslate"><span class="pre">runEp()</span></code> to directly run simulations with EnergyPlus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../jupyter_notebooks/Table/using_Table.html">Using the class <code class="docutils literal notranslate"><span class="pre">Table()</span></code> for data analysis</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Further information:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../modules.html">accim</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Documentation for previous versions:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../8_pdfs_for_prev_versions.html">Documentation for previous versions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">accim</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">accim.data.postprocessing.main</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for accim.data.postprocessing.main</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Union</span>

<div class="viewcode-block" id="Table">
<a class="viewcode-back" href="../../../../accim.data.postprocessing.html#accim.data.postprocessing.main.Table">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Table</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generates a table or dataframe using the EnergyPlus simulation</span>
<span class="sd">    results CSV files available in the current folder.</span>

<span class="sd">    :param datasets: A list of strings. The strings are the names of the CSV files</span>
<span class="sd">        that you want to work with, at the working directory.</span>
<span class="sd">    :type datasets: list</span>
<span class="sd">    :param source_concatenated_csv_filepath: A string used as the filepath to read the</span>
<span class="sd">        previously concatenated csv file with the argument concatenated_csv_name.</span>
<span class="sd">    :type source_concatenated_csv_filepath: str</span>
<span class="sd">    :param source_frequency: Used to inform accim about the frequency</span>
<span class="sd">        of the input CSVs. If there are multiple frequencies in a single CSV,</span>
<span class="sd">        the columns for the frequencies different to the selected one will be discarded.</span>
<span class="sd">        String can be &#39;timestep&#39;, &#39;hourly&#39;, &#39;daily&#39;, &#39;monthly&#39; or &#39;runperiod&#39;.</span>
<span class="sd">    :type source_frequency: str</span>
<span class="sd">    :param frequency: Rows will be aggregated based on this frequency.</span>
<span class="sd">        String can be &#39;timestep&#39;, &#39;hourly&#39;, &#39;daily&#39;, &#39;monthly&#39; or &#39;runperiod&#39;.</span>
<span class="sd">        For instance, if &#39;daily&#39;, hourly or timesteply rows will be aggregated in days.</span>
<span class="sd">        String can be &#39;timestep&#39;, &#39;hourly&#39;, &#39;daily&#39;, &#39;monthly&#39; or &#39;runperiod&#39;.</span>
<span class="sd">    :type frequency: str</span>
<span class="sd">    :param frequency_agg_func: Aggregates the rows based on the defined</span>
<span class="sd">        frequency by sum or mean. Can be &#39;sum&#39; or &#39;mean&#39;.</span>
<span class="sd">    :type frequency_agg_func: str</span>
<span class="sd">    :param standard_outputs: Used to consider only standard outputs from accim.</span>
<span class="sd">        It can be True or False.</span>
<span class="sd">    :type standard_outputs: bool</span>
<span class="sd">    :param output_cols_to_keep: A list of columns from EnergyPlus Output:Variable.</span>
<span class="sd">        Used to remove all other columns from EnergyPlus Output:Variable objects</span>
<span class="sd">        except the ones specified in this list.</span>
<span class="sd">    :type output_cols_to_keep: list</span>
<span class="sd">    :param concatenated_csv_name: Used as the name for the concatenated csv file.</span>
<span class="sd">    :type concatenated_csv_name: str</span>
<span class="sd">    :param idf_path: The path of the IDF used for the simulations.</span>
<span class="sd">    :type path-like</span>
<span class="sd">    :param drop_nan: If True, drops the rows with NaNs before</span>
<span class="sd">        exporting the CSV using concatenated_csv_name.</span>
<span class="sd">    :type drop_nan: bool</span>
<span class="sd">    :param level: A list of strings. Strings can be &#39;block&#39; and/or &#39;building&#39;.</span>
<span class="sd">        Used to create columns with block or building values.</span>
<span class="sd">    :type level: list</span>
<span class="sd">    :param level_agg_func: A list of strings. Strings can be &#39;sum&#39; and/or &#39;mean&#39;.</span>
<span class="sd">        Used to create the columns for levels preciously stated by summing and/or averaging.</span>
<span class="sd">    :type level_agg_func: list</span>
<span class="sd">    :param level_excluded_zones: A list of strings.</span>
<span class="sd">        Strings must be the zones excluded from level computations.</span>
<span class="sd">        Used to try to match the cities in the EPW file name with actual cities.</span>
<span class="sd">        To be used if sample_EPWs have not been previously renamed with rename_epw_files().</span>
<span class="sd">    :type level_excluded_zones: list</span>
<span class="sd">    :param split_epw_names: It splits the EPW name into Country_City_RCPscenario-Year format.</span>
<span class="sd">        To be used if sample_EPWs do have been previously renamed with rename_epw_files().</span>
<span class="sd">    :type split_epw_names: bool</span>
<span class="sd">    :param normalised_energy_units: A bool, can be True or False.</span>
<span class="sd">        Used to show Wh or Wh/m2 units.</span>
<span class="sd">    :type normalised_energy_units: bool</span>
<span class="sd">    :param rename_cols: A bool, can be True or False.</span>
<span class="sd">        Used to keep the original name of EnergyPlus outputs or rename them for understanding</span>
<span class="sd">        purposes.</span>
<span class="sd">    :type rename_cols: bool</span>
<span class="sd">    :param energy_units_in_kwh: A bool, can be True or False.</span>
<span class="sd">        If True, energy units will be in kWh or kWh/m2,</span>
<span class="sd">        otherwise these will be in Wh or Wh/m2.</span>
<span class="sd">    :type energy_units_in_kwh: bool</span>
<span class="sd">    :param name_export_rows_with_NaN: This parameter shouldn&#39;t be generally used.</span>
<span class="sd">        A string used as a name to export a xlsx file with the rows with NaNs.</span>
<span class="sd">        Used only to check the rows with NANs.</span>
<span class="sd">    :type name_export_rows_with_NaN: str</span>
<span class="sd">    :param name_export_rows_not_corr_agg: This parameter shouldn&#39;t be generally used.</span>
<span class="sd">        A string used as a name to export a xlsx file with the rows not correctly aggregated.</span>
<span class="sd">        Used only to check the aggregations are correct.</span>
<span class="sd">    :type name_export_rows_not_corr_agg: str</span>
<span class="sd">    :ivar df: The pandas DataFrame instance.</span>
<span class="sd">        It is modified when method ``format_table`` is called.</span>
<span class="sd">    :ivar df_backup: The full pandas DataFrame instance resulting from class ``Table``.</span>
<span class="sd">        It is not modified, so can be used to revert the DataFrame instance to its initial state.</span>
<span class="sd">    :ivar cols_for_multiindex: The list of columns (or variables) that change in the dataset.</span>
<span class="sd">        These represent the variables that might be interesting to study, and therefore,</span>
<span class="sd">        the variables that are suggested to used in arguments</span>
<span class="sd">        ``vars_to_gather``, ``vars_to_gather_cols`` or ``vars_to_gather_rows``.</span>
<span class="sd">    :ivar wrangled_df_unstacked: The resulting pandas DataFrame after calling the</span>
<span class="sd">        method ``wrangled_table`` with ``reshaping=&#39;unstack&#39;``</span>
<span class="sd">    :ivar wrangled_df_stacked: The resulting pandas DataFrame after calling the</span>
<span class="sd">        method ``wrangled_table`` with ``reshaping=&#39;stack&#39;``</span>
<span class="sd">    :ivar wrangled_df_multiindex: The resulting pandas DataFrame after calling the</span>
<span class="sd">        method ``wrangled_table`` with ``reshaping=&#39;multiindex&#39;``</span>
<span class="sd">    :ivar wrangled_df_pivoted: The resulting pandas DataFrame after calling the</span>
<span class="sd">        method ``wrangled_table`` with ``reshaping=&#39;pivot&#39;``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">datasets</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">source_concatenated_csv_filepath</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">source_frequency</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">frequency</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">frequency_agg_func</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">standard_outputs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">output_cols_to_keep</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">concatenated_csv_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">idf_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">level</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">level_agg_func</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">level_excluded_zones</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">block_zone_hierarchy</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">split_epw_names</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">normalised_energy_units</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">rename_cols</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">energy_units_in_kwh</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">drop_nan</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">name_export_rows_with_NaN</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">name_export_rows_not_corr_agg</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor method</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">checkpoint</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">datasets</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">datasets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">level_agg_func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">level_agg_func</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">level</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">level</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># if custom_cols is None:</span>
        <span class="c1">#     custom_cols = []</span>

        <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">datapackage</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">csv</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">besos.eppy_funcs</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_building</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">frequency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normalised_energy_units</span> <span class="o">=</span> <span class="n">normalised_energy_units</span>

        <span class="c1"># todo making guided steps to input data</span>
        <span class="c1"># if source_concatenated_csv_filepath is None:</span>
        <span class="c1">#     source_concatenated_csv_filepath = input(</span>
        <span class="c1">#         &#39;You have not entered any concatenated CSV filepath. &#39;</span>
        <span class="c1">#         &#39;If you want to read the data from some concatenated CSV filepath, please add the filepath. &#39;</span>
        <span class="c1">#         &#39;Otherwise, if you want to read the data from the CSVs resulting from simulation, please hit enter.&#39;</span>
        <span class="c1">#         &#39;(filepath, or hit enter to omit): &#39;)</span>
        <span class="c1">#     if len(source_concatenated_csv_filepath) == 0:</span>
        <span class="c1">#         source_concatenated_csv_filepath = None</span>

        <span class="n">SFdict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;timestep&#39;</span><span class="p">:</span> <span class="s1">&#39;Timestep&#39;</span><span class="p">,</span>
            <span class="s1">&#39;hourly&#39;</span><span class="p">:</span> <span class="s1">&#39;Hourly&#39;</span><span class="p">,</span>
            <span class="s1">&#39;daily&#39;</span><span class="p">:</span> <span class="s1">&#39;Daily&#39;</span><span class="p">,</span>
            <span class="s1">&#39;monthly&#39;</span><span class="p">:</span> <span class="s1">&#39;Monthly&#39;</span><span class="p">,</span>
            <span class="s1">&#39;runperiod&#39;</span><span class="p">:</span> <span class="s1">&#39;RunPeriod&#39;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">source_concatenated_csv_filepath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">source_frequency</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;timestep&#39;</span><span class="p">,</span> <span class="s1">&#39;hourly&#39;</span><span class="p">,</span> <span class="s1">&#39;daily&#39;</span><span class="p">,</span> <span class="s1">&#39;monthly&#39;</span><span class="p">,</span> <span class="s1">&#39;runperiod&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;The source frequency entered must be timestep, hourly, daily, monthly or runperiod.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">source_frequency</span> <span class="o">==</span> <span class="s1">&#39;runperiod&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">frequency</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;timestep&#39;</span><span class="p">,</span> <span class="s1">&#39;hourly&#39;</span><span class="p">,</span> <span class="s1">&#39;daily&#39;</span><span class="p">,</span> <span class="s1">&#39;monthly&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Source frequency is </span><span class="si">{</span><span class="n">source_frequency</span><span class="si">}</span><span class="s1">, therefore &#39;</span>
                               <span class="sa">f</span><span class="s1">&#39;monthly, daily, hourly or timestep output frequency cannot be selected.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">source_frequency</span> <span class="o">==</span> <span class="s1">&#39;monthly&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">frequency</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;timestep&#39;</span><span class="p">,</span> <span class="s1">&#39;hourly&#39;</span><span class="p">,</span> <span class="s1">&#39;daily&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Source frequency is </span><span class="si">{</span><span class="n">source_frequency</span><span class="si">}</span><span class="s1">, therefore &#39;</span>
                               <span class="sa">f</span><span class="s1">&#39;daily, hourly or timestep output frequency cannot be selected.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">source_frequency</span> <span class="o">==</span> <span class="s1">&#39;daily&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">frequency</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;timestep&#39;</span><span class="p">,</span> <span class="s1">&#39;hourly&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Source frequency is </span><span class="si">{</span><span class="n">source_frequency</span><span class="si">}</span><span class="s1">, therefore &#39;</span>
                               <span class="sa">f</span><span class="s1">&#39;hourly or timestep output frequency cannot be selected.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">source_frequency</span> <span class="o">==</span> <span class="s1">&#39;hourly&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">frequency</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;timestep&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Source frequency is </span><span class="si">{</span><span class="n">source_frequency</span><span class="si">}</span><span class="s1">, therefore &#39;</span>
                               <span class="sa">f</span><span class="s1">&#39;timestep output frequency cannot be selected.&#39;</span><span class="p">)</span>

        <span class="n">flowchart_state_in_paper</span> <span class="o">=</span> <span class="s1">&#39;A.1&#39;</span>

        <span class="k">if</span> <span class="n">source_concatenated_csv_filepath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">source_concatenated_csv_filepath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;srcfreq&#39;</span><span class="p">:</span>
                    <span class="n">source_frequency</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">source_frequency</span> <span class="o">=</span> <span class="n">source_frequency</span>
                <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;freq&#39;</span><span class="p">:</span>
                    <span class="n">frequency</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">frequency</span>
                <span class="k">elif</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;frequency_agg_func&#39;</span><span class="p">:</span>
                    <span class="n">frequency_agg_func</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;standard_outputs&#39;</span><span class="p">:</span>
                    <span class="n">standard_outputs</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">standard_outputs</span> <span class="o">==</span> <span class="s1">&#39;True&#39;</span><span class="p">:</span>
                        <span class="n">standard_outputs</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">standard_outputs</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">source_frequency</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;timestep&#39;</span><span class="p">,</span> <span class="s1">&#39;hourly&#39;</span><span class="p">]:</span>
            <span class="n">aggregation_list_first</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">&#39;Date/Time&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Source&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Month/Day&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Month&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Day&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Hour&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Minute&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Second&#39;</span>
            <span class="p">]</span>
        <span class="k">elif</span> <span class="n">source_frequency</span> <span class="o">==</span> <span class="s1">&#39;daily&#39;</span><span class="p">:</span>
            <span class="n">aggregation_list_first</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">&#39;Date/Time&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Source&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Month/Day&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Month&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Day&#39;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="k">elif</span> <span class="n">source_frequency</span> <span class="o">==</span> <span class="s1">&#39;monthly&#39;</span><span class="p">:</span>
            <span class="n">aggregation_list_first</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">&#39;Date/Time&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Source&#39;</span><span class="p">,</span>
                <span class="c1"># &#39;Month/Day&#39;,</span>
                <span class="s1">&#39;Month&#39;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="k">elif</span> <span class="n">source_frequency</span> <span class="o">==</span> <span class="s1">&#39;runperiod&#39;</span><span class="p">:</span>
            <span class="n">aggregation_list_first</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">&#39;Date/Time&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Source&#39;</span><span class="p">,</span>
            <span class="p">]</span>

        <span class="c1"># Step: generating concatenated dataframe.</span>
        <span class="c1"># If source_concatenated_csv_filepath is None, then specified csv files on list format</span>
        <span class="c1"># are considered, otherwise all csv in the folder are considered.</span>
        <span class="c1"># If source_concatenated_csv_filepath is not None, then the csv path is considered to</span>
        <span class="c1"># build the dataframe.</span>

        <span class="n">flowchart_state_in_paper</span> <span class="o">=</span> <span class="s1">&#39;A.2&#39;</span>
        <span class="k">if</span> <span class="n">source_concatenated_csv_filepath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">datasets</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">flowchart_state_in_paper</span> <span class="o">=</span> <span class="s1">&#39;A.2.1&#39;</span>
                <span class="n">source_files</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">datasets</span> <span class="k">if</span>
                    <span class="s1">&#39;Table.csv&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">f</span> <span class="ow">and</span>
                    <span class="s1">&#39;Meter.csv&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">f</span> <span class="ow">and</span>
                    <span class="s1">&#39;Zsz.csv&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">f</span> <span class="ow">and</span>
                    <span class="s1">&#39;[CSVconcatenated.csv&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">f</span> <span class="ow">and</span>
                    <span class="s1">&#39;[Rows_not_corr_agg.csv&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">f</span> <span class="ow">and</span>
                    <span class="s1">&#39;[Rows_with_NaNs.csv&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">f</span>
                <span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flowchart_state_in_paper</span> <span class="o">=</span> <span class="s1">&#39;A.2.2&#39;</span>
                <span class="n">allfiles</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*.csv&#39;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="c1"># if path is None:</span>
                <span class="c1">#     allfiles = [i for i in os.listdir() if i.endswith(&#39;.csv&#39;)]</span>
                <span class="c1"># else:</span>
                <span class="c1">#     allfiles = [i for i in os.listdir(path) if i.endswith(&#39;.csv&#39;)]</span>
                <span class="n">source_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">allfiles</span> <span class="k">if</span>
                                <span class="s1">&#39;Table.csv&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">f</span> <span class="ow">and</span>
                                <span class="s1">&#39;Meter.csv&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">f</span> <span class="ow">and</span>
                                <span class="s1">&#39;Zsz.csv&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">f</span> <span class="ow">and</span>
                                <span class="s1">&#39;[CSVconcatenated.csv&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">f</span> <span class="ow">and</span>
                                <span class="s1">&#39;[Rows_not_corr_agg.csv&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">f</span> <span class="ow">and</span>
                                <span class="s1">&#39;[Rows_with_NaNs.csv&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">f</span>
                                <span class="p">]</span>
                <span class="c1"># todo check if glob.glob works with in terms of package, if not switch back to sorted</span>
                <span class="c1"># source_files = sorted(Path(os.getcwd()).glob(&#39;*.csv&#39;))</span>

            <span class="n">cleaned_columns</span> <span class="o">=</span> <span class="p">[</span>

                <span class="c1"># &#39;Date/Time&#39;,</span>
                <span class="s1">&#39;Environment:Site Outdoor Air Drybulb Temperature&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Environment:Site Wind Speed&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Environment:Site Outdoor Air Relative Humidity&#39;</span><span class="p">,</span>
                <span class="s1">&#39;EMS:Comfort Temperature&#39;</span><span class="p">,</span>
                <span class="s1">&#39;EMS:Adaptive Cooling Setpoint Temperature&#39;</span><span class="p">,</span>
                <span class="s1">&#39;EMS:Adaptive Heating Setpoint Temperature&#39;</span><span class="p">,</span>
                <span class="s1">&#39;EMS:Adaptive Cooling Setpoint Temperature_No Tolerance&#39;</span><span class="p">,</span>
                <span class="s1">&#39;EMS:Adaptive Heating Setpoint Temperature_No Tolerance&#39;</span><span class="p">,</span>
                <span class="s1">&#39;EMS:Ventilation Setpoint Temperature&#39;</span><span class="p">,</span>
                <span class="s1">&#39;EMS:Minimum Outdoor Temperature for ventilation&#39;</span><span class="p">,</span>
                <span class="s1">&#39;EMS:Comfortable Hours_No Applicability&#39;</span><span class="p">,</span>
                <span class="s1">&#39;EMS:Comfortable Hours_Applicability&#39;</span><span class="p">,</span>
                <span class="s1">&#39;EMS:Discomfortable Applicable Hot Hours&#39;</span><span class="p">,</span>
                <span class="s1">&#39;EMS:Discomfortable Applicable Cold Hours&#39;</span><span class="p">,</span>
                <span class="s1">&#39;EMS:Discomfortable Non Applicable Hot Hours&#39;</span><span class="p">,</span>
                <span class="s1">&#39;EMS:Discomfortable Non Applicable Cold Hours&#39;</span><span class="p">,</span>
                <span class="s1">&#39;EMS:Occupied Comfortable Hours_No Applicability&#39;</span><span class="p">,</span>
                <span class="s1">&#39;EMS:Occupied Hours&#39;</span><span class="p">,</span>
                <span class="s1">&#39;EMS:Ventilation Hours&#39;</span><span class="p">,</span>
                <span class="s1">&#39;AFN Zone Infiltration Volume&#39;</span><span class="p">,</span>
                <span class="s1">&#39;AFN Zone Infiltration Air Change Rate&#39;</span><span class="p">,</span>
                <span class="s1">&#39;AFN Zone Ventilation Volume&#39;</span><span class="p">,</span>
                <span class="s1">&#39;AFN Zone Ventilation Air Change Rate&#39;</span><span class="p">,</span>
                <span class="c1"># &#39;Zone Thermostat Operative Temperature [C](Hourly)&#39;,</span>
                <span class="c1"># &#39;Zone Operative Temperature [C](Hourly)&#39;,</span>
                <span class="s1">&#39;Zone Operative Temperature&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Whole Building:Facility Total HVAC Electricity Demand Rate&#39;</span><span class="p">,</span>
                <span class="c1"># &#39;Whole Building Facility Total HVAC Electricity Demand Rate (kWh)&#39;,</span>
                <span class="s1">&#39;Zone Thermal Comfort CEN 15251 Adaptive Model Running Average Outdoor Air Temperature&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Zone Thermal Comfort ASHRAE 55 Adaptive Model Running Average Outdoor Air Temperature&#39;</span><span class="p">,</span>
                <span class="s1">&#39;_Sch&#39;</span><span class="p">,</span>
                <span class="s1">&#39;VRF INDOOR UNIT DX COOLING COIL:Cooling Coil Total Cooling Rate&#39;</span><span class="p">,</span>
                <span class="s1">&#39;VRF INDOOR UNIT DX HEATING COIL:Heating Coil Heating Rate&#39;</span><span class="p">,</span>
                <span class="c1"># &#39;VRF OUTDOOR UNIT&#39;,</span>
                <span class="s1">&#39;VRF Heat Pump Cooling Electricity Rate&#39;</span><span class="p">,</span>
                <span class="s1">&#39;VRF Heat Pump Heating Electricity Rate&#39;</span><span class="p">,</span>
                <span class="s1">&#39;VRF Heat Pump Cooling Electricity Energy&#39;</span><span class="p">,</span>
                <span class="s1">&#39;VRF Heat Pump Heating Electricity Energy&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Heating Coil Heating Rate&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Cooling Coil Total Cooling Rate&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Zone Air Volume&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Zone Floor Area&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Zone Thermal Comfort Fanger Model PMV&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Zone Thermal Comfort Fanger Model PPD&#39;</span>
            <span class="p">]</span>

            <span class="n">summed_dataframes</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">flowchart_state_in_paper</span> <span class="o">=</span> <span class="s1">&#39;A.3&#39;</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">source_files</span><span class="p">:</span>

                <span class="c1"># with open(file) as csv_file:</span>
                <span class="c1">#     csv_reader = csv.reader(csv_file, delimiter=&#39;,&#39;)</span>
                <span class="c1">#     df = pd.DataFrame([csv_reader], index=True)</span>

                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>

                <span class="c1"># Step: filtering outputs to only standards</span>
                <span class="k">if</span> <span class="n">standard_outputs</span><span class="p">:</span>
                    <span class="n">keeplist</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cleaned_columns</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">j</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">SFdict</span><span class="p">[</span><span class="n">source_frequency</span><span class="p">]</span> <span class="ow">in</span> <span class="n">j</span><span class="p">:</span>
                                    <span class="n">keeplist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                    <span class="n">keeplist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">keeplist</span><span class="p">))</span>
                    <span class="n">keeplist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Date/Time&#39;</span><span class="p">)</span>
                    <span class="n">droplist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">keeplist</span><span class="p">))</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">droplist</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">output_cols_to_keep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">keeplist</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">output_cols_to_keep</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">SFdict</span><span class="p">[</span><span class="n">source_frequency</span><span class="p">]</span> <span class="ow">in</span> <span class="n">j</span><span class="p">:</span>
                                    <span class="n">keeplist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                    <span class="n">keeplist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">keeplist</span><span class="p">))</span>
                    <span class="n">keeplist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Date/Time&#39;</span><span class="p">)</span>
                    <span class="n">droplist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">keeplist</span><span class="p">))</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">droplist</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

                <span class="c1"># df[&#39;Source&#39;] = file.name</span>
                <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span>

                <span class="c1"># Step: df columns has no trailing space</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

                <span class="c1"># df[&#39;Date/Time_orig&#39;] = df[&#39;Date/Time&#39;].copy()</span>
                <span class="k">if</span> <span class="n">source_frequency</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;timestep&#39;</span><span class="p">,</span> <span class="s1">&#39;hourly&#39;</span><span class="p">]:</span>
                    <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;TBD1&#39;</span><span class="p">,</span> <span class="s1">&#39;Month/Day&#39;</span><span class="p">,</span> <span class="s1">&#39;TBD2&#39;</span><span class="p">,</span> <span class="s1">&#39;Hour&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date/Time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;TBD1&#39;</span><span class="p">,</span> <span class="s1">&#39;TBD2&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Month&#39;</span><span class="p">,</span> <span class="s1">&#39;Day&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Month/Day&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Hour&#39;</span><span class="p">,</span> <span class="s1">&#39;Minute&#39;</span><span class="p">,</span> <span class="s1">&#39;Second&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Hour&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">source_frequency</span> <span class="o">==</span> <span class="s1">&#39;daily&#39;</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Month/Day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date/Time&#39;</span><span class="p">]</span>
                    <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;Month&#39;</span><span class="p">,</span> <span class="s1">&#39;Day&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date/Time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">source_frequency</span> <span class="o">==</span> <span class="s1">&#39;monthly&#39;</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date/Time&#39;</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">source_frequency</span> <span class="o">==</span> <span class="s1">&#39;runperiod&#39;</span><span class="p">:</span>
                    <span class="k">pass</span>

                <span class="c1"># Step: managing different aggregations on columns</span>
                <span class="n">constantcols</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="s1">&#39;Zone Air Volume&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;Zone Floor Area&#39;</span>
                <span class="p">]:</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">j</span><span class="p">:</span>
                            <span class="n">constantcols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                <span class="n">constantcols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">constantcols</span><span class="p">))</span>
                <span class="n">constantcolsdict</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">constantcols</span><span class="p">)):</span>
                    <span class="n">tempdict</span> <span class="o">=</span> <span class="p">{</span><span class="n">constantcols</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="n">df</span><span class="p">[</span><span class="n">constantcols</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="mi">0</span><span class="p">]}</span>
                    <span class="n">constantcolsdict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">tempdict</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">source_frequency</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;timestep&#39;</span><span class="p">,</span> <span class="s1">&#39;hourly&#39;</span><span class="p">]:</span>
                    <span class="n">minute_df_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span>
                        <span class="n">df</span><span class="p">[</span>
                            <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Minute&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;00&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
                            <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Minute&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;None&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
                            <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Minute&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                            <span class="p">]</span>
                    <span class="p">)</span>

                <span class="n">agg_dict</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">aggregation_list_first</span><span class="p">:</span>
                    <span class="n">agg_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">i</span><span class="p">:</span> <span class="s1">&#39;first&#39;</span><span class="p">})</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">constantcols</span><span class="p">:</span>
                    <span class="n">agg_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">i</span><span class="p">:</span> <span class="s1">&#39;first&#39;</span><span class="p">})</span>

                <span class="n">df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">agg_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="s1">&#39;count&#39;</span><span class="p">})</span>

                <span class="n">aggregation_list_mean</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="s1">&#39;Environment:Site Outdoor Air Drybulb Temperature&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;Environment:Site Wind Speed&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;Environment:Site Outdoor Air Relative Humidity&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;EMS:Comfort Temperature&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;EMS:Adaptive Cooling Setpoint Temperature&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;EMS:Adaptive Heating Setpoint Temperature&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;EMS:Adaptive Cooling Setpoint Temperature_No Tolerance&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;EMS:Adaptive Heating Setpoint Temperature_No Tolerance&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;EMS:Ventilation Setpoint Temperature&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;EMS:Minimum Outdoor Temperature for ventilation&#39;</span><span class="p">,</span>
                    <span class="c1"># &#39;Zone Thermostat Operative Temperature&#39;,</span>
                    <span class="c1"># &#39;Zone Operative Temperature&#39;,</span>
                    <span class="s1">&#39;Zone Operative Temperature&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;Zone Thermal Comfort CEN 15251 Adaptive Model Running Average Outdoor Air Temperature&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;Zone Thermal Comfort ASHRAE 55 Adaptive Model Running Average Outdoor Air Temperature&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;Zone Thermal Comfort Fanger Model PMV&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;Zone Thermal Comfort Fanger Model PPD&#39;</span>
                <span class="p">]</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">aggregation_list_mean</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">i</span><span class="p">:</span>
                            <span class="n">agg_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">i</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">})</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">agg_dict</span><span class="p">:</span>
                        <span class="n">agg_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">i</span><span class="p">:</span> <span class="n">frequency_agg_func</span><span class="p">})</span>

                <span class="k">if</span> <span class="n">source_frequency</span> <span class="o">==</span> <span class="s1">&#39;timestep&#39;</span> <span class="ow">or</span> <span class="n">source_frequency</span> <span class="o">==</span> <span class="s1">&#39;hourly&#39;</span><span class="p">:</span>
                    <span class="c1"># todo timestep frequency to be tested</span>
                    <span class="k">if</span> <span class="n">frequency</span> <span class="o">==</span> <span class="s1">&#39;timestep&#39;</span><span class="p">:</span>
                        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Source&#39;</span><span class="p">,</span> <span class="s1">&#39;Month&#39;</span><span class="p">,</span> <span class="s1">&#39;Day&#39;</span><span class="p">,</span> <span class="s1">&#39;Hour&#39;</span><span class="p">,</span> <span class="s1">&#39;Minute&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">agg_dict</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Input data frequency in file </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s1"> is timestep &#39;</span>
                              <span class="sa">f</span><span class="s1">&#39;and requested frequency is also timestep, &#39;</span>
                              <span class="sa">f</span><span class="s1">&#39;therefore no aggregation will be performed. &#39;</span>
                              <span class="sa">f</span><span class="s1">&#39;The user needs to check the output rows number is correct.&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">frequency</span> <span class="o">==</span> <span class="s1">&#39;hourly&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">minute_df_len</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Source&#39;</span><span class="p">,</span> <span class="s1">&#39;Month&#39;</span><span class="p">,</span> <span class="s1">&#39;Day&#39;</span><span class="p">,</span> <span class="s1">&#39;Hour&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">agg_dict</span><span class="p">)</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Input data frequency in file </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s1"> is timestep &#39;</span>
                                  <span class="sa">f</span><span class="s1">&#39;and requested frequency is hourly, &#39;</span>
                                  <span class="sa">f</span><span class="s1">&#39;therefore aggregation will be performed. &#39;</span>
                                  <span class="sa">f</span><span class="s1">&#39;The user needs to check the output rows number is correct.&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Input data frequency in file </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s1"> is hourly, therefore no aggregation will be performed.&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">frequency</span> <span class="o">==</span> <span class="s1">&#39;daily&#39;</span><span class="p">:</span>
                        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Source&#39;</span><span class="p">,</span> <span class="s1">&#39;Month&#39;</span><span class="p">,</span> <span class="s1">&#39;Day&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">agg_dict</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">frequency</span> <span class="o">==</span> <span class="s1">&#39;monthly&#39;</span><span class="p">:</span>
                        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Source&#39;</span><span class="p">,</span> <span class="s1">&#39;Month&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">agg_dict</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">frequency</span> <span class="o">==</span> <span class="s1">&#39;runperiod&#39;</span><span class="p">:</span>
                        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Source&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">agg_dict</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">constantcolsdict</span><span class="p">:</span>
                        <span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">constantcolsdict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">summed_dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">source_frequency</span> <span class="o">==</span> <span class="s1">&#39;daily&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">frequency</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;timestep&#39;</span><span class="p">,</span> <span class="s1">&#39;hourly&#39;</span><span class="p">]:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Source frequency in file </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s1"> is daily, therefore timestep or hourly aggregations cannot be performed.&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">frequency</span> <span class="o">==</span> <span class="s1">&#39;daily&#39;</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Source frequency in file </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s1"> is daily, therefore no aggregation will be performed.&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">frequency</span> <span class="o">==</span> <span class="s1">&#39;monthly&#39;</span><span class="p">:</span>
                        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Source&#39;</span><span class="p">,</span> <span class="s1">&#39;Month&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">agg_dict</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">frequency</span> <span class="o">==</span> <span class="s1">&#39;runperiod&#39;</span><span class="p">:</span>
                        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Source&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">agg_dict</span><span class="p">)</span>
                    <span class="n">summed_dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">source_frequency</span> <span class="o">==</span> <span class="s1">&#39;monthly&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">frequency</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;timestep&#39;</span><span class="p">,</span> <span class="s1">&#39;hourly&#39;</span><span class="p">,</span> <span class="s1">&#39;daily&#39;</span><span class="p">]:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Source frequency in file </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s1"> is monthly, therefore timestep, hourly or daily aggregations cannot be performed.&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">frequency</span> <span class="o">==</span> <span class="s1">&#39;monthly&#39;</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Source frequency in file </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s1"> is monthly, therefore no aggregation will be performed.&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">frequency</span> <span class="o">==</span> <span class="s1">&#39;runperiod&#39;</span><span class="p">:</span>
                        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Source&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">agg_dict</span><span class="p">)</span>
                    <span class="n">summed_dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">source_frequency</span> <span class="o">==</span> <span class="s1">&#39;runperiod&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">frequency</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;timestep&#39;</span><span class="p">,</span> <span class="s1">&#39;hourly&#39;</span><span class="p">,</span> <span class="s1">&#39;daily&#39;</span><span class="p">,</span> <span class="s1">&#39;monthly&#39;</span><span class="p">]:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Source frequency in file </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s1"> is runperiod, therefore timestep, hourly, daily or monthly aggregations cannot be performed.&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">frequency</span> <span class="o">==</span> <span class="s1">&#39;runperiod&#39;</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Source frequency in file </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s1"> is runperiod, therefore no aggregation will be performed.&#39;</span><span class="p">)</span>
                    <span class="n">summed_dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">summed_dataframes</span><span class="p">)</span>
            <span class="c1"># df = df.round(decimals=2)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># todo amend order of columns</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="o">=</span><span class="n">source_concatenated_csv_filepath</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">cols</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span>

        <span class="n">checkpoint</span> <span class="o">=</span> <span class="n">checkpoint</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># Step: df columns has no trailing space</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

        <span class="c1"># Step: checking for NaNs and not correct aggregations based on count</span>
        <span class="n">is_NaN</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span>
        <span class="n">row_has_NaN</span> <span class="o">=</span> <span class="n">is_NaN</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">rows_with_NaN</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">row_has_NaN</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows_with_NaN</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Please bear in mind if you are using CSVs with multiple frequencies, you will get NaNs. The following rows have NaN values:&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">rows_with_NaN</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name_export_rows_with_NaN</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">rows_with_NaN</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name_export_rows_with_NaN</span><span class="si">}</span><span class="s1">[source_freq-</span><span class="si">{</span><span class="n">source_frequency</span><span class="si">}</span><span class="s1">[freq-</span><span class="si">{</span><span class="n">frequency</span><span class="si">}</span><span class="s1">[Rows_with_NaNs.xlsx&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">==</span> <span class="s1">&#39;hourly&#39;</span><span class="p">:</span>
            <span class="n">not_correct_agg</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">]</span>
            <span class="c1"># if len(not_correct_agg) &gt; 0:</span>
            <span class="c1">#     print(&#39;The following rows have not been correctly aggregated:&#39;)</span>
            <span class="c1">#     print(not_correct_agg)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">==</span> <span class="s1">&#39;daily&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">source_frequency</span> <span class="o">==</span> <span class="s1">&#39;hourly&#39;</span><span class="p">:</span>
                <span class="n">not_correct_agg</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">24</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">source_frequency</span> <span class="o">==</span> <span class="s1">&#39;daily&#39;</span><span class="p">:</span>
                <span class="n">not_correct_agg</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">]</span>

            <span class="c1"># if len(not_correct_agg) &gt; 0:</span>
            <span class="c1">#     print(&#39;The following rows have not been correctly aggregated:&#39;)</span>
            <span class="c1">#     print(not_correct_agg)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">==</span> <span class="s1">&#39;monthly&#39;</span><span class="p">:</span>

            <span class="c1"># not_correct_agg_list = []</span>
            <span class="c1"># from calendar import monthrange</span>
            <span class="c1"># for i in range(1, 13):</span>
            <span class="c1">#     monthly_df = df[</span>
            <span class="c1">#         (</span>
            <span class="c1">#                 (df[&#39;Month&#39;] == i) &amp;</span>
            <span class="c1">#                 (df[&#39;count&#39;] != (monthrange(2022, i)[1])*24)</span>
            <span class="c1">#         ) |</span>
            <span class="c1">#         (</span>
            <span class="c1">#                 (df[&#39;Month&#39;] == i) &amp;</span>
            <span class="c1">#                 (df[&#39;count&#39;] != 28 * 24) &amp;</span>
            <span class="c1">#                 (df[&#39;count&#39;] != 30 * 24) &amp;</span>
            <span class="c1">#                 (df[&#39;count&#39;] != 31 * 24)</span>
            <span class="c1">#         )</span>
            <span class="c1">#     ]</span>
            <span class="c1">#     not_correct_agg_list.append(monthly_df)</span>
            <span class="c1"># not_correct_agg = pd.concat(not_correct_agg_list)</span>

            <span class="k">if</span> <span class="n">source_frequency</span> <span class="o">==</span> <span class="s1">&#39;hourly&#39;</span><span class="p">:</span>
                <span class="n">not_correct_agg</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span>
                    <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">28</span> <span class="o">*</span> <span class="mi">24</span><span class="p">)</span> <span class="o">&amp;</span>
                    <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">30</span> <span class="o">*</span> <span class="mi">24</span><span class="p">)</span> <span class="o">&amp;</span>
                    <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">31</span> <span class="o">*</span> <span class="mi">24</span><span class="p">)</span>
                    <span class="p">]</span>
            <span class="k">if</span> <span class="n">source_frequency</span> <span class="o">==</span> <span class="s1">&#39;daily&#39;</span><span class="p">:</span>
                <span class="n">not_correct_agg</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span>
                    <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">28</span><span class="p">)</span> <span class="o">&amp;</span>
                    <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">30</span><span class="p">)</span> <span class="o">&amp;</span>
                    <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">31</span><span class="p">)</span>
                    <span class="p">]</span>
            <span class="c1"># if len(not_correct_agg) &gt; 0:</span>
            <span class="c1">#     print(&#39;The following rows have not been correctly aggregated:&#39;)</span>
            <span class="c1">#     print(not_correct_agg)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">==</span> <span class="s1">&#39;runperiod&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">source_frequency</span> <span class="o">==</span> <span class="s1">&#39;hourly&#39;</span><span class="p">:</span>
                <span class="n">not_correct_agg</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">8760</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">source_frequency</span> <span class="o">==</span> <span class="s1">&#39;daily&#39;</span><span class="p">:</span>
                <span class="n">not_correct_agg</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">365</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">source_frequency</span> <span class="o">==</span> <span class="s1">&#39;monthly&#39;</span><span class="p">:</span>
                <span class="n">not_correct_agg</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">12</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">source_frequency</span> <span class="o">==</span> <span class="s1">&#39;runperiod&#39;</span><span class="p">:</span>
                <span class="n">not_correct_agg</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">]</span>
            <span class="c1"># if len(not_correct_agg) &gt; 0:</span>
            <span class="c1">#     print(&#39;The following rows have not been correctly aggregated:&#39;)</span>
            <span class="c1">#     print(not_correct_agg)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">not_correct_agg</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The following rows have not been correctly aggregated:&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">not_correct_agg</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">name_export_rows_not_corr_agg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">not_correct_agg</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name_export_rows_not_corr_agg</span><span class="si">}</span><span class="s1">[source_freq-</span><span class="si">{</span><span class="n">source_frequency</span><span class="si">}</span><span class="s1">[freq-</span><span class="si">{</span><span class="n">frequency</span><span class="si">}</span><span class="s1">[Rows_not_corr_agg.xlsx&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;All rows have been correctly aggregated&#39;</span><span class="p">)</span>

        <span class="n">checkpoint</span> <span class="o">=</span> <span class="n">checkpoint</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">concatenated_csv_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># df.to_excel(</span>
            <span class="c1">#     f&#39;{concatenated_csv_name}&#39;</span>
            <span class="c1">#     f&#39;[freq-{frequency}&#39;</span>
            <span class="c1">#     f&#39;[frequency_agg_func-{frequency_agg_func}&#39;</span>
            <span class="c1">#     f&#39;[standard_outputs-{standard_outputs}&#39;</span>
            <span class="c1">#     f&#39;[CSVconcatenated.xlsx&#39;</span>
            <span class="c1"># )</span>
            <span class="k">if</span> <span class="n">drop_nan</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">concatenated_csv_name</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="sa">f</span><span class="s1">&#39;[srcfreq-</span><span class="si">{</span><span class="n">source_frequency</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="sa">f</span><span class="s1">&#39;[freq-</span><span class="si">{</span><span class="n">frequency</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="sa">f</span><span class="s1">&#39;[frequency_agg_func-</span><span class="si">{</span><span class="n">frequency_agg_func</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="sa">f</span><span class="s1">&#39;[standard_outputs-</span><span class="si">{</span><span class="n">standard_outputs</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="sa">f</span><span class="s1">&#39;[CSVconcatenated.csv&#39;</span>
            <span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows_with_NaN</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">rows_with_NaN</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">concatenated_csv_name</span><span class="si">}</span><span class="s1">&#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;[srcfreq-</span><span class="si">{</span><span class="n">source_frequency</span><span class="si">}</span><span class="s1">&#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;[freq-</span><span class="si">{</span><span class="n">frequency</span><span class="si">}</span><span class="s1">&#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;[frequency_agg_func-</span><span class="si">{</span><span class="n">frequency_agg_func</span><span class="si">}</span><span class="s1">&#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;[standard_outputs-</span><span class="si">{</span><span class="n">standard_outputs</span><span class="si">}</span><span class="s1">&#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;[Rows_with_NaNs.csv&#39;</span>
                    <span class="p">)</span>
            <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No NaN has been found.&#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">not_correct_agg</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">not_correct_agg</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">concatenated_csv_name</span><span class="si">}</span><span class="s1">&#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;[srcfreq-</span><span class="si">{</span><span class="n">source_frequency</span><span class="si">}</span><span class="s1">&#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;[freq-</span><span class="si">{</span><span class="n">frequency</span><span class="si">}</span><span class="s1">&#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;[frequency_agg_func-</span><span class="si">{</span><span class="n">frequency_agg_func</span><span class="si">}</span><span class="s1">&#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;[standard_outputs-</span><span class="si">{</span><span class="n">standard_outputs</span><span class="si">}</span><span class="s1">&#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;[Rows_not_corr_agg.csv&#39;</span>
                    <span class="p">)</span>
            <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;All rows have been correctly aggregated&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">checkpoint</span> <span class="o">=</span> <span class="n">checkpoint</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># if len(rows_with_NaN) &gt; 0 or len(not_correct_agg) &gt; 0:</span>
        <span class="c1">#     f = open(f&#39;{concatenated_csv_name}[freq-{frequency}[frequency_agg_func-{frequency_agg_func}[standard_outputs-{standard_outputs}[Report.txt&#39;, &quot;w+&quot;)</span>
        <span class="c1">#     if len(rows_with_NaN) &gt; 0:</span>
        <span class="c1">#         f.write(&#39;The following rows have NaN values:\r\n&#39;)</span>
        <span class="c1">#         dfAsString = rows_with_NaN.to_string(header=True, index=True)</span>
        <span class="c1">#         f.write(dfAsString)</span>
        <span class="c1">#     if len(not_correct_agg) &gt; 0:</span>
        <span class="c1">#         f.write(&#39;The following rows have not been correctly aggregate:\r\n&#39;)</span>
        <span class="c1">#         dfAsString = not_correct_agg.to_string(header=True, index=True)</span>
        <span class="c1">#         f.write(dfAsString)</span>
        <span class="c1">#     f.close()</span>

        <span class="c1"># df.to_excel(&#39;checkpoint_00.xlsx&#39;)</span>

        <span class="c1"># Step: scanning zones for occupied_zone_list</span>
        <span class="c1"># OpTempColumn = [i for i in df.columns if &#39;Zone Thermostat Operative Temperature [C](Hourly)&#39; in i]</span>
        <span class="c1"># if len(OpTempColumn) == 0:</span>
        <span class="c1">#     OpTempColumn = [i for i in df.columns if &#39;Zone Operative Temperature [C](Hourly)&#39; in i]</span>

        <span class="c1"># occupied_zone_list = [i.split(&#39; &#39;)[0][:-5]</span>
        <span class="c1">#                        for i</span>
        <span class="c1">#                        in [i</span>
        <span class="c1">#                              for i</span>
        <span class="c1">#                              in df.columns</span>
        <span class="c1">#                              if &#39;Zone Thermostat Operative Temperature [C](Hourly)&#39; in i</span>
        <span class="c1">#                              ]</span>
        <span class="c1">#                        ]</span>
        <span class="c1"># if len(occupied_zone_list) == 0:</span>

        <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

        <span class="c1">#Step: scanning occupied zones</span>
        <span class="n">block_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">building</span> <span class="o">=</span> <span class="n">get_building</span><span class="p">(</span><span class="n">idf_path</span><span class="p">)</span>
        <span class="c1"># building = get_building(&#39;OSM_SmallOffice_exHVAC.idf&#39;)</span>

        <span class="n">allzones</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">Name</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">building</span><span class="o">.</span><span class="n">idfobjects</span><span class="p">[</span><span class="s1">&#39;ZONE&#39;</span><span class="p">]]</span>

        <span class="n">occupied_zone_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">building</span><span class="o">.</span><span class="n">idfobjects</span><span class="p">[</span><span class="s1">&#39;SPACELIST&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># spacenames_for_ems_uniquekey = []</span>
                <span class="n">spacenames</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="c1"># spacenames_for_ems_uniquekey_people = []</span>
                <span class="n">zonenames_from_space</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">people</span> <span class="ow">in</span> <span class="n">building</span><span class="o">.</span><span class="n">idfobjects</span><span class="p">[</span><span class="s1">&#39;PEOPLE&#39;</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">spacelist</span> <span class="ow">in</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">building</span><span class="o">.</span><span class="n">idfobjects</span><span class="p">[</span><span class="s1">&#39;SPACELIST&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">Name</span> <span class="o">==</span> <span class="n">people</span><span class="o">.</span><span class="n">Zone_or_ZoneList_or_Space_or_SpaceList_Name</span><span class="p">]:</span>
                        <span class="k">for</span> <span class="n">space</span> <span class="ow">in</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">building</span><span class="o">.</span><span class="n">idfobjects</span><span class="p">[</span><span class="s1">&#39;SPACE&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">Space_Type</span> <span class="o">==</span> <span class="n">spacelist</span><span class="o">.</span><span class="n">Name</span><span class="p">]:</span>
                            <span class="c1"># spacenames_for_ems_uniquekey.append(f&#39;{space.Name} {spacelist.Name}&#39;)</span>
                            <span class="n">spacenames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">space</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span>
                            <span class="c1"># spacenames_for_ems_uniquekey_people.append(f&#39;{space.Name} {people.Name}&#39;)</span>
                            <span class="c1"># occupiedZones_orig_osm.append(space.Zone_Name)</span>
                            <span class="n">occupied_zone_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">space</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">zone</span> <span class="ow">in</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">building</span><span class="o">.</span><span class="n">idfobjects</span><span class="p">[</span><span class="s1">&#39;ZONE&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">space</span><span class="o">.</span><span class="n">Zone_Name</span> <span class="o">==</span> <span class="n">i</span><span class="o">.</span><span class="n">Name</span><span class="p">]:</span>
                                <span class="n">zonenames_from_space</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">zone</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span>
                                <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">zone</span><span class="o">.</span><span class="n">Name</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">space</span><span class="o">.</span><span class="n">Name</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">zone</span> <span class="ow">in</span> <span class="n">allzones</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">zone</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">col</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                            <span class="n">occupied_zone_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">zone</span> <span class="ow">in</span> <span class="n">allzones</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">zone</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">col</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                        <span class="n">occupied_zone_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span>
        <span class="n">occupied_zone_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">occupied_zone_list</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="nb">all</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">occupied_zone_list</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">block_zone_hierarchy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s1">&#39;Regarding occupied zones, we have not found a clear hierarchical pattern of blocks and zones. &#39;</span>
                    <span class="s1">&#39;The zones we have found are:&#39;</span>
                <span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">occupied_zone_list</span><span class="p">)</span>
                <span class="n">block_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Please enter all Blocks separated by semicolon (;): &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">))</span>
                <span class="n">hierarchy_dict</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">block_list</span><span class="p">:</span>
                    <span class="n">temp_zones</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                        <span class="n">i</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Please enter the zones for </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">, considering these cannot be at the same time in more than one block, separated by semicolon (;): &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">))</span>
                    <span class="n">temp_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">temp_zones</span><span class="p">}</span>
                    <span class="n">hierarchy_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">temp_dict</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># hierarchy_dict = block_zone_hierarchy</span>
                <span class="n">hierarchy_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span> <span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">block_zone_hierarchy</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">hierarchy_dict</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">hierarchy_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
                    <span class="c1"># df.columns = [k.replace(j.upper().replace(&#39; &#39;, &#39;_&#39;), i + &#39;_&#39; + j) for k in df.columns]</span>

            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Finally, the occupied zones after renaming them following the pattern block_zone are:&#39;</span><span class="p">)</span>
            <span class="n">occupied_zone_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">hierarchy_dict</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">hierarchy_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">occupied_zone_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="c1"># print(f&#39;{i}_{j}&#39;)</span>

        <span class="c1"># if len(occupied_zone_list) == 0:</span>
        <span class="c1">#     occupied_zone_list = [i.split(&#39; &#39;)[0][:-5]</span>
        <span class="c1">#                     for i</span>
        <span class="c1">#                     in [i</span>
        <span class="c1">#                         for i</span>
        <span class="c1">#                         in df.columns</span>
        <span class="c1">#                         if &#39;Operative Temperature&#39; in i</span>
        <span class="c1">#                         ]</span>
        <span class="c1">#                     ]</span>
        <span class="c1"># occupied_zone_list = [i.split(&#39; &#39;)[0][:-5] for i in OpTempColumn]</span>
        <span class="n">occupied_zone_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">occupied_zone_list</span><span class="p">))</span>

        <span class="n">occBZlist_underscore</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">occupied_zone_list</span><span class="p">]</span>

        <span class="c1"># Step: scanning zones for hvac_zone_list</span>

        <span class="n">hvac_zone_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">Zone_or_ZoneList_Name</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">building</span><span class="o">.</span><span class="n">idfobjects</span><span class="p">[</span><span class="s1">&#39;ZoneControl:Thermostat&#39;</span><span class="p">]]</span>

        <span class="n">hvac_zone_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">hvac_zone_list</span><span class="p">))</span>
        <span class="n">hvac_zone_list_underscore</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">hvac_zone_list</span><span class="p">]</span>

        <span class="c1"># Step: scanning blocks for block_list</span>
        <span class="n">block_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">occupied_zone_list</span><span class="p">]))</span>

        <span class="c1"># Step: renaming all columns containing BlockX_ZoneY patterns to BlockX:ZoneY.</span>
        <span class="n">renamezonesdict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">occBZlist_underscore</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">occBZlist_underscore</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="n">temp</span> <span class="o">=</span> <span class="p">{</span><span class="n">j</span><span class="p">:</span> <span class="n">j</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">occBZlist_underscore</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">occupied_zone_list</span><span class="p">[</span><span class="n">i</span><span class="p">])}</span>
                    <span class="n">renamezonesdict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">renamezonesdict</span><span class="p">)</span>

        <span class="c1"># Step: converting jules to Wh if any</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;VRF OUTDOOR UNIT&#39;</span> <span class="ow">in</span> <span class="n">i</span> <span class="ow">and</span> <span class="s1">&#39;[J]&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">:</span>
                <span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="mi">3600</span>

        <span class="n">renamedict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;VRF OUTDOOR UNIT&#39;</span> <span class="ow">in</span> <span class="n">i</span> <span class="ow">and</span> <span class="s1">&#39;[J]&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">:</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;[J]&#39;</span><span class="p">,</span> <span class="s1">&#39;[W]&#39;</span><span class="p">)}</span>
                <span class="n">renamedict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">renamedict</span><span class="p">)</span>

        <span class="c1"># Step: generating total (heating+cooling) energy consumption columns</span>
        <span class="n">BZoutputDict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;VRF INDOOR UNIT&#39;</span><span class="p">:</span> <span class="s1">&#39;Total Energy Demand (Wh)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;VRF OUTDOOR UNIT&#39;</span><span class="p">:</span> <span class="s1">&#39;Total Energy Consumption (Wh)&#39;</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">BZoutputDict</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">output</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">block_zone</span> <span class="ow">in</span> <span class="n">hvac_zone_list</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">block_zone</span><span class="si">}</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">BZoutputDict</span><span class="p">[</span><span class="n">output</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; (summed)_pymod&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span>
                        <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">block_zone</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">i</span> <span class="ow">and</span> <span class="s1">&#39;_pymod&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">i</span><span class="p">]</span>
                    <span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># df.to_excel(&#39;checkpoint_01.xlsx&#39;)</span>

        <span class="c1"># Step: generating block and or building summed or mean columns</span>
        <span class="n">outputdict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="c1"># &#39;Zone Thermostat Operative Temperature [C](Hourly)&#39;: &#39;Zone Thermostat Operative Temperature (°C)&#39;,</span>
            <span class="c1"># &#39;Zone Operative Temperature [C](Hourly)&#39;: &#39;Zone Operative Temperature (°C)&#39;,</span>
            <span class="s1">&#39;Zone Operative Temperature&#39;</span><span class="p">:</span> <span class="s1">&#39;Zone Operative Temperature (°C)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Comfortable Hours_No Applicability&#39;</span><span class="p">:</span> <span class="s1">&#39;Comfortable Hours_No Applicability (h)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Comfortable Hours_Applicability&#39;</span><span class="p">:</span> <span class="s1">&#39;Comfortable Hours_Applicability (h)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Discomfortable Applicable Hot Hours&#39;</span><span class="p">:</span> <span class="s1">&#39;Discomfortable Applicable Hot Hours (h)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Discomfortable Applicable Cold Hours&#39;</span><span class="p">:</span> <span class="s1">&#39;Discomfortable Applicable Cold Hours (h)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Discomfortable Non Applicable Hot Hours&#39;</span><span class="p">:</span> <span class="s1">&#39;Discomfortable Non Applicable Hot Hours (h)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Discomfortable Non Applicable Cold Hours&#39;</span><span class="p">:</span> <span class="s1">&#39;Discomfortable Non Applicable Cold Hours (h)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Ventilation Hours&#39;</span><span class="p">:</span> <span class="s1">&#39;Ventilation Hours (h)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;AFN Zone Infiltration Volume&#39;</span><span class="p">:</span> <span class="s1">&#39;AFN Zone Infiltration Volume (m3)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;AFN Zone Infiltration Air Change Rate&#39;</span><span class="p">:</span> <span class="s1">&#39;AFN Zone Infiltration Air Change Rate (ach)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;AFN Zone Ventilation Volume&#39;</span><span class="p">:</span> <span class="s1">&#39;AFN Zone Ventilation Volume (m3)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;AFN Zone Ventilation Air Change Rate&#39;</span><span class="p">:</span> <span class="s1">&#39;AFN Zone Ventilation Air Change Rate (ach)&#39;</span><span class="p">,</span>

            <span class="s1">&#39;Cooling Coil Total Cooling Rate&#39;</span><span class="p">:</span> <span class="s1">&#39;Cooling Coil Total Cooling Rate (Wh)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Heating Coil Heating Rate&#39;</span><span class="p">:</span> <span class="s1">&#39;Heating Coil Heating Rate (Wh)&#39;</span><span class="p">,</span>

            <span class="c1"># &#39;VRF Heat Pump Cooling Electricity Rate&#39;: &#39;VRF Heat Pump Cooling Electricity Rate (Wh)&#39;,</span>
            <span class="c1"># &#39;VRF Heat Pump Heating Electricity Rate&#39;: &#39;VRF Heat Pump Heating Electricity Rate (Wh)&#39;,</span>
            <span class="s1">&#39;VRF Heat Pump Cooling Electricity Energy&#39;</span><span class="p">:</span> <span class="s1">&#39;VRF Heat Pump Cooling Electricity Energy (Wh)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;VRF Heat Pump Heating Electricity Energy&#39;</span><span class="p">:</span> <span class="s1">&#39;VRF Heat Pump Heating Electricity Energy (Wh)&#39;</span><span class="p">,</span>

            <span class="s1">&#39;Coil&#39;</span><span class="p">:</span> <span class="s1">&#39;Total Energy Demand (Wh)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;VRF OUTDOOR UNIT&#39;</span><span class="p">:</span> <span class="s1">&#39;Total Energy Consumption (Wh)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Zone Thermal Comfort Fanger Model PMV&#39;</span><span class="p">:</span> <span class="s1">&#39;PMV&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Zone Thermal Comfort Fanger Model PPD&#39;</span><span class="p">:</span> <span class="s1">&#39;PPD (%)&#39;</span>
        <span class="p">}</span>
        <span class="n">outputdict_normalisation</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Zone Air Volume&#39;</span><span class="p">:</span> <span class="s1">&#39;Zone Air Volume (m3)&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Zone Floor Area&#39;</span><span class="p">:</span> <span class="s1">&#39;Zone Floor Area (m2)&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="c1"># todo paper aqui</span>
        <span class="k">if</span> <span class="n">level_excluded_zones</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The occupied zones are:&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">occupied_zone_list</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The hvac zones zones are:&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">hvac_zone_list</span><span class="p">)</span>
            <span class="n">level_excluded_zones</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;If you want to exclude some zones from level computations, please enter the names separated by semicolon (;), otherwise hit enter:&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">level_excluded_zones</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">level_excluded_zones</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
                <span class="n">not_valid_zones</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">level_excluded_zones</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">occupied_zone_list</span><span class="p">:</span>
                        <span class="n">not_valid_zones</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">not_valid_zones</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The following excluded zones do not exist:&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="n">not_valid_zones</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The zones you can exclude from level computations are:&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="n">occupied_zone_list</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">level_excluded_zones</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">level_excluded_zones</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">not_valid_zones</span><span class="p">]</span>
                    <span class="n">level_excluded_zones</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;If you want to exclude some zones from level computations, please enter the names separated by semicolon (;), otherwise hit enter:&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">))</span>
                    <span class="n">not_valid_zones</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">level_excluded_zones</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">occupied_zone_list</span><span class="p">:</span>
                            <span class="n">not_valid_zones</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">level_excluded_zones</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No zones have been excluded from level computations.&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">level_excluded_zones</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">level_excluded_zones</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">level_excluded_zones</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No zones have been excluded from level computations.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">normalised_energy_units</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">outputdict_normalisation</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="s1">&#39;block&#39;</span> <span class="ow">in</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">level</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">block_list</span><span class="p">:</span>
                        <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">block</span><span class="si">}</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;_Total_&#39;</span> <span class="o">+</span> <span class="n">outputdict_normalisation</span><span class="p">[</span><span class="n">output</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; (summed)_pymod&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span>
                            <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span>
                             <span class="n">block</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="n">output</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s1">&#39;_pymod&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">level_excluded_zones</span><span class="p">))]</span>
                        <span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="s1">&#39;building&#39;</span> <span class="ow">in</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">level</span><span class="p">):</span>
                    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Building_Total_&#39;</span> <span class="o">+</span> <span class="n">outputdict_normalisation</span><span class="p">[</span><span class="n">output</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; (summed)_pymod&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span>
                        <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s1">&#39;_pymod&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">i</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">level_excluded_zones</span><span class="p">))]</span>
                    <span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="s1">&#39;block&#39;</span> <span class="ow">in</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">level</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">block_list</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">outputdict</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">output</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]):</span>
                        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="s1">&#39;sum&#39;</span> <span class="ow">in</span> <span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">level_agg_func</span><span class="p">):</span>
                            <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">block</span><span class="si">}</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;_Total_&#39;</span> <span class="o">+</span> <span class="n">outputdict</span><span class="p">[</span><span class="n">output</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; (summed)_pymod&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span>
                                <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">block</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="n">output</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s1">&#39;_pymod&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">level_excluded_zones</span><span class="p">))]</span>
                            <span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span> <span class="ow">in</span> <span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">level_agg_func</span><span class="p">):</span>
                            <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">block</span><span class="si">}</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;_Total_&#39;</span> <span class="o">+</span> <span class="n">outputdict</span><span class="p">[</span><span class="n">output</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; (mean)_pymod&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span>
                                <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
                                 <span class="k">if</span> <span class="n">block</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="n">output</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s1">&#39;_pymod&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
                            <span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="s1">&#39;building&#39;</span> <span class="ow">in</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">level</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">outputdict</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">output</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="s1">&#39;sum&#39;</span> <span class="ow">in</span> <span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">level_agg_func</span><span class="p">):</span>
                        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Building_Total_&#39;</span> <span class="o">+</span> <span class="n">outputdict</span><span class="p">[</span><span class="n">output</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; (summed)_pymod&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span>
                            <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s1">&#39;_pymod&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">i</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">level_excluded_zones</span><span class="p">))]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span> <span class="ow">in</span> <span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">level_agg_func</span><span class="p">):</span>
                        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Building_Total_&#39;</span> <span class="o">+</span> <span class="n">outputdict</span><span class="p">[</span><span class="n">output</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; (mean)_pymod&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span>
                            <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s1">&#39;_pymod&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">i</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">level_excluded_zones</span><span class="p">))]]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># df.to_excel(&#39;checkpoint_02.xlsx&#39;)</span>

        <span class="c1"># Step: renaming energy units</span>
        <span class="n">renamedict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;[W]&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">:</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;[W]&#39;</span><span class="p">,</span> <span class="s1">&#39;(Wh)&#39;</span><span class="p">)}</span>
                <span class="n">renamedict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">renamedict</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">normalised_energy_units</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">energy_units_in_kwh</span><span class="p">:</span>
                <span class="n">energy_units</span> <span class="o">=</span> <span class="s1">&#39;(kWh/m2)&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">energy_units</span> <span class="o">=</span> <span class="s1">&#39;(Wh/m2)&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">energy_units_in_kwh</span><span class="p">:</span>
                <span class="n">energy_units</span> <span class="o">=</span> <span class="s1">&#39;(kWh)&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">energy_units</span> <span class="o">=</span> <span class="s1">&#39;(Wh)&#39;</span>

        <span class="c1"># Step: normalising energy units if requested</span>
        <span class="k">if</span> <span class="n">normalised_energy_units</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;(Wh)&#39;</span> <span class="ow">in</span> <span class="n">i</span> <span class="ow">or</span> <span class="s1">&#39;(WH)&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">hvac_zone_list_underscore</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">i</span><span class="p">:</span>
                            <span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">[[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s1">&#39;Zone Floor Area&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="n">j</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">lower</span><span class="p">()][</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">block_list</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">k</span> <span class="o">+</span> <span class="s1">&#39;_Total_&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">:</span>
                            <span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span>
                                <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
                                 <span class="k">if</span> <span class="s1">&#39;Zone Floor Area&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                                 <span class="ow">and</span> <span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;_Total_&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">lower</span><span class="p">()][</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="k">if</span> <span class="s1">&#39;Building_Total_&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">:</span>
                        <span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span>
                            <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
                             <span class="k">if</span> <span class="s1">&#39;Zone Floor Area&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                             <span class="ow">and</span> <span class="s1">&#39;Building_Total_&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">lower</span><span class="p">()][</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="s1">&#39;building&#39;</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">level</span><span class="p">):</span>
                        <span class="c1"># try:</span>
                        <span class="k">if</span> <span class="s1">&#39;Whole Building:Facility Total HVAC Electricity Demand Rate&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
                            <span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">[[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s1">&#39;Zone Floor Area&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">and</span> <span class="s1">&#39;Building_Total_&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">lower</span><span class="p">()][</span><span class="mi">0</span><span class="p">]]</span>
                        <span class="c1"># except IndexError:</span>
                        <span class="c1">#     try:</span>
                        <span class="c1">#         if &#39;Whole Building Facility Total HVAC Electricity Demand Rate&#39; in i:</span>
                        <span class="c1">#             df[i] = df[i] / df[</span>
                        <span class="c1">#                 [i for i in df.columns</span>
                        <span class="c1">#                  if &#39;Zone Floor Area&#39; in i</span>
                        <span class="c1">#                  and &#39;Building_Total_&#39;.lower() in i.lower()][0]]</span>
                        <span class="c1">#     except IndexError:</span>
                        <span class="c1">#         print(&#39;Facility Total HVAC Electricity Demand Rate has not been computed in normalisez energy consumption.&#39;)</span>

        <span class="c1"># df.to_excel(&#39;checkpoint_03-0.xlsx&#39;)</span>

        <span class="c1"># Step: converting Wh to kWh if requested</span>
        <span class="k">if</span> <span class="n">energy_units_in_kwh</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;(Wh)&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">col</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
                    <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span>

        <span class="c1"># df.to_excel(&#39;checkpoint_03-1.xlsx&#39;)</span>

        <span class="n">energy_units_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;(Wh)&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(Wh)&#39;</span><span class="p">,</span> <span class="n">energy_units</span><span class="p">)}</span>
                <span class="n">energy_units_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">energy_units_dict</span><span class="p">)</span>

        <span class="c1"># df.to_excel(&#39;checkpoint_03-2.xlsx&#39;)</span>

        <span class="c1"># Step: removing &#39;_pymod&#39; from columns</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_axis</span><span class="p">(</span>
            <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="n">c</span><span class="p">[:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;_pymod&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="p">],</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Step: splitting and managing column names</span>
        <span class="n">fixed_columns_orig</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;Model&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ComfStand&#39;</span><span class="p">,</span>
            <span class="s1">&#39;CAT&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ComfMod&#39;</span><span class="p">,</span>
            <span class="s1">&#39;HVACmode&#39;</span><span class="p">,</span>
            <span class="s1">&#39;VentCtrl&#39;</span><span class="p">,</span>
            <span class="s1">&#39;VSToffset&#39;</span><span class="p">,</span>
            <span class="s1">&#39;MinOToffset&#39;</span><span class="p">,</span>
            <span class="s1">&#39;MaxWindSpeed&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ASTtol&#39;</span><span class="p">,</span>
            <span class="s1">&#39;NameSuffix&#39;</span><span class="p">,</span>
            <span class="s1">&#39;EPW&#39;</span>
        <span class="p">]</span>
        <span class="n">fixed_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">fixed_columns_orig</span><span class="p">]</span>

        <span class="n">df</span><span class="p">[</span><span class="n">fixed_columns</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;SOURCE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># df[&#39;Model&#39;] = df[&#39;Model&#39;].str[:-6]</span>
        <span class="c1"># df[&#39;ComfStand&#39;] = df[&#39;ComfStand&#39;].str[3:]</span>
        <span class="c1"># df[&#39;Category&#39;] = df[&#39;Category&#39;].str[3:]</span>
        <span class="c1"># df[&#39;ComfMod&#39;] = df[&#39;ComfMod&#39;].str[3:]</span>
        <span class="c1"># df[&#39;HVACmode&#39;] = df[&#39;HVACmode&#39;].str[3:]</span>
        <span class="c1"># df[&#39;VentCtrl&#39;] = df[&#39;VentCtrl&#39;].str[3:]</span>
        <span class="c1"># df[&#39;VSToffset&#39;] = df[&#39;VSToffset&#39;].str[3:]</span>
        <span class="c1"># df[&#39;MinOToffset&#39;] = df[&#39;MinOToffset&#39;].str[3:]</span>
        <span class="c1"># df[&#39;MaxWindSpeed&#39;] = df[&#39;MaxWindSpeed&#39;].str[3:]</span>
        <span class="c1"># df[&#39;ASTtol&#39;] = df[&#39;ASTtol&#39;].str[3:]</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;EPW&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;EPW&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;SOURCE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;SOURCE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>

        <span class="c1"># Step: splitting EPW names if requested</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">split_epw_names</span> <span class="o">=</span> <span class="n">split_epw_names</span>

        <span class="k">if</span> <span class="n">split_epw_names</span><span class="p">:</span>
            <span class="n">cols_epw_base</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">&#39;EPW_Country_name&#39;</span><span class="p">,</span>
                <span class="s1">&#39;EPW_City_or_subcountry&#39;</span><span class="p">,</span>
                <span class="s1">&#39;EPW_Scenario-Year&#39;</span>
            <span class="p">]</span>
            <span class="n">df</span><span class="p">[</span><span class="n">cols_epw_base</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;EPW&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">cols_epw_ext</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="s1">&#39;EPW_Scenario&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;EPW_Year&#39;</span><span class="p">,</span>
                <span class="p">]</span>
                <span class="n">df</span><span class="p">[</span><span class="n">cols_epw_ext</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;EPW_Scenario-Year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;All CSVs are for present scenario.&#39;</span><span class="p">)</span>
                <span class="n">df</span><span class="p">[</span><span class="s1">&#39;EPW_Scenario&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Present&#39;</span>
                <span class="n">df</span><span class="p">[</span><span class="s1">&#39;EPW_Year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Present&#39;</span>
            <span class="n">df</span><span class="o">.</span><span class="n">EPW_Year</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">EPW_Year</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;Present&#39;</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">RangeIndex</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))])</span>

        <span class="k">if</span> <span class="n">drop_nan</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">)</span>
            <span class="c1"># df = df.set_index([pd.RangeIndex(len(df))])</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">])</span>

        <span class="c1"># Step: do not know what it is this for</span>
        <span class="n">frequency_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;monthly&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;MONTH&#39;</span><span class="p">],</span>
            <span class="s1">&#39;daily&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;DAY&#39;</span><span class="p">,</span> <span class="s1">&#39;MONTH&#39;</span><span class="p">],</span>
            <span class="s1">&#39;hourly&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;DAY&#39;</span><span class="p">,</span> <span class="s1">&#39;MONTH&#39;</span><span class="p">,</span> <span class="s1">&#39;HOUR&#39;</span><span class="p">],</span>
            <span class="s1">&#39;timestep&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;DAY&#39;</span><span class="p">,</span> <span class="s1">&#39;MONTH&#39;</span><span class="p">,</span> <span class="s1">&#39;HOUR&#39;</span><span class="p">,</span> <span class="s1">&#39;MINUTE&#39;</span><span class="p">]</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">!=</span> <span class="s1">&#39;runperiod&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">frequency_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                    <span class="c1"># if df.loc[j, i] == &#39;&#39;:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>

                <span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">fillchar</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">RangeIndex</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))])</span>

        <span class="c1"># df[&#39;Hour_mod&#39;] = df[&#39;HOUR&#39;].copy()</span>
        <span class="k">if</span> <span class="s1">&#39;hourly&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="ow">or</span> <span class="s1">&#39;timestep&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">:</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;HOUR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;HOUR&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">fillchar</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>
        <span class="c1"># df[&#39;Hour_mod&#39;] = df[&#39;Hour_mod&#39;].str.replace(&#39;.0&#39;, &#39;&#39;).str.pad(width=2, side=&#39;left&#39;, fillchar=&#39;0&#39;)</span>
        <span class="c1"># df[&#39;HOUR&#39;] = df[&#39;Hour_mod&#39;]</span>

        <span class="c1"># todo test timestep</span>
        <span class="k">if</span> <span class="s1">&#39;monthly&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">:</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;MONTH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;MONTH&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
            <span class="c1"># df[&#39;Date/Time&#39;] = df[&#39;MONTH&#39;]</span>
        <span class="k">if</span> <span class="s1">&#39;daily&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">:</span>
            <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;DAY&#39;</span><span class="p">,</span> <span class="s1">&#39;MONTH&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;DAY&#39;</span><span class="p">,</span> <span class="s1">&#39;MONTH&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
            <span class="c1"># df[&#39;Date/Time&#39;] = df[[&#39;DAY&#39;, &#39;MONTH&#39;]].agg(&#39;/&#39;.join, axis=1)</span>
        <span class="k">if</span> <span class="s1">&#39;hourly&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">:</span>
            <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;DAY&#39;</span><span class="p">,</span> <span class="s1">&#39;MONTH&#39;</span><span class="p">,</span> <span class="s1">&#39;HOUR&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;DAY&#39;</span><span class="p">,</span> <span class="s1">&#39;MONTH&#39;</span><span class="p">,</span> <span class="s1">&#39;HOUR&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
            <span class="c1"># df[&#39;Date/Time&#39;] = df[[&#39;DAY&#39;, &#39;MONTH&#39;]].agg(&#39;/&#39;.join, axis=1) + &#39; &#39; + df[&#39;HOUR&#39;] + &#39;:00&#39;</span>
        <span class="c1"># if &#39;timestep&#39; in self.frequency:</span>
        <span class="c1">#     df[[&#39;DAY&#39;, &#39;MONTH&#39;, &#39;HOUR&#39;, &#39;MINUTE&#39;]] = df[[&#39;DAY&#39;, &#39;MONTH&#39;, &#39;HOUR&#39;, &#39;MINUTE&#39;]].astype(str)</span>
        <span class="c1">#     df[&#39;Date/Time&#39;] = (df[[&#39;DAY&#39;, &#39;MONTH&#39;]].agg(&#39;/&#39;.join, axis=1) +</span>
        <span class="c1">#                             &#39; &#39; +</span>
        <span class="c1">#                             df[[&#39;HOUR&#39;, &#39;MINUTE&#39;]].agg(&#39;:&#39;.join, axis=1))</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">RangeIndex</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))])</span>

        <span class="c1"># Step: managing EPW names if requested</span>
        <span class="c1"># if manage_epw_names:</span>
        <span class="c1">#     rcpdict = {</span>
        <span class="c1">#         &#39;Present&#39;: [&#39;Presente&#39;, &#39;Actual&#39;, &#39;Present&#39;, &#39;Current&#39;],</span>
        <span class="c1">#         &#39;RCP2.6&#39;: [&#39;RCP2.6&#39;, &#39;RCP26&#39;],</span>
        <span class="c1">#         &#39;RCP4.5&#39;: [&#39;RCP4.5&#39;, &#39;RCP45&#39;],</span>
        <span class="c1">#         &#39;RCP6.0&#39;: [&#39;RCP6.0&#39;, &#39;RCP60&#39;],</span>
        <span class="c1">#         &#39;RCP8.5&#39;: [&#39;RCP8.5&#39;, &#39;RCP85&#39;]</span>
        <span class="c1">#     }</span>
        <span class="c1">#</span>
        <span class="c1">#     rcp = []</span>
        <span class="c1">#     for i in rcpdict:</span>
        <span class="c1">#         for j in range(len(rcpdict[i])):</span>
        <span class="c1">#             rcp.append(rcpdict[i][j])</span>
        <span class="c1">#</span>
        <span class="c1">#     rcp_present = []</span>
        <span class="c1">#     for i in rcpdict[&#39;Present&#39;]:</span>
        <span class="c1">#         rcp_present.append(i)</span>
        <span class="c1">#</span>
        <span class="c1">#     df[&#39;EPW_mod&#39;] = df[&#39;EPW&#39;].str.split(&#39;_&#39;)</span>
        <span class="c1">#</span>
        <span class="c1">#     for i in range(len(df[&#39;EPW_mod&#39;])):</span>
        <span class="c1">#         for j in df.loc[i, &#39;EPW_mod&#39;]:</span>
        <span class="c1">#             if len(j) == 2:</span>
        <span class="c1">#                 df.loc[i, &#39;EPW_CountryCode&#39;] = j</span>
        <span class="c1">#             else:</span>
        <span class="c1">#                 df.loc[i, &#39;EPW_CountryCode&#39;] = np.nan</span>
        <span class="c1">#</span>
        <span class="c1">#             for k in rcpdict:</span>
        <span class="c1">#                 for m in range(len(rcpdict[k])):</span>
        <span class="c1">#                     if j in rcpdict[k][m]:</span>
        <span class="c1">#                         df.loc[i, &#39;EPW_Scenario&#39;] = k</span>
        <span class="c1">#                     else:</span>
        <span class="c1">#                         df.loc[i, &#39;EPW_Scenario&#39;] = np.nan</span>
        <span class="c1">#</span>
        <span class="c1">#         df.loc[i, &#39;EPW_Year&#39;] = np.nan</span>
        <span class="c1">#</span>
        <span class="c1">#</span>
        <span class="c1"># if manage_epw_names:</span>
        <span class="c1">#     for i in range(len(df[&#39;EPW_mod&#39;])):</span>
        <span class="c1">#         for j in df.loc[i, &#39;EPW_mod&#39;]:</span>
        <span class="c1">#             if j in rcp_present:</span>
        <span class="c1">#                 df.loc[i, &#39;EPW_Year&#39;] = &#39;Present&#39;</span>
        <span class="c1">#             elif j in rcp:</span>
        <span class="c1">#                 continue</span>
        <span class="c1">#             elif j.isnumeric():</span>
        <span class="c1">#                 df.loc[i, &#39;EPW_Year&#39;] = int(j)</span>
        <span class="c1">#             elif len(j) == 2:</span>
        <span class="c1">#                 continue</span>
        <span class="c1">#             else:</span>
        <span class="c1">#                 df.loc[i, &#39;EPW_City_or_subcountry&#39;] = j.capitalize()</span>
        <span class="c1">#</span>
        <span class="c1">#     df = df.drop([&#39;EPW_mod&#39;], axis=1)</span>

        <span class="c1"># Step: re-ordering the columns</span>
        <span class="c1"># cols = df.columns.tolist()</span>
        <span class="c1">#</span>
        <span class="c1"># if self.frequency == &#39;runperiod&#39;:</span>
        <span class="c1">#     # this 1 is Source</span>
        <span class="c1">#     freq_extension = 1</span>
        <span class="c1"># else:</span>
        <span class="c1">#     freq_extension = 1 + len(frequency_dict[self.frequency])</span>
        <span class="c1">#</span>
        <span class="c1"># if split_epw_names:</span>
        <span class="c1">#     epw_extension = 5</span>
        <span class="c1"># else:</span>
        <span class="c1">#     epw_extension = 0</span>
        <span class="c1">#</span>
        <span class="c1"># if self.frequency == &#39;runperiod&#39;:</span>
        <span class="c1">#     adj_extension = -3</span>
        <span class="c1"># if self.frequency == &#39;monthly&#39;:</span>
        <span class="c1">#     adj_extension = -4</span>
        <span class="c1"># if self.frequency == &#39;daily&#39;:</span>
        <span class="c1">#     adj_extension = -5</span>
        <span class="c1"># if self.frequency == &#39;hourly&#39;:</span>
        <span class="c1">#     adj_extension = -6</span>
        <span class="c1">#</span>
        <span class="c1"># # if source_frequency == &#39;daily&#39;:</span>
        <span class="c1"># #     adj_source_freq = 5</span>
        <span class="c1"># # else:</span>
        <span class="c1"># #     adj_source_freq = 0</span>
        <span class="c1">#</span>
        <span class="c1"># # the 2 is for Date/Time and MONTH/DAY</span>
        <span class="c1"># temp_num = -(len(fixed_columns) + 2 + freq_extension + epw_extension + adj_extension)</span>
        <span class="c1"># cols = cols[temp_num:] + cols[:temp_num]</span>
        <span class="c1"># # cols = cols[5:] + cols[:5]</span>
        <span class="c1"># df = df[cols]</span>

        <span class="c1"># num_cols = df._get_numeric_data().columns.to_list()</span>
        <span class="c1"># num_cols.remove(&#39;count&#39;)</span>
        <span class="c1"># num_cols = sorted(num_cols)</span>

        <span class="n">cols_model</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SOURCE&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">fixed_columns</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;COUNT&#39;</span><span class="p">]</span>

        <span class="n">cols_date</span> <span class="o">=</span> <span class="n">aggregation_list_first</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">cols_date</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cols_date</span><span class="p">]</span>
        <span class="n">cols_date</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;SOURCE&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">split_epw_names</span><span class="p">:</span>
            <span class="n">cols_cat</span> <span class="o">=</span> <span class="n">cols_model</span> <span class="o">+</span> <span class="n">cols_epw_base</span> <span class="o">+</span> <span class="n">cols_epw_ext</span> <span class="o">+</span> <span class="n">cols_date</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cols_cat</span> <span class="o">=</span> <span class="n">cols_model</span> <span class="o">+</span> <span class="n">cols_date</span>

        <span class="n">cols_num</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cols_cat</span><span class="p">]</span>
        <span class="c1"># cols_num = cols_num[1:] + cols_num[:1]</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">cols_cat</span> <span class="o">+</span> <span class="n">cols_num</span><span class="p">]</span>

        <span class="c1"># Step: scanning data structure</span>
        <span class="c1"># temp_df_datastr = df.copy()</span>
        <span class="c1"># temp_df_datastr = temp_df_datastr[fixed_columns]</span>
        <span class="c1"># mindex = pd.MultiIndex.from_frame(temp_df_datast)</span>

        <span class="c1"># data_structure_dict = {}</span>
        <span class="c1"># temp_df_datastr = df.copy()</span>
        <span class="c1"># for i in list(dict.fromkeys(df[&#39;Model&#39;])):</span>
        <span class="c1">#     temp_dict =</span>
        <span class="c1">#     temp_df_datastr = temp_df_datastr[temp_df_datastr[&#39;Model&#39;].str.isin([i])]</span>
        <span class="c1">#     for j in list(dict.fromkeys(temp_df_datastr[&#39;ComfStand&#39;])):</span>

        <span class="c1"># if split_epw_names:</span>
        <span class="c1">#     df = df[cols_model+cols_epw_base+cols_epw_ext+cols_date+num_cols]</span>
        <span class="c1"># else:</span>
        <span class="c1">#     df = df[cols_model+cols_date+num_cols]</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">RangeIndex</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rename_cols</span> <span class="o">=</span> <span class="n">rename_cols</span>

        <span class="k">if</span> <span class="n">rename_cols</span><span class="p">:</span>
            <span class="n">renaming_criteria_bz</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;EMS:Comfortable Hours_No Applicability&#39;</span><span class="p">:</span> <span class="s1">&#39;Comfortable Hours_No Applicability (h)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;EMS:Comfortable Hours_Applicability&#39;</span><span class="p">:</span> <span class="s1">&#39;Comfortable Hours_Applicability (h)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;EMS:Discomfortable Applicable Hot Hours&#39;</span><span class="p">:</span> <span class="s1">&#39;Discomfortable Applicable Hot Hours (h)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;EMS:Discomfortable Applicable Cold Hours&#39;</span><span class="p">:</span> <span class="s1">&#39;Discomfortable Applicable Cold Hours (h)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;EMS:Discomfortable Non Applicable Hot Hours&#39;</span><span class="p">:</span> <span class="s1">&#39;Discomfortable Non Applicable Hot Hours (h)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;EMS:Discomfortable Non Applicable Cold Hours&#39;</span><span class="p">:</span> <span class="s1">&#39;Discomfortable Non Applicable Cold Hours (h)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Zone Air Volume&#39;</span><span class="p">:</span> <span class="s1">&#39;Zone Air Volume (m3)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Zone Floor Area&#39;</span><span class="p">:</span> <span class="s1">&#39;Zone Floor Area (m2)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;EMS:Ventilation Hours&#39;</span><span class="p">:</span> <span class="s1">&#39;Ventilation Hours (h)&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;AFN Zone Infiltration Volume [m3](</span><span class="si">{</span><span class="n">SFdict</span><span class="p">[</span><span class="n">source_frequency</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">:</span> <span class="s1">&#39;AFN Zone Infiltration Volume (m3)&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;AFN Zone Infiltration Air Change Rate [ach](</span><span class="si">{</span><span class="n">SFdict</span><span class="p">[</span><span class="n">source_frequency</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">:</span> <span class="s1">&#39;AFN Zone Infiltration Air Change Rate (ach)&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;AFN Zone Ventilation Volume [m3](</span><span class="si">{</span><span class="n">SFdict</span><span class="p">[</span><span class="n">source_frequency</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">:</span> <span class="s1">&#39;AFN Zone Ventilation Volume (m3)&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;AFN Zone Ventilation Air Change Rate [ach](</span><span class="si">{</span><span class="n">SFdict</span><span class="p">[</span><span class="n">source_frequency</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">:</span> <span class="s1">&#39;AFN Zone Ventilation Air Change Rate (ach)&#39;</span><span class="p">,</span>
                <span class="c1"># f&#39;Zone Thermostat Operative Temperature [C]({SFdict[source_frequency]})&#39;: &#39;Zone Thermostat Operative Temperature (°C)&#39;,</span>
                <span class="sa">f</span><span class="s1">&#39;Zone Operative Temperature [C](</span><span class="si">{</span><span class="n">SFdict</span><span class="p">[</span><span class="n">source_frequency</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">:</span> <span class="s1">&#39;Zone Operative Temperature (°C)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Zone Operative Temperature&#39;</span><span class="p">:</span> <span class="s1">&#39;Zone Operative Temperature (°C)&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;Zone Thermal Comfort CEN 15251 Adaptive Model Running Average Outdoor Air Temperature [C](</span><span class="si">{</span><span class="n">SFdict</span><span class="p">[</span><span class="n">source_frequency</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">:</span>
                    <span class="s1">&#39;EN16798-1 Running mean outdoor temperature (°C)&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;Zone Thermal Comfort ASHRAE 55 Adaptive Model Running Average Outdoor Air Temperature [C](</span><span class="si">{</span><span class="n">SFdict</span><span class="p">[</span><span class="n">source_frequency</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">:</span>
                    <span class="s1">&#39;ASHRAE 55 Running mean outdoor temperature (°C)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;AHST_Sch&#39;</span><span class="p">:</span> <span class="s1">&#39;AHST_Sch&#39;</span><span class="p">,</span>
                <span class="s1">&#39;ACST_Sch&#39;</span><span class="p">:</span> <span class="s1">&#39;ACST_Sch&#39;</span><span class="p">,</span>
                <span class="s1">&#39;VRF Heat Pump Cooling Electricity Energy&#39;</span><span class="p">:</span> <span class="s1">&#39;Cooling Energy Consumption&#39;</span><span class="p">,</span>
                <span class="s1">&#39;VRF Heat Pump Heating Electricity Energy&#39;</span><span class="p">:</span> <span class="s1">&#39;Heating Energy Consumption&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Heating Coil Heating Rate&#39;</span><span class="p">:</span> <span class="s1">&#39;Heating Energy Demand&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Cooling Coil Total Cooling Rate&#39;</span><span class="p">:</span> <span class="s1">&#39;Cooling Energy Demand&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Zone Thermal Comfort Fanger Model PMV&#39;</span><span class="p">:</span> <span class="s1">&#39;PMV&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Zone Thermal Comfort Fanger Model PPD&#39;</span><span class="p">:</span> <span class="s1">&#39;PPD (%)&#39;</span>
            <span class="p">}</span>

            <span class="n">renaming_criteria</span> <span class="o">=</span> <span class="p">{</span>
                <span class="c1"># &#39;Date/Time&#39;,</span>
                <span class="sa">f</span><span class="s1">&#39;Environment:Site Outdoor Air Drybulb Temperature [C](</span><span class="si">{</span><span class="n">SFdict</span><span class="p">[</span><span class="n">source_frequency</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">:</span>
                    <span class="s1">&#39;Site Outdoor Air Drybulb Temperature (°C)&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;Environment:Site Wind Speed [m/s](</span><span class="si">{</span><span class="n">SFdict</span><span class="p">[</span><span class="n">source_frequency</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">:</span> <span class="s1">&#39;Site Wind Speed (m/s)&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;Environment:Site Outdoor Air Relative Humidity [%](</span><span class="si">{</span><span class="n">SFdict</span><span class="p">[</span><span class="n">source_frequency</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">:</span>
                    <span class="s1">&#39;Site Outdoor Air Relative Humidity (%)&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;EMS:Comfort Temperature [C](</span><span class="si">{</span><span class="n">SFdict</span><span class="p">[</span><span class="n">source_frequency</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">:</span> <span class="s1">&#39;Comfort Temperature (°C)&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;EMS:Adaptive Cooling Setpoint Temperature [C](</span><span class="si">{</span><span class="n">SFdict</span><span class="p">[</span><span class="n">source_frequency</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">:</span> <span class="s1">&#39;Adaptive Cooling Setpoint Temperature (°C)&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;EMS:Adaptive Heating Setpoint Temperature [C](</span><span class="si">{</span><span class="n">SFdict</span><span class="p">[</span><span class="n">source_frequency</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">:</span> <span class="s1">&#39;Adaptive Heating Setpoint Temperature (°C)&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;EMS:Adaptive Cooling Setpoint Temperature_No Tolerance [C](</span><span class="si">{</span><span class="n">SFdict</span><span class="p">[</span><span class="n">source_frequency</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">:</span>
                    <span class="s1">&#39;Adaptive Cooling Setpoint Temperature_No Tolerance (°C)&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;EMS:Adaptive Heating Setpoint Temperature_No Tolerance [C](</span><span class="si">{</span><span class="n">SFdict</span><span class="p">[</span><span class="n">source_frequency</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">:</span>
                    <span class="s1">&#39;Adaptive Heating Setpoint Temperature_No Tolerance (°C)&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;EMS:Ventilation Setpoint Temperature [C](</span><span class="si">{</span><span class="n">SFdict</span><span class="p">[</span><span class="n">source_frequency</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">:</span> <span class="s1">&#39;Ventilation Setpoint Temperature (°C)&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;EMS:Minimum Outdoor Temperature for ventilation [C](</span><span class="si">{</span><span class="n">SFdict</span><span class="p">[</span><span class="n">source_frequency</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">:</span>
                    <span class="s1">&#39;Minimum Outdoor Temperature for ventilation (°C)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Whole Building:Facility Total HVAC Electricity Demand Rate&#39;</span><span class="p">:</span>
                    <span class="s1">&#39;Whole Building Facility Total HVAC Electricity Demand Rate&#39;</span><span class="p">,</span>

            <span class="p">}</span>

            <span class="n">all_cols_renamed</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="n">all_cols_renamed</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;SOURCE&#39;</span><span class="p">:</span> <span class="s1">&#39;Source&#39;</span><span class="p">})</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">fixed_columns_orig</span><span class="p">:</span>
                <span class="n">all_cols_renamed</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">i</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span> <span class="n">i</span><span class="p">})</span>

            <span class="n">all_cols_renamed</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;COUNT&#39;</span><span class="p">:</span> <span class="s1">&#39;Count&#39;</span><span class="p">})</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cols_date</span><span class="p">:</span>
                <span class="n">all_cols_renamed</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">i</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span> <span class="n">i</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()})</span>

            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">crit</span> <span class="ow">in</span> <span class="n">renaming_criteria_bz</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;(summed)&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">col</span> <span class="ow">and</span> <span class="s1">&#39;(mean)&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">crit</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">col</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
                            <span class="k">for</span> <span class="n">block_zone</span> <span class="ow">in</span> <span class="n">occupied_zone_list</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">block_zone</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">col</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
                                    <span class="k">if</span> <span class="n">energy_units</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">col</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
                                        <span class="n">temp</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="n">block_zone</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">renaming_criteria_bz</span><span class="p">[</span><span class="n">crit</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">energy_units</span><span class="p">}</span>
                                        <span class="n">all_cols_renamed</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="n">temp</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="n">block_zone</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">renaming_criteria_bz</span><span class="p">[</span><span class="n">crit</span><span class="p">]}</span>
                                        <span class="n">all_cols_renamed</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">crit</span> <span class="ow">in</span> <span class="n">renaming_criteria</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;(summed)&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">col</span> <span class="ow">and</span> <span class="s1">&#39;(mean)&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">crit</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">col</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
                            <span class="k">if</span> <span class="n">energy_units</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">col</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
                                <span class="n">temp</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="n">renaming_criteria</span><span class="p">[</span><span class="n">crit</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">energy_units</span><span class="p">}</span>
                                <span class="n">all_cols_renamed</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">temp</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="n">renaming_criteria</span><span class="p">[</span><span class="n">crit</span><span class="p">]}</span>
                                <span class="n">all_cols_renamed</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>

            <span class="n">renaming_criteria_block</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;VRF Heat Pump Cooling Electricity Energy&#39;</span><span class="p">:</span> <span class="s1">&#39;Cooling Energy Consumption&#39;</span><span class="p">,</span>
                <span class="s1">&#39;VRF Heat Pump Heating Electricity Energy&#39;</span><span class="p">:</span> <span class="s1">&#39;Heating Energy Consumption&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Heating Coil Heating Rate&#39;</span><span class="p">:</span> <span class="s1">&#39;Heating Energy Demand&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Cooling Coil Total Cooling Rate&#39;</span><span class="p">:</span> <span class="s1">&#39;Cooling Energy Demand&#39;</span>
            <span class="p">}</span>

            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">crit</span> <span class="ow">in</span> <span class="n">renaming_criteria_block</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">block_list</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">block</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;_Total_&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="n">crit</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">col</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
                            <span class="k">if</span> <span class="s1">&#39;(summed)&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
                                <span class="n">temp</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">block</span><span class="si">}</span><span class="s1">_Total_</span><span class="si">{</span><span class="n">renaming_criteria_block</span><span class="p">[</span><span class="n">crit</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">energy_units</span><span class="si">}</span><span class="s1"> (summed)&#39;</span><span class="p">}</span>
                                <span class="n">all_cols_renamed</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="s1">&#39;(mean)&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
                                <span class="n">temp</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">block</span><span class="si">}</span><span class="s1">_Total_</span><span class="si">{</span><span class="n">renaming_criteria_block</span><span class="p">[</span><span class="n">crit</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">energy_units</span><span class="si">}</span><span class="s1"> (mean)&#39;</span><span class="p">}</span>
                                <span class="n">all_cols_renamed</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s1">&#39;Building_Total_&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="n">crit</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">col</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
                        <span class="k">if</span> <span class="s1">&#39;(summed)&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
                            <span class="n">temp</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Building_Total_</span><span class="si">{</span><span class="n">renaming_criteria_block</span><span class="p">[</span><span class="n">crit</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">energy_units</span><span class="si">}</span><span class="s1"> (summed)&#39;</span><span class="p">}</span>
                            <span class="n">all_cols_renamed</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                        <span class="k">if</span> <span class="s1">&#39;(mean)&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
                            <span class="n">temp</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Building_Total_</span><span class="si">{</span><span class="n">renaming_criteria_block</span><span class="p">[</span><span class="n">crit</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">energy_units</span><span class="si">}</span><span class="s1"> (mean)&#39;</span><span class="p">}</span>
                            <span class="n">all_cols_renamed</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>

            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">all_cols_renamed</span><span class="p">)</span>

        <span class="c1"># dropping Operative temperature columns which are 0 for all rows or nan</span>
        <span class="c1"># optemp_df = df.filter(regex=&#39;Operative Temperature&#39;)</span>
        <span class="c1"># optemp_to_drop = []</span>
        <span class="c1"># optemp_to_drop.extend(optemp_df.columns[optemp_df.isna().any()].tolist())</span>
        <span class="c1"># for i in optemp_df.columns:</span>
        <span class="c1">#     if (optemp_df[i] == 0).all():</span>
        <span class="c1">#         optemp_to_drop.append(i)</span>
        <span class="c1"># df = df.drop(optemp_to_drop, axis=1)</span>

        <span class="n">available_vars_to_gather</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;Model&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ComfStand&#39;</span><span class="p">,</span>
            <span class="s1">&#39;CAT&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ComfMod&#39;</span><span class="p">,</span>
            <span class="s1">&#39;HVACmode&#39;</span><span class="p">,</span>
            <span class="s1">&#39;VentCtrl&#39;</span><span class="p">,</span>
            <span class="s1">&#39;VSToffset&#39;</span><span class="p">,</span>
            <span class="s1">&#39;MinOToffset&#39;</span><span class="p">,</span>
            <span class="s1">&#39;MaxWindSpeed&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ASTtol&#39;</span><span class="p">,</span>
            <span class="s1">&#39;NameSuffix&#39;</span><span class="p">,</span>
            <span class="s1">&#39;EPW&#39;</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="n">split_epw_names</span><span class="p">:</span>
            <span class="n">available_vars_to_gather</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
                <span class="s1">&#39;EPW_Country_name&#39;</span><span class="p">,</span>
                <span class="s1">&#39;EPW_City_or_subcountry&#39;</span><span class="p">,</span>
                <span class="s1">&#39;EPW_Scenario-Year&#39;</span><span class="p">,</span>
                <span class="s1">&#39;EPW_Scenario&#39;</span><span class="p">,</span>
                <span class="s1">&#39;EPW_Year&#39;</span>
            <span class="p">])</span>
            <span class="n">available_vars_to_gather</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;EPW&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">frequency</span> <span class="o">==</span> <span class="s1">&#39;monthly&#39;</span><span class="p">:</span>
            <span class="n">available_vars_to_gather</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;Month&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">frequency</span> <span class="o">==</span> <span class="s1">&#39;daily&#39;</span><span class="p">:</span>
            <span class="n">available_vars_to_gather</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;Month&#39;</span><span class="p">,</span> <span class="s1">&#39;Day&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">frequency</span> <span class="o">==</span> <span class="s1">&#39;hourly&#39;</span><span class="p">:</span>
            <span class="n">available_vars_to_gather</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;Month&#39;</span><span class="p">,</span> <span class="s1">&#39;Day&#39;</span><span class="p">,</span> <span class="s1">&#39;Hour&#39;</span><span class="p">])</span>



        <span class="c1"># todo Step: remove PMV-PPD columns if the column only have null values</span>

        <span class="c1"># df = df.round(decimals=2)</span>

        <span class="n">cols_to_clean</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cols_for_multiindex</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">suggested_vars_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">available_vars_to_gather</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="n">cols_to_clean</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">]])))</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="p">((</span><span class="s1">&#39;_X&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">]]))[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;_X&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">]]))[</span><span class="mi">1</span><span class="p">])):</span>
                    <span class="n">cols_to_clean</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cols_for_multiindex</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="n">suggested_vars_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">i</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">]))})</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="n">cols_to_clean</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">]])))</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="p">((</span><span class="s1">&#39;_X&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">]]))[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;_X&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">]]))[</span><span class="mi">1</span><span class="p">])):</span>
                    <span class="n">cols_to_clean</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cols_for_multiindex</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="n">suggested_vars_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">i</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">]))})</span>

        <span class="n">checkpoint</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hvac_zone_list</span> <span class="o">=</span> <span class="n">hvac_zone_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">occupied_zone_list</span> <span class="o">=</span> <span class="n">occupied_zone_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">available_vars_to_gather</span> <span class="o">=</span> <span class="n">available_vars_to_gather</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block_list</span> <span class="o">=</span> <span class="n">block_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_backup</span> <span class="o">=</span> <span class="n">df</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">frequency</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cols_to_clean</span> <span class="o">=</span> <span class="n">cols_to_clean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cols_for_multiindex</span> <span class="o">=</span> <span class="n">cols_for_multiindex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suggested_vars_dict</span> <span class="o">=</span> <span class="n">suggested_vars_dict</span>

        <span class="c1"># df.to_excel(&#39;checkpoint_04.xlsx&#39;)</span>

        <span class="c1"># todo pop up when process ends; by default True</span>

<div class="viewcode-block" id="Table.gather_vars_query">
<a class="viewcode-back" href="../../../../accim.data.postprocessing.html#accim.data.postprocessing.main.Table.gather_vars_query">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">gather_vars_query</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">vars_to_gather</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Used to inform the user of the variables suitable to be analysed and the available</span>
<span class="sd">        options from a certain gathered variables</span>

<span class="sd">        :param vars_to_gather: A list of variables.</span>
<span class="sd">        :type vars_to_gather: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">temp_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The categorical columns which have different values and those values are:&#39;</span><span class="p">)</span>
        <span class="c1"># print(*self.cols_for_multiindex, sep=&#39;\n&#39;)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">suggested_vars_dict</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">suggested_vars_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vars_to_gather</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">temp_df</span><span class="p">[</span><span class="s1">&#39;col_to_pivot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_df</span><span class="p">[</span><span class="n">vars_to_gather</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">vars_to_gather_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">temp_df</span><span class="p">[</span><span class="s1">&#39;col_to_pivot&#39;</span><span class="p">]))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The available options resulting from the data entered in vars_to_gather would be: &#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="n">vars_to_gather_values</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">temp_df</span></div>


<div class="viewcode-block" id="Table.format_table">
<a class="viewcode-back" href="../../../../accim.data.postprocessing.html#accim.data.postprocessing.main.Table.format_table">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">format_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">type_of_table</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span>
                     <span class="n">custom_cols</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="c1"># custom_rows: list = None,</span>
                     <span class="c1"># split_epw_names: bool = False</span>
                     <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It filters the columns.</span>

<span class="sd">        :param type_of_table: To get previously set out tables. Can be &#39;energy demand&#39; or &#39;comfort hours&#39;.</span>
<span class="sd">        :param custom_cols: A list of strings.</span>
<span class="sd">        The strings will be used as a filter, and the columns that match will be selected.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">custom_cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">custom_cols</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># if custom_rows is None:</span>
        <span class="c1">#     custom_rows = []</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_backup</span>

        <span class="c1"># self.split_epw_names = split_epw_names</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">indexcols</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;Date/time&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Model&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ComfStand&#39;</span><span class="p">,</span>
            <span class="s1">&#39;CAT&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ComfMod&#39;</span><span class="p">,</span>
            <span class="s1">&#39;HVACmode&#39;</span><span class="p">,</span>
            <span class="s1">&#39;VentCtrl&#39;</span><span class="p">,</span>
            <span class="s1">&#39;VSToffset&#39;</span><span class="p">,</span>
            <span class="s1">&#39;MinOToffset&#39;</span><span class="p">,</span>
            <span class="s1">&#39;MaxWindSpeed&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ASTtol&#39;</span><span class="p">,</span>
            <span class="s1">&#39;NameSuffix&#39;</span><span class="p">,</span>
            <span class="s1">&#39;EPW&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Source&#39;</span><span class="p">,</span>
            <span class="c1"># &#39;col_to_pivot&#39;</span>
        <span class="p">]</span>
        <span class="c1"># todo to be updated with source frequency</span>
        <span class="k">if</span> <span class="s1">&#39;runperiod&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indexcols</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;Date/time&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;monthly&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indexcols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Month&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;daily&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indexcols</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;Month&#39;</span><span class="p">,</span> <span class="s1">&#39;Day&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;hourly&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indexcols</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;Month&#39;</span><span class="p">,</span> <span class="s1">&#39;Day&#39;</span><span class="p">,</span> <span class="s1">&#39;Hour&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;timestep&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indexcols</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;Month&#39;</span><span class="p">,</span> <span class="s1">&#39;Day&#39;</span><span class="p">,</span> <span class="s1">&#39;Hour&#39;</span><span class="p">,</span> <span class="s1">&#39;Minute&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_epw_names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indexcols</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
                <span class="s1">&#39;EPW_Country_name&#39;</span><span class="p">,</span>
                <span class="s1">&#39;EPW_City_or_subcountry&#39;</span><span class="p">,</span>
                <span class="s1">&#39;EPW_Scenario-Year&#39;</span><span class="p">,</span>
                <span class="s1">&#39;EPW_Scenario&#39;</span><span class="p">,</span>
                <span class="s1">&#39;EPW_Year&#39;</span>
            <span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">val_cols</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">type_of_table</span> <span class="o">==</span> <span class="s1">&#39;custom&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">custom_col</span> <span class="ow">in</span> <span class="n">custom_cols</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">custom_col</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">col</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">val_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">type_of_table</span> <span class="o">==</span> <span class="s1">&#39;energy demand&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rename_cols</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">val_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span>
                                 <span class="s1">&#39;Total Energy Demand&#39;</span> <span class="ow">in</span> <span class="n">col</span> <span class="ow">or</span>
                                 <span class="s1">&#39;Cooling Energy Demand&#39;</span> <span class="ow">in</span> <span class="n">col</span> <span class="ow">or</span>
                                 <span class="s1">&#39;Heating Energy Demand&#39;</span> <span class="ow">in</span> <span class="n">col</span>
                                 <span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">val_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span>
                                 <span class="s1">&#39;Cooling Coil Total Cooling Rate&#39;</span> <span class="ow">in</span> <span class="n">col</span> <span class="ow">or</span>
                                 <span class="s1">&#39;Heating Coil Heating Rate&#39;</span> <span class="ow">in</span> <span class="n">col</span> <span class="ow">or</span>
                                 <span class="s1">&#39;Total Energy Demand&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">type_of_table</span> <span class="o">==</span> <span class="s1">&#39;comfort hours&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">val_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s1">&#39;Comfortable Hours_No Applicability&#39;</span> <span class="ow">in</span> <span class="n">col</span>
                             <span class="ow">or</span> <span class="s1">&#39;Comfortable Hours_Applicability&#39;</span> <span class="ow">in</span> <span class="n">col</span>
                             <span class="ow">or</span> <span class="s1">&#39;Discomfortable Applicable Hot Hours&#39;</span> <span class="ow">in</span> <span class="n">col</span>
                             <span class="ow">or</span> <span class="s1">&#39;Discomfortable Applicable Cold Hours&#39;</span> <span class="ow">in</span> <span class="n">col</span>
                             <span class="ow">or</span> <span class="s1">&#39;Discomfortable Non Applicable Hot Hours&#39;</span> <span class="ow">in</span> <span class="n">col</span>
                             <span class="ow">or</span> <span class="s1">&#39;Discomfortable Non Applicable Cold Hours&#39;</span> <span class="ow">in</span> <span class="n">col</span>
                             <span class="ow">or</span> <span class="s1">&#39;Ventilation Hours&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">type_of_table</span> <span class="o">==</span> <span class="s1">&#39;temperature&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">val_cols</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span>
                <span class="k">if</span> <span class="s1">&#39;Adaptive Cooling Setpoint Temperature_No Tolerance (°C)&#39;</span> <span class="ow">in</span> <span class="n">col</span>
                   <span class="ow">or</span> <span class="s1">&#39;Adaptive Heating Setpoint Temperature_No Tolerance (°C)&#39;</span> <span class="ow">in</span> <span class="n">col</span>
                   <span class="ow">or</span> <span class="s1">&#39;Building_Total_Zone Operative Temperature (°C) (mean)&#39;</span> <span class="ow">in</span> <span class="n">col</span>
                   <span class="ow">or</span> <span class="s1">&#39;Building_Total_Cooling Energy Demand&#39;</span> <span class="ow">in</span> <span class="n">col</span>
                   <span class="ow">or</span> <span class="s1">&#39;Building_Total_Heating Energy Demand&#39;</span> <span class="ow">in</span> <span class="n">col</span>
            <span class="p">]</span>
            <span class="n">RMOT_col</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span>
                <span class="k">if</span> <span class="s1">&#39;Running mean outdoor temperature&#39;</span> <span class="ow">in</span> <span class="n">col</span>
            <span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">val_cols</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">RMOT_col</span><span class="p">])</span>
        <span class="c1"># elif type_of_table == &#39;all&#39;:</span>
        <span class="c1">#     # self.val_cols = list(set(self.df.columns) - set(self.indexcols))</span>
        <span class="c1">#     self.val_cols = []</span>
        <span class="c1">#     for col in self.df.columns:</span>
        <span class="c1">#         if col not in self.indexcols:</span>
        <span class="c1">#             self.val_cols.append(col)</span>

        <span class="k">if</span> <span class="n">type_of_table</span> <span class="o">==</span> <span class="s1">&#39;custom&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;You have not selected any column to make the custom table. &#39;</span>
                                 <span class="s1">&#39;Please check the columns you want to select. &#39;</span>
                                 <span class="s1">&#39;To see the full list of columns, enter print(&quot;name of class instance&quot;.df.columns)&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">type_of_table</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">indexcols</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_cols</span><span class="p">]</span>

        <span class="n">checkpoint</span> <span class="o">=</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="Table.custom_order">
<a class="viewcode-back" href="../../../../accim.data.postprocessing.html#accim.data.postprocessing.main.Table.custom_order">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">custom_order</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">ordered_list</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">column_to_order</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Used to order the string values of a column in a custom order.</span>

<span class="sd">        :param ordered_list: A list os strings.</span>
<span class="sd">            Used to order the string values of a column in a custom order.</span>
<span class="sd">        :type ordered_list: list</span>
<span class="sd">        :param column_to_order: A string.</span>
<span class="sd">            It should be the column whose string values should be ordered.</span>
<span class="sd">        :type column_to_order: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">pandas.api.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">CategoricalDtype</span>

        <span class="k">if</span> <span class="n">ordered_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ordered_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ordered_list</span> <span class="o">=</span> <span class="n">ordered_list</span>

        <span class="n">custom_order</span> <span class="o">=</span> <span class="n">CategoricalDtype</span><span class="p">(</span>
            <span class="n">ordered_list</span><span class="p">,</span>
            <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">column_to_order</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">column_to_order</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">custom_order</span><span class="p">)</span></div>


    <span class="c1"># def hvac_zone_list(self):</span>
    <span class="c1">#     return self.hvac_zone_list</span>
    <span class="c1">#</span>
    <span class="c1"># def occupied_zone_list(self):</span>
    <span class="c1">#     return self.occupied_zone_list</span>
    <span class="c1">#</span>
    <span class="c1"># def block_list(self):</span>
    <span class="c1">#     return block_list()</span>

<div class="viewcode-block" id="Table.wrangled_table">
<a class="viewcode-back" href="../../../../accim.data.postprocessing.html#accim.data.postprocessing.main.Table.wrangled_table">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">wrangled_table</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">reshaping</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">vars_to_gather</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">baseline</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">comparison_mode</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;others compared to baseline&#39;</span><span class="p">],</span>
            <span class="n">comparison_cols</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">check_index_and_cols</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">vars_to_keep</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">rename_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">transpose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">excel_filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a table based on the arguments.</span>

<span class="sd">        :param reshaping: A string.</span>
<span class="sd">            Can be &#39;pivot&#39;, &#39;unstack&#39; or &#39;multiindex&#39;, to perform these actions.</span>
<span class="sd">        :type reshaping: str</span>
<span class="sd">        :param vars_to_gather: A list of the variables to be transposed from rows to columns.</span>
<span class="sd">        :type vars_to_gather: list</span>
<span class="sd">        :param baseline: The already transposed column you want to use as a baseline for comparisons.</span>
<span class="sd">            If omitted, you will be asked which one to use.</span>
<span class="sd">        :type baseline: str</span>
<span class="sd">        :param comparison_mode: A list of strings.</span>
<span class="sd">            Can be &#39;others compared to baseline&#39; and/or &#39;baseline compared to others&#39;.</span>
<span class="sd">            Used to customise the comparison of variables.</span>
<span class="sd">        :type comparison_mode: list</span>
<span class="sd">        :param comparison_cols: A list of strings.</span>
<span class="sd">            &#39;absolute&#39; to get the difference or &#39;relative&#39; to get the percentage of reduction.</span>
<span class="sd">        :type comparison_cols: list</span>
<span class="sd">        :param check_index_and_cols: A boolean. True to check index and cols, False to skip.</span>
<span class="sd">        :type check_index_and_cols: bool</span>
<span class="sd">        :param vars_to_keep: A list of strings.</span>
<span class="sd">            To remove all variables from the multiindex except those to be kept.</span>
<span class="sd">        :type vars_to_keep: list</span>
<span class="sd">        :param excel_filename: A string.</span>
<span class="sd">            If entered, the wrangled_df will be exported to excel with that string as name.</span>
<span class="sd">        :type excel_filename: str</span>
<span class="sd">        :param transpose: True to transpose the dataframe</span>
<span class="sd">        :type transpose: bool</span>
<span class="sd">        :param rename_dict: Renames all data in the dataframe based on the format</span>
<span class="sd">            {&#39;old_string&#39;: &#39;new_string&#39;}</span>
<span class="sd">        :type rename_dict: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">vars_to_gather</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vars_to_gather</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">comparison_cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">comparison_cols</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">vars_to_keep</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vars_to_keep</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

        <span class="c1"># todo what if no variable is entered in vars_to_gather? accim should show the variables that change, and therefore could be analysed</span>

        <span class="c1"># todo revise stack returns a dataframe suitable for seaborn (one column for values, all others for categoricals)</span>

        <span class="c1"># if vars_to_gather is None:</span>


        <span class="k">if</span> <span class="n">reshaping</span> <span class="o">==</span> <span class="s1">&#39;pivot&#39;</span> <span class="ow">or</span> <span class="n">reshaping</span> <span class="o">==</span> <span class="s1">&#39;unstack&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enter_vars_to_gather</span><span class="p">(</span><span class="n">vars_to_gather</span><span class="p">)</span>

        <span class="n">checkpoint</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">wrangled_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">reshaping</span> <span class="o">==</span> <span class="s1">&#39;pivot&#39;</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;col_to_pivot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;temp&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indexcols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;col_to_pivot&#39;</span><span class="p">)</span>

            <span class="n">wrangled_df_pivoted</span> <span class="o">=</span> <span class="n">wrangled_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">del</span> <span class="n">wrangled_df</span>

            <span class="k">if</span> <span class="s1">&#39;Month&#39;</span> <span class="ow">in</span> <span class="n">wrangled_df_pivoted</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">wrangled_df_pivoted</span><span class="p">[</span><span class="s1">&#39;col_to_pivot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">wrangled_df_pivoted</span><span class="p">[</span><span class="n">vars_to_gather</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span>
                                                       <span class="n">wrangled_df_pivoted</span><span class="p">[</span><span class="s1">&#39;Month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span>
                                                       <span class="s1">&#39;[Month&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">wrangled_df_pivoted</span><span class="p">[</span><span class="s1">&#39;col_to_pivot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wrangled_df_pivoted</span><span class="p">[</span><span class="n">vars_to_gather</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;col_to_pivot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wrangled_df_pivoted</span><span class="p">[</span><span class="s1">&#39;col_to_pivot&#39;</span><span class="p">]</span>

            <span class="n">checkpoint</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1">#todo testing from here</span>

            <span class="c1"># todo when it is pivotted, variables not specified in vars_to_gather are summed</span>
            <span class="c1"># wrangled_df_pivoted = wrangled_df_pivoted.drop([&#39;Source&#39;], axis=1)</span>
            <span class="c1"># try:</span>
            <span class="c1">#     self.indexcols.remove(&#39;Source&#39;)</span>
            <span class="c1"># except ValueError:</span>
            <span class="c1">#     print(&#39;Since this is not the first time you run wrangled_table, &#39;</span>
            <span class="c1">#           &#39;&quot;Source&quot; is trying to be removed from indexcols, but has been previously removed.&#39;)</span>
            <span class="c1"># if self.split_epw_names:</span>
            <span class="c1">#     wrangled_df_pivoted = wrangled_df_pivoted.drop([&#39;EPW&#39;, &#39;EPW_Scenario-Year&#39;], axis=1)</span>
            <span class="c1">#     try:</span>
            <span class="c1">#         self.indexcols.remove(&#39;EPW&#39;)</span>
            <span class="c1">#         self.indexcols.remove(&#39;EPW_Scenario-Year&#39;)</span>
            <span class="c1">#     except ValueError:</span>
            <span class="c1">#         print(&#39;Since this is not the first time you run wrangled_table, &#39;</span>
            <span class="c1">#               &#39;&quot;EPW&quot; and &quot;EPW_Scenario-Year&quot; are trying to be removed from indexcols, but has been previously removed.&#39;)</span>
            <span class="c1">#</span>
            <span class="c1">#</span>
            <span class="c1"># cols_to_clean = []</span>
            <span class="c1"># cols_for_multiindex = []</span>
            <span class="c1"># for i in self.indexcols:</span>
            <span class="c1">#     try:</span>
            <span class="c1">#         if (wrangled_df_pivoted[i][0] == wrangled_df_pivoted[i]).all():</span>
            <span class="c1">#             cols_to_clean.append(i)</span>
            <span class="c1">#         else:</span>
            <span class="c1">#             cols_for_multiindex.append(i)</span>
            <span class="c1">#     except KeyError:</span>
            <span class="c1">#         wrangled_df_pivoted = wrangled_df_pivoted.set_index([pd.RangeIndex(len(wrangled_df_pivoted))])</span>
            <span class="c1">#         if (wrangled_df_pivoted[i][0] == wrangled_df_pivoted[i]).all():</span>
            <span class="c1">#             cols_to_clean.append(i)</span>
            <span class="c1">#         else:</span>
            <span class="c1">#             cols_for_multiindex.append(i)</span>
            <span class="c1">#</span>
            <span class="c1"># checkpoint += 1</span>
            <span class="c1">#</span>
            <span class="c1"># if check_index_and_cols:</span>
            <span class="c1">#     print(&#39;The multiindex should contain only the variables you want to compare. &#39;</span>
            <span class="c1">#           &#39;The variables and values you are going to use for the multiindex, except those already specified in vars_to_gather argument, are:&#39;)</span>
            <span class="c1">#     for i in cols_for_multiindex:</span>
            <span class="c1">#         if all([i not in j for j in vars_to_gather]):</span>
            <span class="c1">#             print(f&#39;{i}: {list(dict.fromkeys(wrangled_df_pivoted[i]))}&#39;)</span>
            <span class="c1">#     proceed = input(&#39;If some variable is not relevant for the comparison, it should be removed. &#39;</span>
            <span class="c1">#                     &#39;Do you want to remove any? [y/n]: &#39;)</span>
            <span class="c1">#     if &#39;y&#39; in proceed:</span>
            <span class="c1">#         if len(vars_to_keep) &gt; 0:</span>
            <span class="c1">#             print(&#39;The variables to keep you specified in the arguments will be overriden.&#39;)</span>
            <span class="c1">#         vars_to_keep = list(str(num) for num in input(&quot;Enter the variables you want to keep separated by semicolon: &quot;).split(&#39;;&#39;))</span>
            <span class="c1">#</span>
            <span class="c1"># if len(vars_to_keep) &gt; 0:</span>
            <span class="c1">#     add_vars_to_remove = list(set(cols_for_multiindex) - set(vars_to_gather) - set(vars_to_keep))</span>
            <span class="c1">#     for i in add_vars_to_remove:</span>
            <span class="c1">#         cols_to_clean.append(i)</span>
            <span class="c1">#         cols_for_multiindex.remove(i)</span>
            <span class="c1">#</span>
            <span class="c1"># wrangled_df_pivoted = wrangled_df_pivoted.drop(cols_to_clean, axis=1)</span>
            <span class="c1">#</span>
            <span class="c1"># cols_for_values = list(set(wrangled_df_pivoted.columns) - set(cols_for_multiindex))</span>
            <span class="c1">#</span>
            <span class="c1"># checkpoint += 1</span>
            <span class="c1">#</span>
            <span class="c1"># wrangled_df_pivoted = wrangled_df_pivoted.pivot_table(</span>
            <span class="c1">#     index=cols_for_multiindex,</span>
            <span class="c1">#     columns=&#39;col_to_pivot&#39;,</span>
            <span class="c1">#     values=self.val_cols,</span>
            <span class="c1">#     aggfunc=np.sum,</span>
            <span class="c1">#     fill_value=0</span>
            <span class="c1"># )</span>
            <span class="c1">#</span>
            <span class="c1"># checkpoint += 1</span>
            
            

            <span class="c1">#todo testing until here</span>


            <span class="n">wrangled_df_pivoted</span> <span class="o">=</span> <span class="n">wrangled_df_pivoted</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
                <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">indexcols</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;col_to_pivot&#39;</span><span class="p">),</span>
                <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;col_to_pivot&#39;</span><span class="p">,</span>
                <span class="n">values</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">val_cols</span><span class="p">,</span>
                <span class="c1"># if aggfunc is omitted, performs the average</span>
                <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">,</span>
                <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">checkpoint</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">var_to_gather_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;col_to_pivot&#39;</span><span class="p">]))</span>

            <span class="k">if</span> <span class="n">baseline</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">var_to_gather_values</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">baseline</span><span class="si">}</span><span class="s1">&quot; is not in list of categories you want to compare. The list is:&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">var_to_gather_values</span><span class="p">)</span>
                <span class="n">baseline</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Please choose one from the list above (it is case-sensitive) for baseline:&#39;</span><span class="p">)</span>

            <span class="n">other_than_baseline</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">var_to_gather_values</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="n">baseline</span><span class="p">]))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;col_to_pivot&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">checkpoint</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># summing monthly values to make runperiod</span>

            <span class="k">if</span> <span class="s1">&#39;Month&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">var_to_gather_values</span><span class="p">:</span>
                    <span class="n">wrangled_df_pivoted</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_Runperiod_Total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wrangled_df_pivoted</span><span class="p">[</span>
                        <span class="p">[</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">wrangled_df_pivoted</span><span class="o">.</span><span class="n">columns</span>
                         <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">j</span><span class="p">]</span>
                    <span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">other_than_baseline</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Month&#39;</span><span class="p">])):</span>
                        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="s1">&#39;relative&#39;</span> <span class="ow">in</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">comparison_cols</span><span class="p">):</span>
                            <span class="n">wrangled_df_pivoted</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;1-(</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">baseline</span><span class="si">}</span><span class="s1">)_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_Month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                                    <span class="mi">1</span> <span class="o">-</span>
                                    <span class="p">(</span><span class="n">wrangled_df_pivoted</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_Month&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">wrangled_df_pivoted</span><span class="p">[</span><span class="n">baseline</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_Month&#39;</span><span class="p">])</span>
                            <span class="p">)</span>
                        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="s1">&#39;absolute&#39;</span> <span class="ow">in</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">comparison_cols</span><span class="p">):</span>
                            <span class="n">wrangled_df_pivoted</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">baseline</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_Month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                                    <span class="n">wrangled_df_pivoted</span><span class="p">[</span><span class="n">baseline</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_Month&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">wrangled_df_pivoted</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_Month&#39;</span><span class="p">]</span>
                            <span class="p">)</span>
                    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="s1">&#39;relative&#39;</span> <span class="ow">in</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">comparison_cols</span><span class="p">):</span>
                        <span class="n">wrangled_df_pivoted</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;1-(</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">baseline</span><span class="si">}</span><span class="s1">)_Runperiod_Total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="mi">1</span> <span class="o">-</span>
                                <span class="p">(</span><span class="n">wrangled_df_pivoted</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="s1">&#39;_Runperiod_Total&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">wrangled_df_pivoted</span><span class="p">[</span><span class="n">baseline</span> <span class="o">+</span> <span class="s1">&#39;_Runperiod_Total&#39;</span><span class="p">])</span>
                        <span class="p">)</span>
                    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="s1">&#39;absolute&#39;</span> <span class="ow">in</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">comparison_cols</span><span class="p">):</span>
                        <span class="n">wrangled_df_pivoted</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">baseline</span><span class="si">}</span><span class="s1"> - </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">_Runperiod_Total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="n">wrangled_df_pivoted</span><span class="p">[</span><span class="n">baseline</span> <span class="o">+</span> <span class="s1">&#39;_Runperiod_Total&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">wrangled_df_pivoted</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="s1">&#39;_Runperiod_Total&#39;</span><span class="p">]</span>
                        <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">other_than_baseline</span><span class="p">:</span>
                    <span class="c1"># if comparison_mode == &#39;others compared to baseline&#39;:</span>
                    <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="s1">&#39;others compared to baseline&#39;</span> <span class="ow">in</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">comparison_mode</span><span class="p">]):</span>
                        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="s1">&#39;relative&#39;</span> <span class="ow">in</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">comparison_cols</span><span class="p">):</span>
                            <span class="n">wrangled_df_pivoted</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;1-(</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">baseline</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                                    <span class="mi">1</span> <span class="o">-</span>
                                    <span class="p">(</span><span class="n">wrangled_df_pivoted</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">wrangled_df_pivoted</span><span class="p">[</span><span class="n">baseline</span><span class="p">])</span>
                            <span class="p">)</span>
                        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="s1">&#39;absolute&#39;</span> <span class="ow">in</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">comparison_cols</span><span class="p">):</span>
                            <span class="n">wrangled_df_pivoted</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">baseline</span><span class="si">}</span><span class="s1"> - </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                                    <span class="n">wrangled_df_pivoted</span><span class="p">[</span><span class="n">baseline</span><span class="p">]</span> <span class="o">-</span> <span class="n">wrangled_df_pivoted</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                            <span class="p">)</span>
                    <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="s1">&#39;baseline compared to others&#39;</span> <span class="ow">in</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">comparison_mode</span><span class="p">]):</span>
                        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="s1">&#39;relative&#39;</span> <span class="ow">in</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">comparison_cols</span><span class="p">):</span>
                            <span class="n">wrangled_df_pivoted</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;1-(</span><span class="si">{</span><span class="n">baseline</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                                    <span class="mi">1</span> <span class="o">-</span>
                                    <span class="p">(</span><span class="n">wrangled_df_pivoted</span><span class="p">[</span><span class="n">baseline</span><span class="p">]</span> <span class="o">/</span> <span class="n">wrangled_df_pivoted</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                            <span class="p">)</span>
                        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="s1">&#39;absolute&#39;</span> <span class="ow">in</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">comparison_cols</span><span class="p">):</span>
                            <span class="n">wrangled_df_pivoted</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1"> - </span><span class="si">{</span><span class="n">baseline</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                                    <span class="n">wrangled_df_pivoted</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">wrangled_df_pivoted</span><span class="p">[</span><span class="n">baseline</span><span class="p">]</span>
                            <span class="p">)</span>

            <span class="n">wrangled_df_pivoted</span> <span class="o">=</span> <span class="n">wrangled_df_pivoted</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">rename_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">wrangled_df_pivoted</span> <span class="o">=</span> <span class="n">wrangled_df_pivoted</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rename_dict</span><span class="p">],</span>
                    <span class="p">[</span><span class="n">rename_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rename_dict</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rename_dict</span><span class="p">:</span>
                    <span class="n">wrangled_df_pivoted</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">rename_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">wrangled_df_pivoted</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">rename_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">transpose</span><span class="p">:</span>
                <span class="n">wrangled_df_pivoted</span> <span class="o">=</span> <span class="n">wrangled_df_pivoted</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">excel_filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">wrangled_df_pivoted</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">excel_filename</span><span class="si">}</span><span class="s1">.xlsx&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">wrangled_df_pivoted</span> <span class="o">=</span> <span class="n">wrangled_df_pivoted</span>

            <span class="n">checkpoint</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">elif</span> <span class="n">reshaping</span> <span class="o">==</span> <span class="s1">&#39;unstack&#39;</span> <span class="ow">or</span> <span class="n">reshaping</span> <span class="o">==</span> <span class="s1">&#39;stack&#39;</span> <span class="ow">or</span> <span class="n">reshaping</span> <span class="o">==</span> <span class="s1">&#39;multiindex&#39;</span><span class="p">:</span>

            <span class="n">wrangled_df_unstacked_or_stacked</span> <span class="o">=</span> <span class="n">wrangled_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">del</span> <span class="n">wrangled_df</span>

            <span class="c1"># todo if argument vars_to_keep is not specified, vars_to_keep should be all remaining variables apart from those in vars_to_gather</span>

            <span class="c1"># Step: Getting rid of unnecessary columns</span>
            <span class="n">wrangled_df_unstacked_or_stacked</span> <span class="o">=</span> <span class="n">wrangled_df_unstacked_or_stacked</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;Source&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">indexcols</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;Source&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>
                <span class="c1"># print(&#39;Since this is not the first time you run wrangled_table, &#39;</span>
                <span class="c1">#       &#39;&quot;Source&quot; is trying to be removed from indexcols, but has been previously removed.&#39;)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_epw_names</span><span class="p">:</span>
                <span class="n">wrangled_df_unstacked_or_stacked</span> <span class="o">=</span> <span class="n">wrangled_df_unstacked_or_stacked</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;EPW&#39;</span><span class="p">,</span> <span class="s1">&#39;EPW_Scenario-Year&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">indexcols</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;EPW&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">indexcols</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;EPW_Scenario-Year&#39;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">pass</span>
                    <span class="c1"># print(&#39;Since this is not the first time you run wrangled_table, &#39;</span>
                    <span class="c1">#       &#39;&quot;EPW&quot; and &quot;EPW_Scenario-Year&quot; are trying to be removed from indexcols, but has been previously removed.&#39;)</span>

            <span class="c1"># removing variables where values are all the same</span>
            <span class="n">cols_to_clean</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">cols_for_multiindex</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">indexcols</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">wrangled_df_unstacked_or_stacked</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">wrangled_df_unstacked_or_stacked</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                        <span class="n">cols_to_clean</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">wrangled_df_unstacked_or_stacked</span><span class="p">[</span><span class="n">i</span><span class="p">]])))</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="p">((</span><span class="s1">&#39;_X&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">wrangled_df_unstacked_or_stacked</span><span class="p">[</span><span class="n">i</span><span class="p">]]))[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;_X&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">wrangled_df_unstacked_or_stacked</span><span class="p">[</span><span class="n">i</span><span class="p">]]))[</span><span class="mi">1</span><span class="p">])):</span>
                        <span class="n">cols_to_clean</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">cols_for_multiindex</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">wrangled_df_unstacked_or_stacked</span> <span class="o">=</span> <span class="n">wrangled_df_unstacked_or_stacked</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">RangeIndex</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wrangled_df_unstacked_or_stacked</span><span class="p">))])</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">wrangled_df_unstacked_or_stacked</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">wrangled_df_unstacked_or_stacked</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                        <span class="n">cols_to_clean</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">wrangled_df_unstacked_or_stacked</span><span class="p">[</span><span class="n">i</span><span class="p">]])))</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="p">((</span><span class="s1">&#39;_X&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">wrangled_df_unstacked_or_stacked</span><span class="p">[</span><span class="n">i</span><span class="p">]]))[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;_X&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">wrangled_df_unstacked_or_stacked</span><span class="p">[</span><span class="n">i</span><span class="p">]]))[</span><span class="mi">1</span><span class="p">])):</span>
                        <span class="n">cols_to_clean</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">cols_for_multiindex</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

            <span class="n">checkpoint</span> <span class="o">+=</span> <span class="mi">1</span>



            <span class="n">wrangled_df_unstacked_or_stacked</span> <span class="o">=</span> <span class="n">wrangled_df_unstacked_or_stacked</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">cols_to_clean</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">cols_for_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">wrangled_df_unstacked_or_stacked</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">cols_for_multiindex</span><span class="p">))</span>


            <span class="c1"># todo re-review the use of check_index_and_cols and vars_to_gather to avoid repeated rows when stacking</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vars_to_keep</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">check_index_and_cols</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The multiindex should contain only the variables you want to compare. &#39;</span>
                          <span class="s1">&#39;The variables and values you are going to use for the multiindex, except those already specified in vars_to_gather argument, are:&#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cols_for_multiindex</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">vars_to_gather</span><span class="p">]):</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">wrangled_df_unstacked_or_stacked</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">proceed</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;If some variable is not relevant for the comparison, it should be removed. &#39;</span>
                                    <span class="s1">&#39;Do you want to remove any? [y/n]: &#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s1">&#39;y&#39;</span> <span class="ow">in</span> <span class="n">proceed</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vars_to_keep</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The variables to keep you specified in the arguments will be overriden.&#39;</span><span class="p">)</span>
                        <span class="n">vars_to_keep</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Enter the variables you want to keep separated by semicolon: &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">))</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vars_to_keep</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">add_vars_to_remove</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">cols_for_multiindex</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">vars_to_gather</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">vars_to_keep</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">add_vars_to_remove</span><span class="p">:</span>
                    <span class="n">cols_to_clean</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="n">cols_for_multiindex</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">wrangled_df_unstacked_or_stacked</span> <span class="o">=</span> <span class="n">wrangled_df_unstacked_or_stacked</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">add_vars_to_remove</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">wrangled_df_unstacked_or_stacked</span> <span class="o">=</span> <span class="n">wrangled_df_unstacked_or_stacked</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">cols_for_multiindex</span><span class="p">)</span>

            <span class="n">checkpoint</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">reshaping</span> <span class="o">==</span> <span class="s1">&#39;unstack&#39;</span><span class="p">:</span>
                <span class="n">wrangled_df_unstacked</span> <span class="o">=</span> <span class="n">wrangled_df_unstacked_or_stacked</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">del</span> <span class="n">wrangled_df_unstacked_or_stacked</span>

                <span class="n">wrangled_df_unstacked</span> <span class="o">=</span> <span class="n">wrangled_df_unstacked</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">vars_to_gather</span><span class="p">)</span>

                <span class="n">checkpoint</span> <span class="o">+=</span><span class="mi">1</span>

                <span class="n">wrangled_df_unstacked</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;[&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">wrangled_df_unstacked</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>

                <span class="n">var_to_gather_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">wrangled_df_unstacked</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
                <span class="n">var_to_gather_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">var_to_gather_values</span><span class="p">))</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">comparison_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">baseline</span> <span class="o">=</span> <span class="n">var_to_gather_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">comparison_mode</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;baseline compared to others&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">baseline</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">var_to_gather_values</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">baseline</span><span class="si">}</span><span class="s1">&quot; is not in list of categories you want to compare. The list is:&#39;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">var_to_gather_values</span><span class="p">)</span>
                        <span class="n">baseline</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Please choose one from the list above (it is case-sensitive) for baseline:&#39;</span><span class="p">)</span>

                <span class="n">other_than_baseline</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">wrangled_df_unstacked</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">baseline</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">i</span><span class="p">]</span>
                <span class="n">other_than_baseline</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">other_than_baseline</span><span class="p">))</span>

                <span class="c1"># baseline_col = [col for col in wrangled_df_unstacked.columns if baseline in col][0]</span>

                <span class="c1"># in this case the months are located in rows, so no need to add months to columns</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cols_for_values</span><span class="p">:</span>
                    <span class="n">baseline_col</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">wrangled_df_unstacked</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">baseline</span> <span class="ow">in</span> <span class="n">col</span> <span class="ow">and</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">col</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">other_than_baseline</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">wrangled_df_unstacked</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">col</span> <span class="ow">and</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">col</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="s1">&#39;others compared to baseline&#39;</span> <span class="ow">in</span> <span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">comparison_mode</span><span class="p">]):</span>
                                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="s1">&#39;relative&#39;</span> <span class="ow">in</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">comparison_cols</span><span class="p">):</span>
                                    <span class="n">wrangled_df_unstacked</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">[1-(</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">baseline</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                                            <span class="mi">1</span> <span class="o">-</span>
                                            <span class="p">(</span><span class="n">wrangled_df_unstacked</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">/</span> <span class="n">wrangled_df_unstacked</span><span class="p">[</span><span class="n">baseline_col</span><span class="p">])</span>
                                    <span class="p">)</span>
                                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="s1">&#39;absolute&#39;</span> <span class="ow">in</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">comparison_cols</span><span class="p">):</span>
                                    <span class="n">wrangled_df_unstacked</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">[</span><span class="si">{</span><span class="n">baseline</span><span class="si">}</span><span class="s1"> - </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                                            <span class="n">wrangled_df_unstacked</span><span class="p">[</span><span class="n">baseline_col</span><span class="p">]</span> <span class="o">-</span> <span class="n">wrangled_df_unstacked</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
                                    <span class="p">)</span>
                            <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="s1">&#39;baseline compared to others&#39;</span> <span class="ow">in</span> <span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">comparison_mode</span><span class="p">]):</span>
                                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="s1">&#39;relative&#39;</span> <span class="ow">in</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">comparison_cols</span><span class="p">):</span>
                                    <span class="n">wrangled_df_unstacked</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">[1-(</span><span class="si">{</span><span class="n">baseline</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                                            <span class="mi">1</span> <span class="o">-</span>
                                            <span class="p">(</span><span class="n">wrangled_df_unstacked</span><span class="p">[</span><span class="n">baseline_col</span><span class="p">]</span> <span class="o">/</span> <span class="n">wrangled_df_unstacked</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
                                    <span class="p">)</span>
                                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="s1">&#39;absolute&#39;</span> <span class="ow">in</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">comparison_cols</span><span class="p">):</span>
                                    <span class="n">wrangled_df_unstacked</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">[</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1"> - </span><span class="si">{</span><span class="n">baseline</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                                            <span class="n">wrangled_df_unstacked</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">-</span> <span class="n">wrangled_df_unstacked</span><span class="p">[</span><span class="n">baseline_col</span><span class="p">]</span>
                                    <span class="p">)</span>

                <span class="n">ordered_columns</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">val_cols</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">wrangled_df_unstacked</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">j</span><span class="p">:</span>
                            <span class="n">ordered_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>

                <span class="n">wrangled_df_unstacked</span> <span class="o">=</span> <span class="n">wrangled_df_unstacked</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">ordered_columns</span><span class="p">)</span>

                <span class="n">wrangled_df_unstacked</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_arrays</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">wrangled_df_unstacked</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)],</span>
                        <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">wrangled_df_unstacked</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
                    <span class="p">]</span>
                <span class="p">)</span>

                <span class="n">wrangled_df_unstacked</span> <span class="o">=</span> <span class="n">wrangled_df_unstacked</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">rename_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">wrangled_df_unstacked</span> <span class="o">=</span> <span class="n">wrangled_df_unstacked</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rename_dict</span><span class="p">],</span>
                        <span class="p">[</span><span class="n">rename_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rename_dict</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rename_dict</span><span class="p">:</span>
                        <span class="n">wrangled_df_unstacked</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">rename_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="n">wrangled_df_unstacked</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">rename_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">transpose</span><span class="p">:</span>
                    <span class="n">wrangled_df_unstacked</span> <span class="o">=</span> <span class="n">wrangled_df_unstacked</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">excel_filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">wrangled_df_unstacked</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">excel_filename</span><span class="si">}</span><span class="s1">.xlsx&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">wrangled_df_unstacked</span> <span class="o">=</span> <span class="n">wrangled_df_unstacked</span>

            <span class="k">elif</span> <span class="n">reshaping</span> <span class="o">==</span> <span class="s1">&#39;stack&#39;</span><span class="p">:</span>
                <span class="n">wrangled_df_stacked</span> <span class="o">=</span> <span class="n">wrangled_df_unstacked_or_stacked</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">del</span> <span class="n">wrangled_df_unstacked_or_stacked</span>
                <span class="n">wrangled_df_stacked</span> <span class="o">=</span> <span class="n">wrangled_df_stacked</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>
                <span class="n">wrangled_df_stacked</span> <span class="o">=</span> <span class="n">wrangled_df_stacked</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
                <span class="n">wrangled_df_stacked</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">]</span>
                <span class="n">cols_for_multiindex</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span>
                <span class="n">wrangled_df_stacked</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">wrangled_df_stacked</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">set_names</span><span class="p">(</span><span class="n">cols_for_multiindex</span><span class="p">)</span>
                <span class="n">cols_for_multiindex</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span>

                <span class="n">wrangled_df_stacked</span> <span class="o">=</span> <span class="n">wrangled_df_stacked</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">rename_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">wrangled_df_stacked</span> <span class="o">=</span> <span class="n">wrangled_df_stacked</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rename_dict</span><span class="p">],</span>
                        <span class="p">[</span><span class="n">rename_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rename_dict</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rename_dict</span><span class="p">:</span>
                        <span class="n">wrangled_df_stacked</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">rename_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="n">wrangled_df_stacked</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">rename_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">transpose</span><span class="p">:</span>
                    <span class="n">wrangled_df_stacked</span> <span class="o">=</span> <span class="n">wrangled_df_stacked</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">excel_filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">wrangled_df_stacked</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">excel_filename</span><span class="si">}</span><span class="s1">.xlsx&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">wrangled_df_stacked</span> <span class="o">=</span> <span class="n">wrangled_df_stacked</span>

            <span class="k">elif</span> <span class="n">reshaping</span> <span class="o">==</span> <span class="s1">&#39;multiindex&#39;</span><span class="p">:</span>
                <span class="n">wrangled_df_multiindex</span> <span class="o">=</span> <span class="n">wrangled_df_unstacked_or_stacked</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">del</span> <span class="n">wrangled_df_unstacked_or_stacked</span>

                <span class="k">if</span> <span class="n">rename_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">wrangled_df_multiindex</span> <span class="o">=</span> <span class="n">wrangled_df_multiindex</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rename_dict</span><span class="p">],</span>
                        <span class="p">[</span><span class="n">rename_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rename_dict</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rename_dict</span><span class="p">:</span>
                        <span class="n">wrangled_df_multiindex</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">rename_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="n">wrangled_df_multiindex</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">rename_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">transpose</span><span class="p">:</span>
                    <span class="n">wrangled_df_multiindex</span> <span class="o">=</span> <span class="n">wrangled_df_multiindex</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">excel_filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">wrangled_df_multiindex</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">excel_filename</span><span class="si">}</span><span class="s1">.xlsx&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">wrangled_df_multiindex</span> <span class="o">=</span> <span class="n">wrangled_df_multiindex</span>

                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No reshaping method has been applied, only multiindexing.&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Table.enter_vars_to_gather">
<a class="viewcode-back" href="../../../../accim.data.postprocessing.html#accim.data.postprocessing.main.Table.enter_vars_to_gather">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">enter_vars_to_gather</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">vars_to_gather</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function used by accim to gather variables to be combined in columns.</span>

<span class="sd">        :param vars_to_gather: The list of strings containing the variables.</span>
<span class="sd">        :type vars_to_gather: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">vars_to_gather</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vars_to_gather</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">while</span> <span class="p">(</span><span class="ow">not</span> <span class="p">(</span><span class="nb">all</span><span class="p">(</span><span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_vars_to_gather</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">vars_to_gather</span><span class="p">))</span>
               <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">vars_to_gather</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">vars_to_gather</span><span class="p">))):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Some of the variables to be gathered are not available or are duplicated:&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">vars_to_gather</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The list of available variables to be gathered is:&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">available_vars_to_gather</span><span class="p">)</span>
            <span class="n">vars_to_gather</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
                                   <span class="k">for</span> <span class="n">var</span>
                                   <span class="ow">in</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Enter the variables to be gathered separated by semicolon: &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">vars_to_gather</span></div>



<div class="viewcode-block" id="Table.generate_fig_data">
<a class="viewcode-back" href="../../../../accim.data.postprocessing.html#accim.data.postprocessing.main.Table.generate_fig_data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">generate_fig_data</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">vars_to_gather_cols</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">vars_to_gather_rows</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">detailed_cols</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">detailed_rows</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">custom_cols_order</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">custom_rows_order</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">data_on_y_axis_baseline_plot</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="c1"># adap_vs_stat_data_y_sec=None,</span>
            <span class="n">baseline</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">colorlist_baseline_plot_data</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">data_on_x_axis</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">data_on_y_main_axis</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">data_on_y_sec_axis</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">colorlist_y_main_axis</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">colorlist_y_sec_axis</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">best_fit_deg_y_main_axis</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">best_fit_deg_y_sec_axis</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">best_fit_deg</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">rows_renaming_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">cols_renaming_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates list of data to be plotted.</span>

<span class="sd">        :param vars_to_gather_cols: A list of strings. The list should be the variables you want to show in subplot columns.</span>
<span class="sd">        :param vars_to_gather_rows: A list of strings. The list should be the variables you want to show in subplot rows.</span>
<span class="sd">        :param detailed_cols: A list of strings. The list should be the specific data you want to show in subplots columns. Used to filter.</span>
<span class="sd">        :param detailed_rows: A list of strings. The list should be the specific data you want to show in subplots rows. Used to filter.</span>
<span class="sd">        :param custom_cols_order: A list of strings. The list should be the specific order for the items shown in subplot columns.</span>
<span class="sd">        :param custom_rows_order: A list of strings. The list should be the specific order for the items shown in subplot rows.</span>
<span class="sd">        :param data_on_y_axis_baseline_plot: A list of strings. Used to select the data you want to show in the graph. Should be a list of the column names you want to plot in each subplot.</span>
<span class="sd">        :param baseline: A string, used only in data_on_y_axis_baseline_plot. The baseline should be one of the combinations in vars_to_gather_cols. It will be plotted in x-axis, while the reference combination for comparison in y-axis.</span>
<span class="sd">        :param colorlist_baseline_plot_data: A list of strings. Should be the colors using the matplotlib color notation for the columns entered in data_on_y_axis_baseline_plot in the same order.</span>
<span class="sd">        :param data_on_x_axis: A string. The column name you want to plot in the x-axis.</span>
<span class="sd">        :param data_on_y_main_axis: A list with nested lists and strings. Used to select the data you want to show in the scatter plot main y-axis. It needs to follow this structure:</span>
<span class="sd">            [[&#39;name_on_y_main_axis&#39;, [list of column names you want to plot]]</span>
<span class="sd">        :param data_on_y_sec_axis: A list with nested lists and strings. Used to select the data you want to show in the scatter plot secondary y-axis. It needs to follow this structure:</span>
<span class="sd">            [[&#39;name_on_1st_y_sec_axis&#39;, [list of column names you want to plot], [&#39;name_on_2nd_y_sec_axis&#39;, [list of column names you want to plot], etc]</span>
<span class="sd">        :param colorlist_y_main_axis: A list with nested lists and strings. It should follow the same structure as data_on_y_main_axis, but replacing the column names with the colors using the matplotlib notation.</span>
<span class="sd">        :param colorlist_y_sec_axis: A list with nested lists and strings. It should follow the same structure as data_on_y_sec_axis, but replacing the column names with the colors using the matplotlib notation.</span>
<span class="sd">        :param rows_renaming_dict: A dictionary. Should follow the pattern {&#39;old row name 1&#39;: &#39;new row name 1&#39;, &#39;old row name 2&#39;: &#39;new row name 2&#39;}</span>
<span class="sd">        :param cols_renaming_dict: A dictionary. Should follow the pattern {&#39;old col name 1&#39;: &#39;new col name 1&#39;, &#39;old col name 2&#39;: &#39;new col name 2&#39;}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.lines</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">lines</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>

        <span class="k">if</span> <span class="n">vars_to_gather_cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vars_to_gather_cols</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">vars_to_gather_rows</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vars_to_gather_rows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">detailed_cols</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">detailed_cols</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">detailed_rows</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">detailed_rows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">custom_cols_order</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">custom_cols_order</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">custom_rows_order</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">custom_rows_order</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">data_on_y_axis_baseline_plot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data_on_y_axis_baseline_plot</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_axis_baseline_plot</span> <span class="o">=</span> <span class="n">data_on_y_axis_baseline_plot</span>
        <span class="c1"># if adap_vs_stat_data_y_sec is None:</span>
        <span class="c1">#     adap_vs_stat_data_y_sec = []</span>
        <span class="k">if</span> <span class="n">colorlist_baseline_plot_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">colorlist_baseline_plot_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">data_on_y_main_axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data_on_y_main_axis</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_main_axis</span> <span class="o">=</span> <span class="n">data_on_y_main_axis</span>
        <span class="k">if</span> <span class="n">data_on_y_sec_axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data_on_y_sec_axis</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_sec_axis</span> <span class="o">=</span> <span class="n">data_on_y_sec_axis</span>
        <span class="k">if</span> <span class="n">colorlist_y_main_axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">colorlist_y_main_axis</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">colorlist_y_sec_axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">colorlist_y_sec_axis</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">best_fit_deg_y_main_axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">best_fit_deg_y_main_axis</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">data_on_y_main_axis</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">best_fit_deg_y_main_axis</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">best_fit_deg_y_main_axis</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">best_fit_deg_y_main_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])):</span>
                            <span class="n">best_fit_deg_y_main_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">best_fit_deg_y_main_axis</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">best_fit_deg_y_main_axis</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">best_fit_deg_y_main_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])):</span>
                            <span class="k">if</span> <span class="n">best_fit_deg_y_main_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                                <span class="n">best_fit_deg_y_main_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                            <span class="k">elif</span> <span class="n">best_fit_deg_y_main_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                                <span class="n">best_fit_deg_y_main_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">best_fit_deg_y_sec_axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">best_fit_deg_y_sec_axis</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">data_on_y_sec_axis</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">best_fit_deg_y_sec_axis</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">best_fit_deg_y_sec_axis</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">best_fit_deg_y_sec_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])):</span>
                            <span class="n">best_fit_deg_y_sec_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">best_fit_deg_y_sec_axis</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">best_fit_deg_y_sec_axis</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">best_fit_deg_y_sec_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])):</span>
                            <span class="k">if</span> <span class="n">best_fit_deg_y_sec_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                                <span class="n">best_fit_deg_y_sec_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                            <span class="k">elif</span> <span class="n">best_fit_deg_y_sec_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                                <span class="n">best_fit_deg_y_sec_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">best_fit_deg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">best_fit_deg</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">data_on_y_axis_baseline_plot</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">best_fit_deg</span><span class="p">)):</span>
                <span class="n">best_fit_deg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">best_fit_deg</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">best_fit_deg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">best_fit_deg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">best_fit_deg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">best_fit_deg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">df_for_graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">df_for_graph</span><span class="p">[</span><span class="s1">&#39;col_to_gather_in_cols&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;temp&#39;</span>
        <span class="n">df_for_graph</span><span class="p">[</span><span class="s1">&#39;col_to_gather_in_rows&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;temp&#39;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vars_to_gather_rows</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;In relation to the variables to be gathered in rows,&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enter_vars_to_gather</span><span class="p">(</span><span class="n">vars_to_gather_rows</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vars_to_gather_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;In relation to the variables to be gathered in columns,&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enter_vars_to_gather</span><span class="p">(</span><span class="n">vars_to_gather_cols</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vars_to_gather_rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">df_for_graph</span><span class="p">[</span><span class="s1">&#39;col_to_gather_in_rows&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_for_graph</span><span class="p">[</span><span class="n">vars_to_gather_rows</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df_for_graph</span><span class="p">[</span><span class="s1">&#39;col_to_gather_in_rows&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_for_graph</span><span class="p">[</span><span class="n">vars_to_gather_rows</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vars_to_gather_cols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">df_for_graph</span><span class="p">[</span><span class="s1">&#39;col_to_gather_in_cols&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_for_graph</span><span class="p">[</span><span class="n">vars_to_gather_cols</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df_for_graph</span><span class="p">[</span><span class="s1">&#39;col_to_gather_in_cols&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_for_graph</span><span class="p">[</span><span class="n">vars_to_gather_cols</span><span class="p">]</span>

        <span class="n">all_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df_for_graph</span><span class="p">[</span><span class="s1">&#39;col_to_gather_in_cols&#39;</span><span class="p">]))</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df_for_graph</span><span class="p">[</span><span class="s1">&#39;col_to_gather_in_rows&#39;</span><span class="p">]))</span>

        <span class="n">all_cols</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="n">all_cols</span>

        <span class="n">rows</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="k">while</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">all</span><span class="p">(</span><span class="n">i</span> <span class="ow">in</span> <span class="n">cols</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">detailed_cols</span><span class="p">)):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Some of the detailed data to be gathered in columns based on the argument &#39;</span>
                  <span class="s1">&#39;vars_to_gather_cols is not available. &#39;</span>
                  <span class="s1">&#39;Only the following data is available for columns:&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span>
            <span class="n">detailed_cols</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
                                  <span class="k">for</span> <span class="n">var</span>
                                  <span class="ow">in</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Please enter the requested data to be arranged &quot;</span>
                                           <span class="s2">&quot;in columns separated by semicolon: &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)))</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">all</span><span class="p">(</span><span class="n">i</span> <span class="ow">in</span> <span class="n">rows</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">detailed_rows</span><span class="p">)):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Some of the detailed data to be gathered in rows based on the argument &#39;</span>
                  <span class="s1">&#39;vars_to_gather_rows is not available. &#39;</span>
                  <span class="s1">&#39;Only the following data is available for rows:&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
            <span class="n">detailed_rows</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
                                  <span class="k">for</span> <span class="n">var</span>
                                  <span class="ow">in</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Please enter the requested data to be arranged &quot;</span>
                                           <span class="s2">&quot;in rows separated by semicolon: &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">detailed_cols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="n">detailed_cols</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">detailed_rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="n">detailed_rows</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_on_y_axis_baseline_plot</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">baseline</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No baseline has been specified. The list of available baselines is:&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">all_cols</span><span class="p">)</span>
                <span class="n">baseline</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Please choose one from the list above (it is case-sensitive) for baseline:&#39;</span><span class="p">)</span>

            <span class="k">while</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">baseline</span> <span class="ow">in</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">all_cols</span><span class="p">)):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">baseline</span><span class="si">}</span><span class="s1">&quot; is not in list of categories you want to compare. The list is:&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">all_cols</span><span class="p">)</span>
                <span class="n">baseline</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Please choose one from the list above (it is case-sensitive) for baseline:&#39;</span><span class="p">)</span>

            <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cols</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">([</span><span class="n">baseline</span><span class="p">])]</span>

        <span class="c1"># cols.sort()</span>
        <span class="c1"># rows.sort()</span>

        <span class="n">cols_list_to_filter</span> <span class="o">=</span> <span class="n">cols</span> <span class="o">+</span> <span class="p">[</span><span class="n">baseline</span><span class="p">]</span>

        <span class="n">df_for_graph</span> <span class="o">=</span> <span class="n">df_for_graph</span><span class="p">[</span>
            <span class="p">(</span><span class="n">df_for_graph</span><span class="p">[</span><span class="s1">&#39;col_to_gather_in_cols&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">cols_list_to_filter</span><span class="p">))</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">df_for_graph</span><span class="p">[</span><span class="s1">&#39;col_to_gather_in_rows&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">rows</span><span class="p">))</span>
            <span class="p">]</span>

        <span class="c1"># if baseline is not None and len(data_on_y_axis_baseline_plot) &gt; 0:</span>
        <span class="n">df_for_graph</span><span class="p">[</span><span class="s1">&#39;col_to_unstack&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_for_graph</span><span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;col_to_gather_in_cols&#39;</span><span class="p">,</span> <span class="s1">&#39;col_to_gather_in_rows&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">columns_to_drop</span> <span class="o">=</span> <span class="p">[</span>
            <span class="c1"># &#39;Date/Time&#39;,</span>
            <span class="s1">&#39;Model&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ComfStand&#39;</span><span class="p">,</span>
            <span class="s1">&#39;CAT&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ComfMod&#39;</span><span class="p">,</span>
            <span class="s1">&#39;HVACmode&#39;</span><span class="p">,</span>
            <span class="s1">&#39;VentCtrl&#39;</span><span class="p">,</span>
            <span class="s1">&#39;VSToffset&#39;</span><span class="p">,</span>
            <span class="s1">&#39;MinOToffset&#39;</span><span class="p">,</span>
            <span class="s1">&#39;MaxWindSpeed&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ASTtol&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Source&#39;</span><span class="p">,</span>
            <span class="s1">&#39;EPW&#39;</span><span class="p">,</span>
            <span class="s1">&#39;NameSuffix&#39;</span><span class="p">,</span>
            <span class="s1">&#39;col_to_gather_in_cols&#39;</span><span class="p">,</span>
            <span class="s1">&#39;col_to_gather_in_rows&#39;</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;monthly&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">:</span>
            <span class="n">columns_to_drop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Month&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;daily&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">:</span>
            <span class="n">columns_to_drop</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;Month&#39;</span><span class="p">,</span> <span class="s1">&#39;Day&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;hourly&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">:</span>
            <span class="n">columns_to_drop</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;Month&#39;</span><span class="p">,</span> <span class="s1">&#39;Day&#39;</span><span class="p">,</span> <span class="s1">&#39;Hour&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;timestep&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">:</span>
            <span class="n">columns_to_drop</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;Month&#39;</span><span class="p">,</span> <span class="s1">&#39;Day&#39;</span><span class="p">,</span> <span class="s1">&#39;Hour&#39;</span><span class="p">,</span> <span class="s1">&#39;Minute&#39;</span><span class="p">])</span>

        <span class="n">df_for_graph</span> <span class="o">=</span> <span class="n">df_for_graph</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span>
            <span class="n">columns</span><span class="o">=</span><span class="n">columns_to_drop</span>
        <span class="p">)</span>

        <span class="n">multi_index</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;col_to_unstack&#39;</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">!=</span> <span class="s1">&#39;runperiod&#39;</span><span class="p">:</span>
            <span class="n">multi_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Date/time&#39;</span><span class="p">)</span>

        <span class="n">df_for_graph</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">multi_index</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_on_y_axis_baseline_plot</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">df_for_graph</span><span class="p">[</span><span class="n">dataset</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">data_on_y_axis_baseline_plot</span><span class="p">])</span>

        <span class="n">standard_units</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;(°C)&#39;</span><span class="p">,</span> <span class="s1">&#39;(h)&#39;</span><span class="p">,</span> <span class="s1">&#39;(m3)&#39;</span><span class="p">,</span> <span class="s1">&#39;(m2)&#39;</span><span class="p">,</span> <span class="s1">&#39;(ach)&#39;</span><span class="p">,</span> <span class="s1">&#39;(Wh)&#39;</span><span class="p">,</span> <span class="s1">&#39;(kWh)&#39;</span><span class="p">,</span> <span class="s1">&#39;(Wh/m2)&#39;</span><span class="p">,</span> <span class="s1">&#39;(kWh/m2)&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">y_main_units</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">standard_units</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">u</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_main_axis</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y_main_units</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">u</span><span class="p">,</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_main_axis</span> <span class="k">if</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">d</span><span class="p">]]</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">y_sec_units</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">standard_units</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">u</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_sec_axis</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y_sec_units</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">u</span><span class="p">,</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_sec_axis</span> <span class="k">if</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">d</span><span class="p">]]</span>
                <span class="p">)</span>

        <span class="n">df_for_graph</span> <span class="o">=</span> <span class="n">df_for_graph</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s1">&#39;col_to_unstack&#39;</span><span class="p">)</span>

        <span class="n">df_for_graph</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">df_for_graph</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">custom_rows_order</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ordered_rows</span> <span class="o">=</span> <span class="p">[</span><span class="n">ele</span> <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">custom_rows_order</span> <span class="k">if</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">]</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="n">ordered_rows</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">custom_cols_order</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ordered_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">ele</span> <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">custom_cols_order</span> <span class="k">if</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">]</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="n">ordered_cols</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)):</span>
            <span class="n">temp_row</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_on_y_axis_baseline_plot</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">temp</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">rows</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">cols</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="p">[</span>
                            <span class="n">df_for_graph</span><span class="p">[[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df_for_graph</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">rows</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">x</span> <span class="ow">and</span> <span class="n">baseline</span> <span class="ow">in</span> <span class="n">x</span> <span class="ow">and</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]]</span>
                            <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">data_on_y_axis_baseline_plot</span>
                        <span class="p">]</span>
                    <span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">temp</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">rows</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">cols</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="n">df_for_graph</span><span class="p">[[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df_for_graph</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">rows</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">x</span> <span class="ow">and</span> <span class="n">cols</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">in</span> <span class="n">x</span> <span class="ow">and</span> <span class="n">data_on_x_axis</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]]</span>
                    <span class="p">]</span>
                <span class="n">temp_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_row</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)):</span>
            <span class="n">temp_row</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">baseline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_on_y_axis_baseline_plot</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)):</span>
                    <span class="n">temp</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">rows</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">cols</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="p">[</span>
                            <span class="n">df_for_graph</span><span class="p">[[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df_for_graph</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">rows</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">x</span> <span class="ow">and</span> <span class="n">cols</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">in</span> <span class="n">x</span> <span class="ow">and</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]]</span>
                            <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">data_on_y_axis_baseline_plot</span>
                        <span class="p">],</span>
                        <span class="p">[</span><span class="n">dataset</span> <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">data_on_y_axis_baseline_plot</span><span class="p">],</span>
                        <span class="p">[</span><span class="n">color</span> <span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">colorlist_baseline_plot_data</span><span class="p">],</span>
                        <span class="p">[</span><span class="n">deg</span> <span class="k">for</span> <span class="n">deg</span> <span class="ow">in</span> <span class="n">best_fit_deg</span><span class="p">]</span>
                    <span class="p">]</span>
                    <span class="n">temp_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_row</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)):</span>
                    <span class="n">temp_col</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_main_axis</span><span class="p">)):</span>
                        <span class="n">temp</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s1">&#39;axis&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span>
                            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">rows</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">cols</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;dataframe&#39;</span><span class="p">:</span> <span class="p">[</span>
                                <span class="n">df_for_graph</span><span class="p">[[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df_for_graph</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span>
                                              <span class="n">rows</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">x</span> <span class="ow">and</span> <span class="n">cols</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">in</span> <span class="n">x</span> <span class="ow">and</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]]</span>
                                <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_main_axis</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                            <span class="p">],</span>
                            <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">dataset</span> <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_main_axis</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span>
                            <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">color</span> <span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">colorlist_y_main_axis</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span>
                            <span class="s1">&#39;best fit line deg&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">deg</span> <span class="k">for</span> <span class="n">deg</span> <span class="ow">in</span> <span class="n">best_fit_deg_y_main_axis</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
                        <span class="p">}</span>
                        <span class="n">temp_col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                    <span class="n">temp_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_col</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_row</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">y_list_sec</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)):</span>
            <span class="n">temp_row</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)):</span>
                <span class="n">temp_col</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_sec_axis</span><span class="p">)):</span>
                    <span class="c1"># if baseline is not None and len(adap_vs_stat_data_y_sec) &gt; 0:</span>
                    <span class="c1">#     temp = [</span>
                    <span class="c1">#         [i, j],</span>
                    <span class="c1">#         f&#39;{rows[i]}_{cols[j]}&#39;,</span>
                    <span class="c1">#         [</span>
                    <span class="c1">#             df_for_graph[[x for x in df_for_graph.columns if rows[i] in x and cols[j] in x and dataset in x]]</span>
                    <span class="c1">#             for dataset in adap_vs_stat_data_y_sec</span>
                    <span class="c1">#         ],</span>
                    <span class="c1">#         [dataset for dataset in adap_vs_stat_data_y_sec],</span>
                    <span class="c1">#         [color for color in colorlist_y_sec_axis]</span>
                    <span class="c1">#     ]</span>
                    <span class="c1"># else:</span>
                    <span class="n">temp</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;axis&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span>
                        <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">rows</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">cols</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;dataframe&#39;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="n">df_for_graph</span><span class="p">[[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df_for_graph</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">rows</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">x</span> <span class="ow">and</span> <span class="n">cols</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">in</span> <span class="n">x</span> <span class="ow">and</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]]</span>
                            <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">data_on_y_sec_axis</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                        <span class="p">],</span>
                        <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">dataset</span> <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">data_on_y_sec_axis</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span>
                        <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">color</span> <span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">colorlist_y_sec_axis</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span>
                        <span class="s1">&#39;best fit line deg&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">deg</span> <span class="k">for</span> <span class="n">deg</span> <span class="ow">in</span> <span class="n">best_fit_deg_y_sec_axis</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
                    <span class="p">}</span>
                    <span class="n">temp_col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                <span class="n">temp_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_col</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_list_sec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_row</span><span class="p">)</span>


        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The number of rows and the list of these is going to be:&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No. of rows = </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;List of rows:&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="n">rows</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rename_rows</span> <span class="o">=</span> <span class="s1">&#39;n&#39;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">i</span> <span class="ow">in</span> <span class="n">rows</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">rows_renaming_dict</span><span class="p">]]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rows_new_names</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">rows_renaming_dict</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">rows_new_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rows_renaming_dict</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The renamed rows are going to be:&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rows_new_names</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rename_rows</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">rename_rows_user_input</span> <span class="o">=</span> <span class="s1">&#39;n&#39;</span>
        <span class="k">if</span> <span class="n">rows_renaming_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rename_rows_user_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Do you want to rename the rows? [y/n]: &#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">i</span> <span class="ow">in</span> <span class="n">rows</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">rows_renaming_dict</span><span class="p">]])):</span>
                <span class="n">rename_rows_user_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Not all of the old names you have entered in rows_new_names were found. &#39;</span>
                                         <span class="s1">&#39;Therefore, if you still want to rename the rows, you will have to enter the new names now. &#39;</span>
                                         <span class="s1">&#39;Do you want to rename the rows? [y/n]: &#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">if</span> <span class="n">rename_rows_user_input</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rows_new_names</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
                <span class="n">new_name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Please enter the new name for </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">: &#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rows_new_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_name</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The renamed rows are going to be:&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rows_new_names</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rename_rows</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span>

        <span class="c1"># elif rename_rows:</span>
        <span class="c1">#     if len(self.rows_new_names) == 0:</span>
        <span class="c1">#         self.rename_rows = input(&#39;Do you want to rename the rows? [y/n]: &#39;)</span>
        <span class="c1">#         if self.rename_rows == &#39;y&#39;:</span>
        <span class="c1">#             self.rows_new_names = []</span>
        <span class="c1">#             for i in rows:</span>
        <span class="c1">#                 new_name = input(f&#39;Please enter the new name for {i}: &#39;)</span>
        <span class="c1">#                 self.rows_new_names.append(new_name)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The number of columns and the list of these is going to be:&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No. of columns = </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;List of columns:&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="n">cols</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rename_cols</span> <span class="o">=</span> <span class="s1">&#39;n&#39;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">i</span> <span class="ow">in</span> <span class="n">cols</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">cols_renaming_dict</span><span class="p">]]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cols_new_names</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">cols_renaming_dict</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">cols_new_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cols_renaming_dict</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The renamed columns are going to be:&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cols_new_names</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rename_cols</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">rename_cols_user_input</span> <span class="o">=</span> <span class="s1">&#39;n&#39;</span>
        <span class="k">if</span> <span class="n">cols_renaming_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rename_cols_user_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Column names will be the subplot titles. Do you want to rename them? [y/n]: &#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">i</span> <span class="ow">in</span> <span class="n">cols</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">cols_renaming_dict</span><span class="p">]])):</span>
                <span class="n">rename_cols_user_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Not all of the old names you have entered in cols_new_names were found. &#39;</span>
                                         <span class="s1">&#39;Therefore, if you still want to rename the columns, you will have to enter the new names now. &#39;</span>
                                         <span class="s1">&#39;Do you want to rename the columns? [y/n]: &#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="n">rename_cols_user_input</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cols_new_names</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
                <span class="n">new_name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Please enter the new name for </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">: &#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cols_new_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_name</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The renamed columns are going to be:&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cols_new_names</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rename_cols</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span>

        <span class="c1"># elif rename_cols:</span>
        <span class="c1">#     if len(self.cols_new_names) == 0:</span>
        <span class="c1">#         self.rename_cols = input(&#39;Column names will be the subplot titles. Do you want to rename them? [y/n]: &#39;)</span>
        <span class="c1">#         if self.rename_cols == &#39;y&#39;:</span>
        <span class="c1">#             self.cols_new_names = []</span>
        <span class="c1">#             for i in cols:</span>
        <span class="c1">#                 new_name = input(f&#39;Please enter the new name for {i}: &#39;)</span>
        <span class="c1">#                 self.cols_new_names.append(new_name)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">=</span> <span class="n">rows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cols</span> <span class="o">=</span> <span class="n">cols</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_for_graph</span> <span class="o">=</span> <span class="n">df_for_graph</span></div>



<div class="viewcode-block" id="Table.scatter_plot">
<a class="viewcode-back" href="../../../../accim.data.postprocessing.html#accim.data.postprocessing.main.Table.scatter_plot">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">scatter_plot</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">vars_to_gather_cols</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">vars_to_gather_rows</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">detailed_cols</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">detailed_rows</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">custom_cols_order</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">custom_rows_order</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">data_on_x_axis</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">data_on_y_main_axis</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">data_on_y_sec_axis</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">colorlist_y_main_axis</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">colorlist_y_sec_axis</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">best_fit_deg_y_main_axis</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">best_fit_deg_y_sec_axis</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">rows_renaming_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">cols_renaming_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">sharex</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">sharey</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">supxlabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">figname</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">figsize</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">ratio_height_to_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">dpi</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
            <span class="n">confirm_graph</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">set_facecolor</span><span class="p">:</span> <span class="nb">any</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">),</span>
            <span class="n">best_fit_background_linewidth</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">best_fit_linewidth</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
            <span class="n">best_fit_linestyle</span><span class="p">:</span> <span class="nb">any</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)),</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Used to plot a scatter plot.</span>

<span class="sd">        :param vars_to_gather_cols: A list of strings.</span>
<span class="sd">            The list should be the variables you want to show in subplot columns.</span>
<span class="sd">        :type vars_to_gather_cols: list</span>
<span class="sd">        :param vars_to_gather_rows: A list of strings.</span>
<span class="sd">            The list should be the variables you want to show in subplot rows.</span>
<span class="sd">        :type vars_to_gather_rows: list</span>
<span class="sd">        :param detailed_cols: A list of strings.</span>
<span class="sd">            The list should be the specific data you want to show in subplots columns.</span>
<span class="sd">            Used to filter.</span>
<span class="sd">        :type detailed_cols: list</span>
<span class="sd">        :param detailed_rows: A list of strings.</span>
<span class="sd">            The list should be the specific data you want to show in subplots rows.</span>
<span class="sd">            Used to filter.</span>
<span class="sd">        :type detailed_rows: list</span>
<span class="sd">        :param custom_cols_order: A list of strings.</span>
<span class="sd">            The list should be the specific order for the items shown in subplot columns.</span>
<span class="sd">        :type custom_cols_order: list</span>
<span class="sd">        :param custom_rows_order: A list of strings.</span>
<span class="sd">            The list should be the specific order for the items shown in subplot rows.</span>
<span class="sd">        :type custom_rows_order: list</span>
<span class="sd">        :param data_on_x_axis: A string. The column name you want to plot in the x-axis.</span>
<span class="sd">        :type data_on_x_axis: str</span>
<span class="sd">        :param data_on_y_main_axis: A list with nested lists and strings.</span>
<span class="sd">            Used to select the data you want to show in the scatter plot main y-axis.</span>
<span class="sd">            It needs to follow this structure:</span>
<span class="sd">            [[&#39;name_on_y_main_axis&#39;, [list of column names you want to plot]]]</span>
<span class="sd">        :type data_on_y_main_axis: list</span>
<span class="sd">        :param data_on_y_sec_axis: A list with nested lists and strings.</span>
<span class="sd">            Used to select the data you want to show in the scatter plot secondary y-axis.</span>
<span class="sd">            It needs to follow this structure:</span>
<span class="sd">            [[[&#39;name_on_1st_y_sec_axis&#39;, [list of column names you want to plot]], [&#39;name_on_2nd_y_sec_axis&#39;, [list of column names you want to plot]], etc]</span>
<span class="sd">        :type data_on_y_sec_axis: list</span>
<span class="sd">        :param colorlist_y_main_axis: A list with nested lists and strings.</span>
<span class="sd">            It should follow the same structure as data_on_y_main_axis,</span>
<span class="sd">            but replacing the column names with the colors using the matplotlib notation.</span>
<span class="sd">        :type colorlist_y_main_axis: list</span>
<span class="sd">        :param colorlist_y_sec_axis: A list with nested lists and strings.</span>
<span class="sd">            It should follow the same structure as data_on_y_sec_axis,</span>
<span class="sd">            but replacing the column names with the colors using the matplotlib notation.</span>
<span class="sd">        :type colorlist_y_sec_axis: list</span>
<span class="sd">        :param best_fit_deg_y_sec_axis: A list with nested lists and strings.</span>
<span class="sd">            It should follow the same structure as data_on_y_sec_axis,</span>
<span class="sd">            but replacing the column names with the polynomial degree for the best fit lines.</span>
<span class="sd">        :type best_fit_deg_y_sec_axis: list</span>
<span class="sd">        :param best_fit_deg_y_main_axis: A list with nested lists and strings.</span>
<span class="sd">            It should follow the same structure as data_on_y_main_axis,</span>
<span class="sd">            but replacing the column names with the polynomial degree for the best fit lines.</span>
<span class="sd">        :type best_fit_deg_y_main_axis: list</span>
<span class="sd">        :param rows_renaming_dict: A dictionary. Should follow the pattern</span>
<span class="sd">            {&#39;old row name 1&#39;: &#39;new row name 1&#39;, &#39;old row name 2&#39;: &#39;new row name 2&#39;}</span>
<span class="sd">        :type rows_renaming_dict: dict</span>
<span class="sd">        :param cols_renaming_dict: A dictionary. Should follow the pattern</span>
<span class="sd">            {&#39;old col name 1&#39;: &#39;new col name 1&#39;, &#39;old col name 2&#39;: &#39;new col name 2&#39;}</span>
<span class="sd">        :type cols_renaming_dict: dict</span>
<span class="sd">        :param sharey: True to share the x-axis across all subplots</span>
<span class="sd">        :type sharey: bool</span>
<span class="sd">        :param sharex: True to share the y-axis across all subplots</span>
<span class="sd">        :type sharex: bool</span>
<span class="sd">        :param supxlabel: A string. The label shown in the x-axis.</span>
<span class="sd">        :type supxlabel: str</span>
<span class="sd">        :param figname: A string. The name of the saved figure without extension.</span>
<span class="sd">        :type figname: str</span>
<span class="sd">        :param figsize: A float. It is the figure size.</span>
<span class="sd">        :type figsize: float</span>
<span class="sd">        :param ratio_height_to_width: A float. By default, is 1 (squared). If 0.5 is entered, the figure will be half higher than wide.</span>
<span class="sd">        :type ratio_height_to_width: float</span>
<span class="sd">        :param dpi: An integer. The number of dpis for image quality.</span>
<span class="sd">        :type dpi: int</span>
<span class="sd">        :param confirm_graph: A bool. True to skip confirmation step.</span>
<span class="sd">        :type confirm_graph: bool</span>
<span class="sd">        :param set_facecolor: Usage is similar to matplotlib.axes.Axes.set_facecolor</span>
<span class="sd">        :type set_facecolor: any</span>
<span class="sd">        :param best_fit_linestyle: Anything in matplotlib linestyle notation. Use to change the style of the best fit lines.</span>
<span class="sd">        :type best_fit_linestyle: any</span>
<span class="sd">        :param best_fit_linewidth: A float. Used to change the width of the best fit lines.</span>
<span class="sd">        :type best_fit_linewidth: float</span>
<span class="sd">        :param best_fit_background_linewidth: A float.</span>
<span class="sd">            Used to change the width of the background best fit lines.</span>
<span class="sd">            Must be greater than best_fit_linewidth.</span>
<span class="sd">        :type best_fit_background_linewidth: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.patheffects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pe</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">LinearRegression</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">PolynomialFeatures</span>

        <span class="c1"># todo testing from here</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">generate_fig_data</span><span class="p">(</span>
            <span class="n">vars_to_gather_cols</span><span class="o">=</span><span class="n">vars_to_gather_cols</span><span class="p">,</span>
            <span class="n">vars_to_gather_rows</span><span class="o">=</span><span class="n">vars_to_gather_rows</span><span class="p">,</span>
            <span class="n">detailed_cols</span><span class="o">=</span><span class="n">detailed_cols</span><span class="p">,</span>
            <span class="n">detailed_rows</span><span class="o">=</span><span class="n">detailed_rows</span><span class="p">,</span>
            <span class="n">custom_cols_order</span><span class="o">=</span><span class="n">custom_cols_order</span><span class="p">,</span>
            <span class="n">custom_rows_order</span><span class="o">=</span><span class="n">custom_rows_order</span><span class="p">,</span>
            <span class="n">data_on_y_main_axis</span><span class="o">=</span><span class="n">data_on_y_main_axis</span><span class="p">,</span>
            <span class="n">data_on_y_sec_axis</span><span class="o">=</span><span class="n">data_on_y_sec_axis</span><span class="p">,</span>
            <span class="n">data_on_x_axis</span><span class="o">=</span><span class="n">data_on_x_axis</span><span class="p">,</span>
            <span class="n">colorlist_y_main_axis</span><span class="o">=</span><span class="n">colorlist_y_main_axis</span><span class="p">,</span>
            <span class="n">colorlist_y_sec_axis</span><span class="o">=</span><span class="n">colorlist_y_sec_axis</span><span class="p">,</span>
            <span class="n">best_fit_deg_y_main_axis</span><span class="o">=</span><span class="n">best_fit_deg_y_main_axis</span><span class="p">,</span>
            <span class="n">best_fit_deg_y_sec_axis</span><span class="o">=</span><span class="n">best_fit_deg_y_sec_axis</span><span class="p">,</span>
            <span class="n">rows_renaming_dict</span><span class="o">=</span><span class="n">rows_renaming_dict</span><span class="p">,</span>
            <span class="n">cols_renaming_dict</span><span class="o">=</span><span class="n">cols_renaming_dict</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># todo testing until here</span>

        <span class="n">rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span>

        <span class="c1"># print(f&#39;The number of rows and the list of these is going to be:&#39;)</span>
        <span class="c1"># print(f&#39;No. of rows = {len(rows)}&#39;)</span>
        <span class="c1"># print(f&#39;List of rows:&#39;)</span>
        <span class="c1"># print(*rows, sep=&#39;\n&#39;)</span>
        <span class="c1">#</span>
        <span class="c1"># print(f&#39;The number of columns and the list of these is going to be:&#39;)</span>
        <span class="c1"># print(f&#39;No. of columns = {len(cols)}&#39;)</span>
        <span class="c1"># print(f&#39;List of columns:&#39;)</span>
        <span class="c1"># print(*cols, sep=&#39;\n&#39;)</span>

        <span class="k">if</span> <span class="n">confirm_graph</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">proceed</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Do you want to proceed? [y/n]:&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;y&#39;</span> <span class="ow">in</span> <span class="n">proceed</span><span class="p">:</span>
                <span class="n">confirm_graph</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="s1">&#39;n&#39;</span> <span class="ow">in</span> <span class="n">proceed</span><span class="p">:</span>
                <span class="n">confirm_graph</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">confirm_graph</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
                <span class="n">nrows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">),</span>
                <span class="n">ncols</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">),</span>
                <span class="n">sharex</span><span class="o">=</span><span class="n">sharex</span><span class="p">,</span>
                <span class="n">sharey</span><span class="o">=</span><span class="n">sharey</span><span class="p">,</span>
                <span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">figsize</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">),</span> <span class="n">ratio_height_to_width</span> <span class="o">*</span> <span class="n">figsize</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">))</span>
            <span class="p">)</span>

            <span class="n">main_y_axis</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">sec_y_axis</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)):</span>
                <span class="n">main_y_axis_temp_rows</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">sec_y_axis_temp_rows</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)):</span>

                    <span class="n">main_y_axis_temp_cols</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">sec_y_axis_temp_cols</span> <span class="o">=</span> <span class="p">[]</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_main_axis</span><span class="p">)):</span>
                            <span class="n">main_y_axis_temp_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
                        <span class="n">main_y_axis_temp_rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">main_y_axis_temp_cols</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_sec_axis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_sec_axis</span><span class="p">)):</span>
                                <span class="n">sec_y_axis_temp_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">())</span>
                            <span class="n">sec_y_axis_temp_rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sec_y_axis_temp_cols</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_main_axis</span><span class="p">)):</span>
                            <span class="n">main_y_axis_temp_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="n">main_y_axis_temp_rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">main_y_axis_temp_cols</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_sec_axis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_sec_axis</span><span class="p">)):</span>
                                <span class="n">sec_y_axis_temp_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">twinx</span><span class="p">())</span>
                            <span class="n">sec_y_axis_temp_rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sec_y_axis_temp_cols</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="c1"># continue</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_main_axis</span><span class="p">)):</span>
                            <span class="n">main_y_axis_temp_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                        <span class="n">main_y_axis_temp_rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">main_y_axis_temp_cols</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_sec_axis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_sec_axis</span><span class="p">)):</span>
                                <span class="n">sec_y_axis_temp_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">twinx</span><span class="p">())</span>
                            <span class="n">sec_y_axis_temp_rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sec_y_axis_temp_cols</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_main_axis</span><span class="p">)):</span>
                            <span class="n">main_y_axis_temp_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
                        <span class="n">main_y_axis_temp_rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">main_y_axis_temp_cols</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_sec_axis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_sec_axis</span><span class="p">)):</span>
                                <span class="n">sec_y_axis_temp_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">twinx</span><span class="p">())</span>
                            <span class="n">sec_y_axis_temp_rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sec_y_axis_temp_cols</span><span class="p">)</span>
                <span class="n">main_y_axis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">main_y_axis_temp_rows</span><span class="p">)</span>
                <span class="n">sec_y_axis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sec_y_axis_temp_rows</span><span class="p">)</span>

            <span class="c1"># if len(rows) == 1 and len(cols) &gt; 1:</span>


            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)):</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])):</span>
                        <span class="n">main_y_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">)</span>
                        <span class="n">main_y_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span>
                                                         <span class="n">grid_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                                                         <span class="n">grid_alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                        <span class="n">main_y_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">set_facecolor</span><span class="p">)</span>

                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;dataframe&#39;</span><span class="p">])):</span>

                            <span class="k">if</span> <span class="s1">&#39;Setpoint Temperature&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">]:</span>
                                <span class="n">zord</span> <span class="o">=</span> <span class="mi">1</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">zord</span> <span class="o">=</span> <span class="mi">0</span>

                            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">main_y_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">x_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;dataframe&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                    <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;color&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                    <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
                                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                                    <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                    <span class="n">zorder</span><span class="o">=</span><span class="n">zord</span>
                                <span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">main_y_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">x_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;dataframe&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                    <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;color&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                    <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
                                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                                    <span class="n">zorder</span><span class="o">=</span><span class="n">zord</span>
                                <span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)):</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_sec</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])):</span>
                        <span class="n">sec_y_axis</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">get_shared_y_axes</span><span class="p">()</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sec_y_axis</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">k</span><span class="p">],</span> <span class="n">sec_y_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">])</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_sec_axis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_sec</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                                    <span class="n">sec_y_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
                                    <span class="n">sec_y_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
                                <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                                    <span class="n">sec_y_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_sec_axis</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                                    <span class="n">sec_y_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="s2">&quot;axes&quot;</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="mf">0.15</span><span class="p">))</span>
                                    <span class="n">sec_y_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_sec</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;dataframe&#39;</span><span class="p">])):</span>
                            <span class="k">if</span> <span class="s1">&#39;Setpoint Temperature&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_list_sec</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">]:</span>
                                <span class="n">zord</span> <span class="o">=</span> <span class="mi">1</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">zord</span> <span class="o">=</span> <span class="mi">0</span>
                            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">sec_y_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">x_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">y_list_sec</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;dataframe&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                    <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_sec</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;color&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                    <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
                                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                                    <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_sec</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                    <span class="n">zorder</span><span class="o">=</span><span class="n">zord</span><span class="p">,</span>
                                <span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">sec_y_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">x_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">y_list_sec</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;dataframe&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                    <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_sec</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;color&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                    <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
                                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                                    <span class="n">zorder</span><span class="o">=</span><span class="n">zord</span><span class="p">,</span>
                                <span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)):</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])):</span>
                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;dataframe&#39;</span><span class="p">])):</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;best fit line deg&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">poly_features</span> <span class="o">=</span> <span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;best fit line deg&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span> <span class="n">include_bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                                <span class="c1"># todo: not sure, but I think when some csv has rows,</span>
                                <span class="c1">#  it must be removed for all datasets to have the same size,</span>
                                <span class="c1">#  otherwise it is filled with a NaN</span>
                                <span class="n">X_poly</span> <span class="o">=</span> <span class="n">poly_features</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
                                <span class="n">lin_reg</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
                                <span class="n">lin_reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_poly</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;dataframe&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
                                <span class="n">main_y_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">x_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
                                    <span class="n">lin_reg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_poly</span><span class="p">),</span>
                                    <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;color&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                    <span class="c1"># linestyle=&#39;--&#39;,</span>
                                    <span class="n">linestyle</span><span class="o">=</span><span class="n">best_fit_linestyle</span><span class="p">,</span>
                                    <span class="n">linewidth</span><span class="o">=</span><span class="n">best_fit_linewidth</span><span class="p">,</span>
                                    <span class="n">path_effects</span><span class="o">=</span><span class="p">[</span><span class="n">pe</span><span class="o">.</span><span class="n">Stroke</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="n">best_fit_background_linewidth</span><span class="p">,</span> <span class="n">foreground</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">),</span> <span class="n">pe</span><span class="o">.</span><span class="n">Normal</span><span class="p">()],</span>
                                    <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span>
                                <span class="p">)</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_sec</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])):</span>
                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_sec</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;dataframe&#39;</span><span class="p">])):</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_list_sec</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;best fit line deg&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">poly_features</span> <span class="o">=</span> <span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_sec</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;best fit line deg&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span> <span class="n">include_bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                                <span class="n">X_poly</span> <span class="o">=</span> <span class="n">poly_features</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
                                <span class="n">lin_reg</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
                                <span class="n">lin_reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_poly</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_list_sec</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;dataframe&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
                                <span class="n">sec_y_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">x_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
                                    <span class="n">lin_reg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_poly</span><span class="p">),</span>
                                    <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_sec</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;color&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                    <span class="c1"># linestyle=&#39;--&#39;,</span>
                                    <span class="n">linestyle</span><span class="o">=</span><span class="n">best_fit_linestyle</span><span class="p">,</span>
                                    <span class="n">linewidth</span><span class="o">=</span><span class="n">best_fit_linewidth</span><span class="p">,</span>
                                    <span class="n">path_effects</span><span class="o">=</span><span class="p">[</span><span class="n">pe</span><span class="o">.</span><span class="n">Stroke</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="n">best_fit_background_linewidth</span><span class="p">,</span> <span class="n">foreground</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">),</span> <span class="n">pe</span><span class="o">.</span><span class="n">Normal</span><span class="p">()],</span>
                                    <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span>
                                <span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rename_rows</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                        <span class="c1"># if self.rows_new_names is not None:</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows_new_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rename_cols</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                        <span class="c1"># if self.cols_new_names is not None:</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols_new_names</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">cols</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rename_rows</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                        <span class="c1"># if self.rows_new_names is not None:</span>
                            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows_new_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rename_cols</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                        <span class="c1"># if self.cols_new_names is not None:</span>
                            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols_new_names</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">cols</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rename_rows</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                        <span class="c1"># if self.rows_new_names is not None:</span>
                            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows_new_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rename_cols</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                        <span class="c1"># if self.cols_new_names is not None:</span>
                            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols_new_names</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">cols</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

            <span class="n">supx</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">supxlabel</span><span class="p">(</span><span class="n">supxlabel</span><span class="p">)</span>
            <span class="n">supy</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">supylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_main_axis</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">leg</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
                <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span>
                <span class="c1"># borderaxespad=0.1,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_sec_axis</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">rhstext</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_sec_axis</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_sec_axis</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">bbox_extra_artists_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="n">rhstext</span><span class="p">,</span> <span class="n">leg</span><span class="p">,</span> <span class="n">supx</span><span class="p">,</span> <span class="n">supy</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bbox_extra_artists_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="n">leg</span><span class="p">,</span> <span class="n">supx</span><span class="p">,</span> <span class="n">supy</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">leg</span><span class="o">.</span><span class="n">legendHandles</span><span class="p">)):</span>
                <span class="n">leg</span><span class="o">.</span><span class="n">legendHandles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">30</span><span class="p">]</span>

            <span class="c1"># plt.subplots_adjust(bottom=0.2)</span>
            <span class="c1"># plt.tight_layout()</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span>
                        <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span>
                        <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span>
                        <span class="n">bbox_extra_artists</span><span class="o">=</span><span class="n">bbox_extra_artists_tuple</span><span class="p">,</span>
                        <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">=</span> <span class="n">rows</span></div>


<div class="viewcode-block" id="Table.scatter_plot_with_baseline">
<a class="viewcode-back" href="../../../../accim.data.postprocessing.html#accim.data.postprocessing.main.Table.scatter_plot_with_baseline">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">scatter_plot_with_baseline</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">vars_to_gather_cols</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">vars_to_gather_rows</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">detailed_cols</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">detailed_rows</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">custom_cols_order</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">custom_rows_order</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">data_on_y_axis_baseline_plot</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">baseline</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">colorlist_baseline_plot_data</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">best_fit_deg</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">rows_renaming_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">cols_renaming_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">supxlabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">supylabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">figname</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">figsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">markersize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">dpi</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
            <span class="n">confirm_graph</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">set_facecolor</span><span class="p">:</span> <span class="nb">any</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">),</span>
            <span class="n">best_fit_background_linewidth</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">best_fit_linewidth</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
            <span class="n">best_fit_linestyle</span><span class="p">:</span> <span class="nb">any</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)),</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Used to plot a scatter plot with baseline.</span>

<span class="sd">        :param vars_to_gather_cols: A list of strings.</span>
<span class="sd">            The list should be the variables you want to show in subplot columns.</span>
<span class="sd">        :type vars_to_gather_cols: list</span>
<span class="sd">        :param vars_to_gather_rows: A list of strings.</span>
<span class="sd">            The list should be the variables you want to show in subplot rows.</span>
<span class="sd">        :type vars_to_gather_rows: list</span>
<span class="sd">        :param detailed_cols: A list of strings.</span>
<span class="sd">            The list should be the specific data you want to show in subplots columns.</span>
<span class="sd">            Used to filter.</span>
<span class="sd">        :type detailed_cols: list</span>
<span class="sd">        :param detailed_rows: A list of strings.</span>
<span class="sd">            The list should be the specific data you want to show in subplots rows.</span>
<span class="sd">            Used to filter.</span>
<span class="sd">        :type detailed_rows: list</span>
<span class="sd">        :param custom_cols_order: A list of strings.</span>
<span class="sd">            The list should be the specific order for the items shown in subplot columns.</span>
<span class="sd">        :type custom_cols_order: list</span>
<span class="sd">        :param custom_rows_order: A list of strings.</span>
<span class="sd">            The list should be the specific order for the items shown in subplot rows.</span>
<span class="sd">        :type custom_rows_order: list</span>
<span class="sd">        :param data_on_y_axis_baseline_plot: A list of strings.</span>
<span class="sd">            Used to select the data you want to show in the graph.</span>
<span class="sd">            Should be a list of the column names you want to plot in each subplot.</span>
<span class="sd">        :type data_on_y_axis_baseline_plot: list</span>
<span class="sd">        :param baseline: A string, used only in data_on_y_axis_baseline_plot.</span>
<span class="sd">            The baseline should be one of the combinations in vars_to_gather_cols.</span>
<span class="sd">            It will be plotted in x-axis,</span>
<span class="sd">            while the reference combination for comparison in y-axis.</span>
<span class="sd">        :type baseline: str</span>
<span class="sd">        :param colorlist_baseline_plot_data: A list of strings.</span>
<span class="sd">            Should be the colors using the matplotlib color notation</span>
<span class="sd">            for the columns entered in data_on_y_axis_baseline_plot in the same order.</span>
<span class="sd">        :type colorlist_baseline_plot_data: list</span>
<span class="sd">        :param best_fit_deg: A list with nested lists and strings.</span>
<span class="sd">            It should follow the same structure as data_on_y_axis_baseline_plot,</span>
<span class="sd">            but replacing the column names with the polynomial degree for the best fit lines.</span>
<span class="sd">        :type best_fit_deg: list</span>
<span class="sd">        :param rows_renaming_dict: A dictionary. Should follow the pattern</span>
<span class="sd">            {&#39;old row name 1&#39;: &#39;new row name 1&#39;, &#39;old row name 2&#39;: &#39;new row name 2&#39;}</span>
<span class="sd">        :type rows_renaming_dict: dict</span>
<span class="sd">        :param cols_renaming_dict: A dictionary. Should follow the pattern</span>
<span class="sd">            {&#39;old col name 1&#39;: &#39;new col name 1&#39;, &#39;old col name 2&#39;: &#39;new col name 2&#39;}</span>
<span class="sd">        :type cols_renaming_dict: dict</span>
<span class="sd">        :param supxlabel: A string. The label shown in the x-axis.</span>
<span class="sd">        :type supxlabel: str</span>
<span class="sd">        :param supylabel: A string. The label shown in the y-axis.</span>
<span class="sd">        :type supylabel: str</span>
<span class="sd">        :param figname: A string. The name of the saved figure without extension.</span>
<span class="sd">        :type figname: str</span>
<span class="sd">        :param figsize: A float. It is the figure size.</span>
<span class="sd">        :type figsize: float</span>
<span class="sd">        :param markersize: An integer. The size of the markers.</span>
<span class="sd">        :type markersize: int</span>
<span class="sd">        :param dpi: An integer. The number of dpis for image quality.</span>
<span class="sd">        :type dpi: int</span>
<span class="sd">        :param confirm_graph: A bool. True to skip confirmation step.</span>
<span class="sd">        :type confirm_graph: bool</span>
<span class="sd">        :param best_fit_linestyle: Anything in matplotlib linestyle notation.</span>
<span class="sd">            Use to change the style of the best fit lines.</span>
<span class="sd">        :type best_fit_linestyle: any</span>
<span class="sd">        :param best_fit_linewidth: A float. Used to change the width of the best fit lines.</span>
<span class="sd">        :type best_fit_linewidth: float</span>
<span class="sd">        :param best_fit_background_linewidth: A float. Used to change the width of the</span>
<span class="sd">            background best fit lines. Must be greater than best_fit_linewidth.</span>
<span class="sd">        :type best_fit_background_linewidth: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.lines</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">lines</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.patheffects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pe</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">LinearRegression</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">PolynomialFeatures</span>


        <span class="c1"># todo testing from here</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">generate_fig_data</span><span class="p">(</span>
            <span class="n">vars_to_gather_cols</span><span class="o">=</span><span class="n">vars_to_gather_cols</span><span class="p">,</span>
            <span class="n">vars_to_gather_rows</span><span class="o">=</span><span class="n">vars_to_gather_rows</span><span class="p">,</span>
            <span class="n">detailed_cols</span><span class="o">=</span><span class="n">detailed_cols</span><span class="p">,</span>
            <span class="n">detailed_rows</span><span class="o">=</span><span class="n">detailed_rows</span><span class="p">,</span>
            <span class="n">custom_cols_order</span><span class="o">=</span><span class="n">custom_cols_order</span><span class="p">,</span>
            <span class="n">custom_rows_order</span><span class="o">=</span><span class="n">custom_rows_order</span><span class="p">,</span>
            <span class="n">data_on_y_axis_baseline_plot</span><span class="o">=</span><span class="n">data_on_y_axis_baseline_plot</span><span class="p">,</span>
            <span class="n">baseline</span><span class="o">=</span><span class="n">baseline</span><span class="p">,</span>
            <span class="n">colorlist_baseline_plot_data</span><span class="o">=</span><span class="n">colorlist_baseline_plot_data</span><span class="p">,</span>
            <span class="n">best_fit_deg</span><span class="o">=</span><span class="n">best_fit_deg</span><span class="p">,</span>
            <span class="n">rows_renaming_dict</span><span class="o">=</span><span class="n">rows_renaming_dict</span><span class="p">,</span>
            <span class="n">cols_renaming_dict</span><span class="o">=</span><span class="n">cols_renaming_dict</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># todo testing until here</span>

        <span class="c1"># print(f&#39;The number of rows and the list of these is going to be:&#39;)</span>
        <span class="c1"># print(f&#39;No. of rows = {len(self.rows)}&#39;)</span>
        <span class="c1"># print(f&#39;List of self.rows:&#39;)</span>
        <span class="c1"># print(*self.rows, sep=&#39;\n&#39;)</span>
        <span class="c1">#</span>
        <span class="c1"># print(f&#39;The number of columns and the list of these is going to be:&#39;)</span>
        <span class="c1"># print(f&#39;No. of columns = {len(self.cols)}&#39;)</span>
        <span class="c1"># print(f&#39;List of columns:&#39;)</span>
        <span class="c1"># print(*self.cols, sep=&#39;\n&#39;)</span>

        <span class="k">if</span> <span class="n">confirm_graph</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">proceed</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Do you want to proceed? [y/n]:&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;y&#39;</span> <span class="ow">in</span> <span class="n">proceed</span><span class="p">:</span>
                <span class="n">confirm_graph</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="s1">&#39;n&#39;</span> <span class="ow">in</span> <span class="n">proceed</span><span class="p">:</span>
                <span class="n">confirm_graph</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">confirm_graph</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">),</span>
                                   <span class="n">ncols</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">),</span>
                                   <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">figsize</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">),</span> <span class="n">figsize</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)))</span>

            <span class="c1"># y_list_main_scatter</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="c1"># ax.set_title(f&#39;{self.rows[i]} / {self.cols[j]}&#39;)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span>
                                       <span class="n">grid_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                                       <span class="n">grid_alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">set_facecolor</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">((</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
                            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">],</span>
                            <span class="n">dashes</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span>
                        <span class="p">)))</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">((</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
                            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">],</span>
                            <span class="n">dashes</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span>
                        <span class="p">)))</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">((</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
                            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span> <span class="o">/</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">],</span>
                            <span class="n">dashes</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span>
                        <span class="p">)))</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">((</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
                            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">],</span>
                            <span class="n">dashes</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span>
                        <span class="p">)))</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">((</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
                            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span> <span class="o">/</span> <span class="mi">4</span><span class="p">],</span>
                            <span class="n">dashes</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span>
                        <span class="p">)))</span>

                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">])):</span>
                            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">x_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">k</span><span class="p">],</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">k</span><span class="p">],</span>
                                    <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">4</span><span class="p">][</span><span class="n">k</span><span class="p">],</span>
                                    <span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span>
                                    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                                    <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
                                <span class="p">)</span>
                                <span class="c1"># if len(self.adap_vs_stat_data_y_sec) &gt; 0:</span>
                                <span class="c1">#     ax.twinx().scatter(</span>
                                <span class="c1">#         self.x_list[i][j][2][k],</span>
                                <span class="c1">#         self.y_list_sec[i][j][2][k],</span>
                                <span class="c1">#         c=self.y_list_sec[i][j][4][k],</span>
                                <span class="c1">#         s=markersize,</span>
                                <span class="c1">#         marker=&#39;o&#39;,</span>
                                <span class="c1">#         alpha=0.5,</span>
                                <span class="c1">#         label=self.y_list_main[i][j][3][k]</span>
                                <span class="c1">#     )</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">x_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">k</span><span class="p">],</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">k</span><span class="p">],</span>
                                    <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">4</span><span class="p">][</span><span class="n">k</span><span class="p">],</span>
                                    <span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span>
                                    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                                <span class="p">)</span>
                                <span class="c1"># if len(self.adap_vs_stat_data_y_sec) &gt; 0:</span>
                                <span class="c1">#     ax.twinx().scatter(</span>
                                <span class="c1">#         self.x_list[i][j][2][k],</span>
                                <span class="c1">#         self.y_list_sec[i][j][2][k],</span>
                                <span class="c1">#         c=self.y_list_sec[i][j][4][k],</span>
                                <span class="c1">#         s=markersize,</span>
                                <span class="c1">#         marker=&#39;o&#39;,</span>
                                <span class="c1">#         alpha=0.5,</span>
                                <span class="c1">#         label=self.y_list_main[i][j][3][k]</span>
                                <span class="c1">#     )</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">5</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">poly_features</span> <span class="o">=</span> <span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">5</span><span class="p">][</span><span class="n">k</span><span class="p">],</span> <span class="n">include_bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                                <span class="n">X_poly</span> <span class="o">=</span> <span class="n">poly_features</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
                                <span class="n">lin_reg</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
                                <span class="n">lin_reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_poly</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">x_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
                                    <span class="n">lin_reg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_poly</span><span class="p">),</span>
                                    <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">4</span><span class="p">][</span><span class="n">k</span><span class="p">],</span>
                                    <span class="c1"># linestyle=&#39;--&#39;,</span>
                                    <span class="n">linestyle</span><span class="o">=</span><span class="n">best_fit_linestyle</span><span class="p">,</span>
                                    <span class="n">linewidth</span><span class="o">=</span><span class="n">best_fit_linewidth</span><span class="p">,</span>
                                    <span class="n">path_effects</span><span class="o">=</span><span class="p">[</span><span class="n">pe</span><span class="o">.</span><span class="n">Stroke</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="n">best_fit_background_linewidth</span><span class="p">,</span> <span class="n">foreground</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">),</span> <span class="n">pe</span><span class="o">.</span><span class="n">Normal</span><span class="p">()],</span>
                                    <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span>
                                <span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">))</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">))</span>

                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="c1"># ax[i].set_title(f&#39;{self.rows[i]} / {self.cols[j]}&#39;)</span>
                        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">)</span>
                        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span>
                                          <span class="n">grid_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                                          <span class="n">grid_alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">set_facecolor</span><span class="p">)</span>
                        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">add_artist</span><span class="p">((</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
                            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">],</span>
                            <span class="n">dashes</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span>
                        <span class="p">)))</span>
                        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">add_artist</span><span class="p">((</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
                            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">],</span>
                            <span class="n">dashes</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span>
                        <span class="p">)))</span>
                        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">add_artist</span><span class="p">((</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
                            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span> <span class="o">/</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">],</span>
                            <span class="n">dashes</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span>
                        <span class="p">)))</span>
                        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">add_artist</span><span class="p">((</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
                            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">],</span>
                            <span class="n">dashes</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span>
                        <span class="p">)))</span>
                        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">add_artist</span><span class="p">((</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
                            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span> <span class="o">/</span> <span class="mi">4</span><span class="p">],</span>
                            <span class="n">dashes</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span>
                        <span class="p">)))</span>

                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">])):</span>
                            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">x_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">k</span><span class="p">],</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">k</span><span class="p">],</span>
                                    <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">4</span><span class="p">][</span><span class="n">k</span><span class="p">],</span>
                                    <span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span>
                                    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                                    <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
                                <span class="p">)</span>
                                <span class="c1"># if len(self.adap_vs_stat_data_y_sec) &gt; 0:</span>
                                <span class="c1">#     ax[i].twinx().scatter(</span>
                                <span class="c1">#         self.x_list[i][j][2][k],</span>
                                <span class="c1">#         self.y_list_sec[i][j][2][k],</span>
                                <span class="c1">#         c=self.y_list_sec[i][j][4][k],</span>
                                <span class="c1">#         s=markersize,</span>
                                <span class="c1">#         marker=&#39;o&#39;,</span>
                                <span class="c1">#         alpha=0.5,</span>
                                <span class="c1">#         label=self.y_list_main[i][j][3][k]</span>
                                <span class="c1">#     )</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">x_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">k</span><span class="p">],</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">k</span><span class="p">],</span>
                                    <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">4</span><span class="p">][</span><span class="n">k</span><span class="p">],</span>
                                    <span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span>
                                    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                                <span class="p">)</span>
                                <span class="c1"># if len(self.adap_vs_stat_data_y_sec) &gt; 0:</span>
                                <span class="c1">#     ax[i].twinx().scatter(</span>
                                <span class="c1">#         self.x_list[i][j][2][k],</span>
                                <span class="c1">#         self.y_list_sec[i][j][2][k],</span>
                                <span class="c1">#         c=self.y_list_sec[i][j][4][k],</span>
                                <span class="c1">#         s=markersize,</span>
                                <span class="c1">#         marker=&#39;o&#39;,</span>
                                <span class="c1">#         alpha=0.5,</span>
                                <span class="c1">#         label=self.y_list_main[i][j][3][k]</span>
                                <span class="c1">#     )</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">5</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">poly_features</span> <span class="o">=</span> <span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">5</span><span class="p">][</span><span class="n">k</span><span class="p">],</span> <span class="n">include_bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                                <span class="n">X_poly</span> <span class="o">=</span> <span class="n">poly_features</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
                                <span class="n">lin_reg</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
                                <span class="n">lin_reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_poly</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
                                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">x_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
                                    <span class="n">lin_reg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_poly</span><span class="p">),</span>
                                    <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">4</span><span class="p">][</span><span class="n">k</span><span class="p">],</span>
                                    <span class="c1"># linestyle=&#39;--&#39;,</span>
                                    <span class="n">linestyle</span><span class="o">=</span><span class="n">best_fit_linestyle</span><span class="p">,</span>
                                    <span class="n">linewidth</span><span class="o">=</span><span class="n">best_fit_linewidth</span><span class="p">,</span>
                                    <span class="n">path_effects</span><span class="o">=</span><span class="p">[</span><span class="n">pe</span><span class="o">.</span><span class="n">Stroke</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="n">best_fit_background_linewidth</span><span class="p">,</span> <span class="n">foreground</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">),</span> <span class="n">pe</span><span class="o">.</span><span class="n">Normal</span><span class="p">()],</span>
                                    <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span>
                                <span class="p">)</span>

                        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">))</span>
                        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">))</span>

                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="c1"># ax[j].set_title(f&#39;{self.rows[i]} / {self.cols[j]}&#39;)</span>
                        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">)</span>
                        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span>
                                          <span class="n">grid_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                                          <span class="n">grid_alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">set_facecolor</span><span class="p">)</span>
                        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">add_artist</span><span class="p">((</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
                            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">],</span>
                            <span class="n">dashes</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span>
                        <span class="p">)))</span>
                        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">add_artist</span><span class="p">((</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
                            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">],</span>
                            <span class="n">dashes</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span>
                        <span class="p">)))</span>
                        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">add_artist</span><span class="p">((</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
                            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span> <span class="o">/</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">],</span>
                            <span class="n">dashes</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span>
                        <span class="p">)))</span>
                        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">add_artist</span><span class="p">((</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
                            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">],</span>
                            <span class="n">dashes</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span>
                        <span class="p">)))</span>
                        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">add_artist</span><span class="p">((</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
                            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span> <span class="o">/</span> <span class="mi">4</span><span class="p">],</span>
                            <span class="n">dashes</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span>
                        <span class="p">)))</span>

                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">])):</span>
                            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">x_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">k</span><span class="p">],</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">k</span><span class="p">],</span>
                                    <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">4</span><span class="p">][</span><span class="n">k</span><span class="p">],</span>
                                    <span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span>
                                    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                                    <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
                                <span class="p">)</span>
                                <span class="c1"># if len(self.adap_vs_stat_data_y_sec) &gt; 0:</span>
                                <span class="c1">#     ax[j].twinx().scatter(</span>
                                <span class="c1">#         self.x_list[i][j][2][k],</span>
                                <span class="c1">#         self.y_list_sec[i][j][2][k],</span>
                                <span class="c1">#         c=self.y_list_sec[i][j][4][k],</span>
                                <span class="c1">#         s=markersize,</span>
                                <span class="c1">#         marker=&#39;o&#39;,</span>
                                <span class="c1">#         alpha=0.5,</span>
                                <span class="c1">#         label=self.y_list_main[i][j][3][k]</span>
                                <span class="c1">#     )</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">x_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">k</span><span class="p">],</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">k</span><span class="p">],</span>
                                    <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">4</span><span class="p">][</span><span class="n">k</span><span class="p">],</span>
                                    <span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span>
                                    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                                <span class="p">)</span>
                                <span class="c1"># if len(self.adap_vs_stat_data_y_sec) &gt; 0:</span>
                                <span class="c1">#     ax[j].twinx().scatter(</span>
                                <span class="c1">#         self.x_list[i][j][2][k],</span>
                                <span class="c1">#         self.y_list_sec[i][j][2][k],</span>
                                <span class="c1">#         c=self.y_list_sec[i][j][4][k],</span>
                                <span class="c1">#         s=markersize,</span>
                                <span class="c1">#         marker=&#39;o&#39;,</span>
                                <span class="c1">#         alpha=0.5,</span>
                                <span class="c1">#         label=self.y_list_main[i][j][3][k]</span>
                                <span class="c1">#     )</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">5</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">poly_features</span> <span class="o">=</span> <span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">5</span><span class="p">][</span><span class="n">k</span><span class="p">],</span> <span class="n">include_bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                                <span class="n">X_poly</span> <span class="o">=</span> <span class="n">poly_features</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
                                <span class="n">lin_reg</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
                                <span class="n">lin_reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_poly</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
                                <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">x_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
                                    <span class="n">lin_reg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_poly</span><span class="p">),</span>
                                    <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">4</span><span class="p">][</span><span class="n">k</span><span class="p">],</span>
                                    <span class="c1"># linestyle=&#39;--&#39;,</span>
                                    <span class="n">linestyle</span><span class="o">=</span><span class="n">best_fit_linestyle</span><span class="p">,</span>
                                    <span class="n">linewidth</span><span class="o">=</span><span class="n">best_fit_linewidth</span><span class="p">,</span>
                                    <span class="n">path_effects</span><span class="o">=</span><span class="p">[</span><span class="n">pe</span><span class="o">.</span><span class="n">Stroke</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="n">best_fit_background_linewidth</span><span class="p">,</span> <span class="n">foreground</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">),</span> <span class="n">pe</span><span class="o">.</span><span class="n">Normal</span><span class="p">()],</span>
                                    <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span>
                                <span class="p">)</span>

                        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">))</span>
                        <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">))</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># ax[i, j].set_title(f&#39;{self.rows[i]} / {self.cols[j]}&#39;)</span>
                        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">)</span>
                        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span>
                                             <span class="n">grid_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                                             <span class="n">grid_alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">set_facecolor</span><span class="p">)</span>
                        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">add_artist</span><span class="p">((</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
                            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">],</span>
                            <span class="n">dashes</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span>
                        <span class="p">)))</span>
                        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">add_artist</span><span class="p">((</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
                            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">],</span>
                            <span class="n">dashes</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span>
                        <span class="p">)))</span>
                        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">add_artist</span><span class="p">((</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
                            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span> <span class="o">/</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">],</span>
                            <span class="n">dashes</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span>
                        <span class="p">)))</span>
                        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">add_artist</span><span class="p">((</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
                            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">],</span>
                            <span class="n">dashes</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span>
                        <span class="p">)))</span>
                        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">add_artist</span><span class="p">((</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
                            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span> <span class="o">/</span> <span class="mi">4</span><span class="p">],</span>
                            <span class="n">dashes</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span>
                        <span class="p">)))</span>

                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">])):</span>
                            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">x_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">k</span><span class="p">],</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">k</span><span class="p">],</span>
                                    <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">4</span><span class="p">][</span><span class="n">k</span><span class="p">],</span>
                                    <span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span>
                                    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                                    <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">3</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
                                <span class="p">)</span>
                                <span class="c1"># if len(self.adap_vs_stat_data_y_sec) &gt; 0:</span>
                                <span class="c1">#     ax[i, j].twinx().scatter(</span>
                                <span class="c1">#         self.x_list[i][j][2][k],</span>
                                <span class="c1">#         self.y_list_sec[i][j][2][k],</span>
                                <span class="c1">#         c=self.y_list_sec[i][j][4][k],</span>
                                <span class="c1">#         s=markersize,</span>
                                <span class="c1">#         marker=&#39;o&#39;,</span>
                                <span class="c1">#         alpha=0.5,</span>
                                <span class="c1">#         label=self.y_list_main[i][j][3][k]</span>
                                <span class="c1">#     )</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">x_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">k</span><span class="p">],</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">k</span><span class="p">],</span>
                                    <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">4</span><span class="p">][</span><span class="n">k</span><span class="p">],</span>
                                    <span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span>
                                    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                                <span class="p">)</span>
                                <span class="c1"># if len(self.adap_vs_stat_data_y_sec) &gt; 0:</span>
                                <span class="c1">#     ax[i, j].twinx().scatter(</span>
                                <span class="c1">#         self.x_list[i][j][2][k],</span>
                                <span class="c1">#         self.y_list_sec[i][j][2][k],</span>
                                <span class="c1">#         c=self.y_list_sec[i][j][4][k],</span>
                                <span class="c1">#         s=markersize,</span>
                                <span class="c1">#         marker=&#39;o&#39;,</span>
                                <span class="c1">#         alpha=0.5,</span>
                                <span class="c1">#         label=self.y_list_main[i][j][3][k]</span>
                                <span class="c1">#     )</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">5</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">poly_features</span> <span class="o">=</span> <span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">5</span><span class="p">][</span><span class="n">k</span><span class="p">],</span> <span class="n">include_bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                                <span class="n">X_poly</span> <span class="o">=</span> <span class="n">poly_features</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
                                <span class="n">lin_reg</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
                                <span class="n">lin_reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_poly</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">())</span>
                                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">x_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span>
                                    <span class="n">lin_reg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_poly</span><span class="p">),</span>
                                    <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">4</span><span class="p">][</span><span class="n">k</span><span class="p">],</span>
                                    <span class="c1"># linestyle=&#39;--&#39;,</span>
                                    <span class="n">linestyle</span><span class="o">=</span><span class="n">best_fit_linestyle</span><span class="p">,</span>
                                    <span class="n">linewidth</span><span class="o">=</span><span class="n">best_fit_linewidth</span><span class="p">,</span>
                                    <span class="n">path_effects</span><span class="o">=</span><span class="p">[</span><span class="n">pe</span><span class="o">.</span><span class="n">Stroke</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="n">best_fit_background_linewidth</span><span class="p">,</span> <span class="n">foreground</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">),</span> <span class="n">pe</span><span class="o">.</span><span class="n">Normal</span><span class="p">()],</span>
                                    <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span>
                                <span class="p">)</span>
                        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">))</span>
                        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">))</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span>
                                  <span class="c1"># adjustable=&#39;box&#39;,</span>
                                  <span class="s1">&#39;box&#39;</span><span class="p">,</span>
                                  <span class="n">share</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rename_rows</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                        <span class="c1"># if self.rows_new_names is not None:</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows_new_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rename_cols</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                        <span class="c1"># if self.cols_new_names is not None:</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols_new_names</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;box&#39;</span><span class="p">,</span>
                                     <span class="c1"># adjustable=&#39;box&#39;,</span>
                                     <span class="n">share</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rename_rows</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                        <span class="c1"># if self.rows_new_names is not None:</span>
                            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows_new_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rename_cols</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                        <span class="c1"># if self.cols_new_names is not None:</span>
                            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols_new_names</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span>
                                        <span class="c1"># adjustable=&#39;box&#39;,</span>
                                        <span class="n">share</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rename_rows</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                        <span class="c1"># if self.rows_new_names is not None:</span>
                            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows_new_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rename_cols</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                        <span class="c1"># if self.cols_new_names is not None:</span>
                            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols_new_names</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

            <span class="n">supx</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">supxlabel</span><span class="p">(</span><span class="n">supxlabel</span><span class="p">)</span>
            <span class="n">supy</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">supylabel</span><span class="p">(</span><span class="n">supylabel</span><span class="p">)</span>

            <span class="n">leg</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
                <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span>
                <span class="c1"># borderaxespad=0.1,</span>
            <span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">leg</span><span class="o">.</span><span class="n">legendHandles</span><span class="p">)):</span>
                <span class="n">leg</span><span class="o">.</span><span class="n">legendHandles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">30</span><span class="p">]</span>

            <span class="c1"># plt.subplots_adjust(</span>
            <span class="c1">#     # bottom=0.2,</span>
            <span class="c1">#     left=0.05</span>
            <span class="c1"># )</span>

            <span class="c1"># plt.tight_layout()</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span>
                        <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span>
                        <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span>
                        <span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">(</span><span class="n">leg</span><span class="p">,</span> <span class="n">supx</span><span class="p">,</span> <span class="n">supy</span><span class="p">),</span>
                        <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span>
                        <span class="p">)</span></div>


<div class="viewcode-block" id="Table.time_plot">
<a class="viewcode-back" href="../../../../accim.data.postprocessing.html#accim.data.postprocessing.main.Table.time_plot">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">time_plot</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">vars_to_gather_cols</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">vars_to_gather_rows</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">detailed_cols</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">detailed_rows</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">custom_cols_order</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">custom_rows_order</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">data_on_y_main_axis</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">data_on_y_sec_axis</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">colorlist_y_main_axis</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">colorlist_y_sec_axis</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">rows_renaming_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">cols_renaming_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

            <span class="n">sharex</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">sharey</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">figname</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">figsize</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">ratio_height_to_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">dpi</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
            <span class="n">confirm_graph</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">set_facecolor</span><span class="p">:</span> <span class="nb">any</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">)</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Used to plot a timeplot.</span>

<span class="sd">        :param vars_to_gather_cols: A list of strings.</span>
<span class="sd">            The list should be the variables you want to show in subplot columns.</span>
<span class="sd">        :type vars_to_gather_cols: list</span>
<span class="sd">        :param vars_to_gather_rows: A list of strings.</span>
<span class="sd">            The list should be the variables you want to show in subplot rows.</span>
<span class="sd">        :type vars_to_gather_rows: list</span>
<span class="sd">        :param detailed_cols: A list of strings.</span>
<span class="sd">            The list should be the specific data you want to show in subplots columns.</span>
<span class="sd">            Used to filter.</span>
<span class="sd">        :type detailed_cols: list</span>
<span class="sd">        :param detailed_rows: A list of strings.</span>
<span class="sd">            The list should be the specific data you want to show in subplots rows.</span>
<span class="sd">            Used to filter.</span>
<span class="sd">        :type detailed_rows: list</span>
<span class="sd">        :param custom_cols_order: A list of strings.</span>
<span class="sd">            The list should be the specific order for the items shown in subplot columns.</span>
<span class="sd">        :type custom_cols_order: list</span>
<span class="sd">        :param custom_rows_order: A list of strings.</span>
<span class="sd">            The list should be the specific order for the items shown in subplot rows.</span>
<span class="sd">        :type custom_rows_order: list</span>
<span class="sd">        :param data_on_y_main_axis: A list with nested lists and strings.</span>
<span class="sd">            Used to select the data you want to show in the scatter plot main y-axis.</span>
<span class="sd">            It needs to follow this structure:</span>
<span class="sd">            [[&#39;name_on_y_main_axis&#39;, [list of column names you want to plot]]]</span>
<span class="sd">        :type data_on_y_main_axis: list</span>
<span class="sd">        :param data_on_y_sec_axis: A list with nested lists and strings.</span>
<span class="sd">            Used to select the data you want to show in the scatter plot secondary y-axis.</span>
<span class="sd">            It needs to follow this structure:</span>
<span class="sd">            [[[&#39;name_on_1st_y_sec_axis&#39;, [list of column names you want to plot]], [&#39;name_on_2nd_y_sec_axis&#39;, [list of column names you want to plot]], etc]</span>
<span class="sd">        :type data_on_y_sec_axis: list</span>
<span class="sd">        :param colorlist_y_main_axis: A list with nested lists and strings.</span>
<span class="sd">            It should follow the same structure as data_on_y_main_axis,</span>
<span class="sd">            but replacing the column names with the colors using the matplotlib notation.</span>
<span class="sd">        :type colorlist_y_main_axis: list</span>
<span class="sd">        :param colorlist_y_sec_axis: A list with nested lists and strings.</span>
<span class="sd">            It should follow the same structure as data_on_y_sec_axis,</span>
<span class="sd">            but replacing the column names with the colors using the matplotlib notation.</span>
<span class="sd">        :type colorlist_y_sec_axis: list</span>
<span class="sd">        :param rows_renaming_dict: A dictionary. Should follow the pattern</span>
<span class="sd">            {&#39;old row name 1&#39;: &#39;new row name 1&#39;, &#39;old row name 2&#39;: &#39;new row name 2&#39;}</span>
<span class="sd">        :type rows_renaming_dict: dict</span>
<span class="sd">        :param cols_renaming_dict: A dictionary. Should follow the pattern</span>
<span class="sd">            {&#39;old col name 1&#39;: &#39;new col name 1&#39;, &#39;old col name 2&#39;: &#39;new col name 2&#39;}</span>
<span class="sd">        :type cols_renaming_dict: dict</span>
<span class="sd">        :param sharey: True to share the x-axis across all subplots</span>
<span class="sd">        :type sharey: bool</span>
<span class="sd">        :param sharex: True to share the y-axis across all subplots</span>
<span class="sd">        :type sharex: bool</span>
<span class="sd">        :param figname: A string. The name of the saved figure without extension.</span>
<span class="sd">        :type figname: str</span>
<span class="sd">        :param figsize: A float. It is the figure size.</span>
<span class="sd">        :type figsize: float</span>
<span class="sd">        :param ratio_height_to_width: A float. By default, is 1 (squared). If 0.5 is entered, the figure will be half higher than wide.</span>
<span class="sd">        :type ratio_height_to_width: float</span>
<span class="sd">        :param dpi: An integer. The number of dpis for image quality.</span>
<span class="sd">        :type dpi: int</span>
<span class="sd">        :param confirm_graph: A bool. True to skip confirmation step.</span>
<span class="sd">        :type confirm_graph: bool</span>
<span class="sd">        :param set_facecolor: Usage is similar to matplotlib.axes.Axes.set_facecolor</span>
<span class="sd">        :type set_facecolor: any</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.dates</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mdates</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">generate_fig_data</span><span class="p">(</span>
            <span class="n">vars_to_gather_cols</span><span class="o">=</span><span class="n">vars_to_gather_cols</span><span class="p">,</span>
            <span class="n">vars_to_gather_rows</span><span class="o">=</span><span class="n">vars_to_gather_rows</span><span class="p">,</span>
            <span class="n">detailed_cols</span><span class="o">=</span><span class="n">detailed_cols</span><span class="p">,</span>
            <span class="n">detailed_rows</span><span class="o">=</span><span class="n">detailed_rows</span><span class="p">,</span>
            <span class="n">custom_cols_order</span><span class="o">=</span><span class="n">custom_cols_order</span><span class="p">,</span>
            <span class="n">custom_rows_order</span><span class="o">=</span><span class="n">custom_rows_order</span><span class="p">,</span>
            <span class="n">data_on_y_main_axis</span><span class="o">=</span><span class="n">data_on_y_main_axis</span><span class="p">,</span>
            <span class="n">data_on_y_sec_axis</span><span class="o">=</span><span class="n">data_on_y_sec_axis</span><span class="p">,</span>
            <span class="n">data_on_x_axis</span><span class="o">=</span><span class="s1">&#39;anything&#39;</span><span class="p">,</span>
            <span class="n">colorlist_y_main_axis</span><span class="o">=</span><span class="n">colorlist_y_main_axis</span><span class="p">,</span>
            <span class="n">colorlist_y_sec_axis</span><span class="o">=</span><span class="n">colorlist_y_sec_axis</span><span class="p">,</span>
            <span class="n">rows_renaming_dict</span><span class="o">=</span><span class="n">rows_renaming_dict</span><span class="p">,</span>
            <span class="n">cols_renaming_dict</span><span class="o">=</span><span class="n">cols_renaming_dict</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># print(f&#39;The number of self.rows and the list of these is going to be:&#39;)</span>
        <span class="c1"># print(f&#39;No. of self.rows = {len(self.rows)}&#39;)</span>
        <span class="c1"># print(f&#39;List of self.rows:&#39;)</span>
        <span class="c1"># print(*self.rows, sep=&#39;\n&#39;)</span>
        <span class="c1">#</span>
        <span class="c1"># print(f&#39;The number of columns and the list of these is going to be:&#39;)</span>
        <span class="c1"># print(f&#39;No. of columns = {len(self.cols)}&#39;)</span>
        <span class="c1"># print(f&#39;List of columns:&#39;)</span>
        <span class="c1"># print(*self.cols, sep=&#39;\n&#39;)</span>

        <span class="k">if</span> <span class="n">confirm_graph</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">proceed</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Do you want to proceed? [y/n]:&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;y&#39;</span> <span class="ow">in</span> <span class="n">proceed</span><span class="p">:</span>
                <span class="n">confirm_graph</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="s1">&#39;n&#39;</span> <span class="ow">in</span> <span class="n">proceed</span><span class="p">:</span>
                <span class="n">confirm_graph</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">confirm_graph</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df_for_graph</span><span class="p">[</span><span class="s1">&#39;Date/time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_for_graph</span><span class="o">.</span><span class="n">index</span>

            <span class="n">freq_graph_dict</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;timestep&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;X?&#39;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">/%m %H:%M&quot;</span><span class="p">],</span>
                <span class="s1">&#39;hourly&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s2">&quot; </span><span class="si">%d</span><span class="s2">/%m %H:%M:%S&quot;</span><span class="p">],</span>
                <span class="c1"># &#39;daily&#39;: [&#39;D&#39;, &quot;%d/%m&quot;],</span>
                <span class="s1">&#39;daily&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s2">&quot; </span><span class="si">%d</span><span class="s2">/%m %H:%M:%S&quot;</span><span class="p">],</span>
                <span class="c1"># &#39;monthly&#39;: [&#39;M&#39;, &quot;%m&quot;],</span>
                <span class="s1">&#39;monthly&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s2">&quot; </span><span class="si">%d</span><span class="s2">/%m %H:%M:%S&quot;</span><span class="p">],</span>
                <span class="c1"># todo WIP</span>
                <span class="s1">&#39;runperiod&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;?&#39;</span><span class="p">,</span> <span class="s2">&quot;?&quot;</span><span class="p">]</span>
            <span class="p">}</span>

            <span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_for_graph</span><span class="p">[</span><span class="s1">&#39;Date/time&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">freq_graph_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="c1"># end_date = datetime.datetime.strptime(df_for_graph[&#39;Date/time&#39;][len(self.df_for_graph)-1], &quot;%d/%m %H:%M&quot;)</span>
            <span class="c1"># (end_date-start_date).days</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">df_for_graph</span><span class="p">[</span><span class="s1">&#39;Date/time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span>
                <span class="n">start</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
                <span class="n">periods</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_for_graph</span><span class="p">),</span>
                <span class="c1"># &#39;2017-31-12 23:00&#39;,</span>
                <span class="n">freq</span><span class="o">=</span><span class="n">freq_graph_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">df_for_graph</span><span class="p">[</span><span class="s1">&#39;Date/time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_for_graph</span><span class="p">[</span><span class="s1">&#39;Date/time&#39;</span><span class="p">])</span>

            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">),</span>
                                   <span class="n">ncols</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">),</span>
                                   <span class="n">sharex</span><span class="o">=</span><span class="n">sharex</span><span class="p">,</span>
                                   <span class="n">sharey</span><span class="o">=</span><span class="n">sharey</span><span class="p">,</span>
                                   <span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">figsize</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">),</span> <span class="n">ratio_height_to_width</span> <span class="o">*</span> <span class="n">figsize</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)))</span>

            <span class="n">main_y_axis</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">sec_y_axis</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)):</span>
                <span class="n">main_y_axis_temp_rows</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">sec_y_axis_temp_rows</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)):</span>

                    <span class="n">current_axis</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
                    <span class="n">current_axis</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="n">freq_graph_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="n">current_axis</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">MonthLocator</span><span class="p">())</span>

                    <span class="n">main_y_axis_temp_cols</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">sec_y_axis_temp_cols</span> <span class="o">=</span> <span class="p">[]</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_main_axis</span><span class="p">)):</span>
                            <span class="n">main_y_axis_temp_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
                        <span class="n">main_y_axis_temp_rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">main_y_axis_temp_cols</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_sec_axis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_sec_axis</span><span class="p">)):</span>
                                <span class="n">sec_y_axis_temp_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">())</span>
                            <span class="n">sec_y_axis_temp_rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sec_y_axis_temp_cols</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_main_axis</span><span class="p">)):</span>
                            <span class="n">main_y_axis_temp_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="n">main_y_axis_temp_rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">main_y_axis_temp_cols</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_sec_axis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_sec_axis</span><span class="p">)):</span>
                                <span class="n">sec_y_axis_temp_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">twinx</span><span class="p">())</span>
                            <span class="n">sec_y_axis_temp_rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sec_y_axis_temp_cols</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_main_axis</span><span class="p">)):</span>
                            <span class="n">main_y_axis_temp_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                        <span class="n">main_y_axis_temp_rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">main_y_axis_temp_cols</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_sec_axis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_sec_axis</span><span class="p">)):</span>
                                <span class="n">sec_y_axis_temp_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">twinx</span><span class="p">())</span>
                            <span class="n">sec_y_axis_temp_rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sec_y_axis_temp_cols</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_main_axis</span><span class="p">)):</span>
                            <span class="n">main_y_axis_temp_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
                        <span class="n">main_y_axis_temp_rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">main_y_axis_temp_cols</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_sec_axis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_sec_axis</span><span class="p">)):</span>
                                <span class="n">sec_y_axis_temp_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">twinx</span><span class="p">())</span>
                            <span class="n">sec_y_axis_temp_rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sec_y_axis_temp_cols</span><span class="p">)</span>
                <span class="n">main_y_axis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">main_y_axis_temp_rows</span><span class="p">)</span>
                <span class="n">sec_y_axis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sec_y_axis_temp_rows</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)):</span>

                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])):</span>

                        <span class="n">main_y_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span>
                            <span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="n">freq_graph_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
                        <span class="n">main_y_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">MonthLocator</span><span class="p">())</span>

                        <span class="n">main_y_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">)</span>
                        <span class="n">main_y_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span>
                                                         <span class="n">grid_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                                                         <span class="n">grid_alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                        <span class="n">main_y_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">set_facecolor</span><span class="p">)</span>

                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;dataframe&#39;</span><span class="p">])):</span>
                            <span class="k">if</span> <span class="s1">&#39;Setpoint Temperature&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">]:</span>
                                <span class="n">zord</span> <span class="o">=</span> <span class="mi">1</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">zord</span> <span class="o">=</span> <span class="mi">0</span>
                            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">main_y_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">df_for_graph</span><span class="p">[</span><span class="s1">&#39;Date/time&#39;</span><span class="p">],</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;dataframe&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                    <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                    <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;color&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                    <span class="c1"># ms=markersize,</span>
                                    <span class="c1"># marker=&#39;o&#39;,</span>
                                    <span class="c1"># alpha=0.5,</span>
                                    <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                    <span class="n">zorder</span><span class="o">=</span><span class="n">zord</span><span class="p">,</span>
                                <span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">main_y_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">df_for_graph</span><span class="p">[</span><span class="s1">&#39;Date/time&#39;</span><span class="p">],</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;dataframe&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                    <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                    <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_main</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;color&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                    <span class="c1"># ms=markersize,</span>
                                    <span class="c1"># marker=&#39;o&#39;,</span>
                                    <span class="c1"># alpha=0.5,</span>
                                    <span class="n">zorder</span><span class="o">=</span><span class="n">zord</span><span class="p">,</span>
                                <span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)):</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_sec</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])):</span>
                        <span class="n">sec_y_axis</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">get_shared_y_axes</span><span class="p">()</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sec_y_axis</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">k</span><span class="p">],</span> <span class="n">sec_y_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">])</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_sec_axis</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_sec</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                                    <span class="c1"># sec_y_axis[i][j][k].set_yticklabels([])</span>
                                    <span class="n">sec_y_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([],</span> <span class="p">[])</span>
                                <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                                    <span class="n">sec_y_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_sec_axis</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                                    <span class="n">sec_y_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="s2">&quot;axes&quot;</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="mf">0.15</span><span class="p">))</span>
                                    <span class="n">sec_y_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_sec</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;dataframe&#39;</span><span class="p">])):</span>
                            <span class="k">if</span> <span class="s1">&#39;Setpoint Temperature&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_list_sec</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">]:</span>
                                <span class="n">zord</span> <span class="o">=</span> <span class="mi">1</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">zord</span> <span class="o">=</span> <span class="mi">0</span>
                            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">sec_y_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">df_for_graph</span><span class="p">[</span><span class="s1">&#39;Date/time&#39;</span><span class="p">],</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">y_list_sec</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;dataframe&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                    <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                    <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_sec</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;color&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                    <span class="c1"># ms=markersize,</span>
                                    <span class="c1"># marker=&#39;o&#39;,</span>
                                    <span class="c1"># alpha=0.5,</span>
                                    <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_sec</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                    <span class="n">zorder</span><span class="o">=</span><span class="n">zord</span><span class="p">,</span>
                                <span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">sec_y_axis</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">df_for_graph</span><span class="p">[</span><span class="s1">&#39;Date/time&#39;</span><span class="p">],</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">y_list_sec</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;dataframe&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                    <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                    <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_list_sec</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;color&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">],</span>
                                    <span class="c1"># ms=markersize,</span>
                                    <span class="c1"># marker=&#39;o&#39;,</span>
                                    <span class="c1"># alpha=0.5,</span>
                                    <span class="n">zorder</span><span class="o">=</span><span class="n">zord</span><span class="p">,</span>
                                <span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rename_rows</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows_new_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rename_rows</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols_new_names</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rename_rows</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows_new_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rename_rows</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols_new_names</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rename_rows</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows_new_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rename_rows</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols_new_names</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">/%m&#39;</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
                        <span class="n">label</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)):</span>
                    <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">/%m&#39;</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
                        <span class="n">label</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">ax</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">/%m&#39;</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
                        <span class="n">label</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)):</span>
                        <span class="c1"># ax[len(self.rows) - 1, j].xaxis.set_major_formatter(mdates.DateFormatter(&#39;%d/%m&#39;))</span>
                        <span class="c1"># for label in ax[len(self.rows) - 1, j].get_xticklabels():</span>
                        <span class="c1">#     label.set(rotation=90, horizontalalignment=&#39;center&#39;)</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)):</span>
                            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">/%m&#39;</span><span class="p">))</span>
                            <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
                                <span class="n">label</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

            <span class="c1"># plt.xticks(rotation=70)</span>

            <span class="n">supx</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">supxlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
            <span class="n">supy</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">supylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_main_axis</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">leg</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
                <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;large&#39;</span>
                <span class="c1"># borderaxespad=0.1,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_sec_axis</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">rhstext</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_sec_axis</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;large&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_on_y_sec_axis</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">bbox_extra_artists_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="n">rhstext</span><span class="p">,</span> <span class="n">leg</span><span class="p">,</span> <span class="n">supx</span><span class="p">,</span> <span class="n">supy</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bbox_extra_artists_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="n">leg</span><span class="p">,</span> <span class="n">supx</span><span class="p">,</span> <span class="n">supy</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">leg</span><span class="o">.</span><span class="n">legendHandles</span><span class="p">)):</span>
                <span class="n">leg</span><span class="o">.</span><span class="n">legendHandles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">30</span><span class="p">]</span>

            <span class="c1"># plt.subplots_adjust(bottom=0.2)</span>
            <span class="c1"># plt.tight_layout()</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span>
                        <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span>
                        <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span>
                        <span class="n">bbox_extra_artists</span><span class="o">=</span><span class="n">bbox_extra_artists_tuple</span><span class="p">,</span>
                        <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Daniel Sánchez-García.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>